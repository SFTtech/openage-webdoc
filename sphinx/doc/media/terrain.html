

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>terrain documentation &mdash; openage v0.4.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../index.html" class="icon icon-home"> openage
          

          
            
            <img src="../../_static/banner.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/installation/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/installation/basic_installation.html">Basic Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/installation/basic_installation.html#linux-installation">Linux Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/installation/basic_installation.html#windows-installation">Windows Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/installation/basic_installation.html#macos-installation">macOS Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/installation/building.html">Building from Source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../building.html">Building the project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../build_instructions/index.html">Dependency installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/installation/platform_support.html">Platform Support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/installation/platform_support.html#continuous-integration-targets">Continuous Integration Targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/installation/platform_support.html#other-platforms">Other Platforms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#windows-installer">Windows Installer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#asset-conversion">Asset Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#ingame">Ingame</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/handbooks/index.html">Handbooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/handbooks/handbook-user/index.html">User handbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-user/overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-user/tutorial.html">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/handbooks/handbook-mod/index.html">Modding handbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-mod/overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-mod/concepts.html">Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/assets_conversion.html">Assets &amp; Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nyan/index.html">nyan - Entity-Component-System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/reverse_engineering.html">Reverse Engineering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ideas/index.html">Ideas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-mod/tutorial.html">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/handbooks/handbook-dev/index.html">Developing handbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-dev/overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-dev/concepts.html">Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-dev/code_style.html">Code-style</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/index.html">Code documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nyan/index.html">nyan - Entity-Component-System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/assets_conversion.html">Assets &amp; Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/reverse_engineering.html">Reverse Engineering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ideas/index.html">Ideas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sphinx/handbooks/handbook-dev/tutorial.html">Tutorials</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/reference/index.html">References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../nyan/api_reference/index.html">API reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../nyan/api_reference/reference_ability.html">engine.ability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nyan/api_reference/reference_aux.html">engine.aux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nyan/api_reference/reference_effect.html">engine.effect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nyan/api_reference/reference_modifier.html">engine.modifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nyan/api_reference/reference_resistance.html">engine.resistance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nyan/api_reference/reference_root.html">engine.root</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/reference/doxygen.html">openage c++/python reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/whatsnew.html">What’s new?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/changelogs.html">Changelogs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelogs/engine/index.html">Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelogs/nyan_api/index.html">Nyan API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sphinx/releasenotes.html">Release Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../releasenotes.html">0.4.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenotes.html#id2">0.3.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenotes.html#id5">0.2.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenotes.html#id8">0.2.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenotes.html#id11">0.2.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenotes.html#id14">0.2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenotes.html#id17">0.1.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../releasenotes.html#id20">0.0.0</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../README.html">openage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#contact">Contact</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#technical-foundation">Technical foundation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#goals">Goals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#current-state-of-the-project">Current State of the Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#installation-packages">Installation Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#dependencies-building-and-running">Dependencies, Building and Running</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#contributing">Contributing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#development-process">Development Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../README.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../README.html">Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../README.html#static-docs">Static Docs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#dynamic-docs">Dynamic Docs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../status.html">openage status</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../status.html#the-list-must-grow">The list must grow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../status.html#working-features">Working features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../status.html#missing-functionality">Missing functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="../status.html#under-the-hood">Under the hood</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../milestones.html">Milestones</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">openage</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>terrain documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/doc/media/terrain.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="terrain-documentation">
<h1>terrain documentation<a class="headerlink" href="#terrain-documentation" title="Permalink to this headline">¶</a></h1>
<p>This file describes the research done on terrain rendering.</p>
<div class="section" id="contents-of-terrain-drs">
<h2>Contents of terrain.drs<a class="headerlink" href="#contents-of-terrain-drs" title="Permalink to this headline">¶</a></h2>
<p>27 slp files for terrain data, each slp stores one terrain type with all tiles.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>id</th>
<th>filename</th>
<th align="right">priority</th>
<th>tilecount</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>015000.slp</td>
<td align="right">70</td>
<td>100 tiles</td>
<td>brown dirty earth</td>
</tr>
<tr>
<td>1</td>
<td>015001.slp</td>
<td align="right">102</td>
<td>100 tiles</td>
<td>more dry grass</td>
</tr>
<tr>
<td>2</td>
<td>015002.slp</td>
<td align="right">139</td>
<td>100 tiles</td>
<td>light water</td>
</tr>
<tr>
<td>3</td>
<td>015004.slp</td>
<td align="right">155</td>
<td>36 tiles</td>
<td>full grown farm field</td>
</tr>
<tr>
<td>4</td>
<td>015005.slp</td>
<td align="right">157</td>
<td>36 tiles</td>
<td>decaying farm field</td>
</tr>
<tr>
<td>5</td>
<td>015006.slp</td>
<td align="right">101</td>
<td>100 tiles</td>
<td>dirt with little grass</td>
</tr>
<tr>
<td>6</td>
<td>015007.slp</td>
<td align="right">106</td>
<td>100 tiles</td>
<td>dry grass</td>
</tr>
<tr>
<td>7</td>
<td>015008.slp</td>
<td align="right">90</td>
<td>100 tiles</td>
<td>dark grass</td>
</tr>
<tr>
<td>8</td>
<td>015009.slp</td>
<td align="right">100</td>
<td>100 tiles</td>
<td>normal grass</td>
</tr>
<tr>
<td>9</td>
<td>015010.slp</td>
<td align="right">80</td>
<td>100 tiles</td>
<td>desert</td>
</tr>
<tr>
<td>10</td>
<td>015011.slp</td>
<td align="right">92</td>
<td>100 tiles</td>
<td>sandy dry grass</td>
</tr>
<tr>
<td>11</td>
<td>015014.slp</td>
<td align="right">60</td>
<td>100 tiles</td>
<td>swamp</td>
</tr>
<tr>
<td>12</td>
<td>015015.slp</td>
<td align="right">140</td>
<td>100 tiles</td>
<td>deep water</td>
</tr>
<tr>
<td>13</td>
<td>015016.slp</td>
<td align="right">141</td>
<td>100 tiles</td>
<td>ocean</td>
</tr>
<tr>
<td>14</td>
<td>015017.slp</td>
<td align="right">110</td>
<td>100 tiles</td>
<td>sandy sand</td>
</tr>
<tr>
<td>15</td>
<td>015018.slp</td>
<td align="right">122</td>
<td>100 tiles</td>
<td>ancient building fundaments</td>
</tr>
<tr>
<td>16</td>
<td>015019.slp</td>
<td align="right">123</td>
<td>100 tiles</td>
<td>dirt ancient building fundaments</td>
</tr>
<tr>
<td>17</td>
<td>015021.slp</td>
<td align="right">150</td>
<td>9 tiles</td>
<td>ready and empty farm field</td>
</tr>
<tr>
<td>18</td>
<td>015022.slp</td>
<td align="right">151</td>
<td>9 tiles</td>
<td>stage 0 plants on farm field</td>
</tr>
<tr>
<td>19</td>
<td>015023.slp</td>
<td align="right">152</td>
<td>9 tiles</td>
<td>stage 1 plants on farm field</td>
</tr>
<tr>
<td>20</td>
<td>015024.slp</td>
<td align="right">40</td>
<td>100 tiles</td>
<td>ice</td>
</tr>
<tr>
<td>21</td>
<td>015026.slp</td>
<td align="right">130</td>
<td>100 tiles</td>
<td>snow</td>
</tr>
<tr>
<td>22</td>
<td>015027.slp</td>
<td align="right">132</td>
<td>100 tiles</td>
<td>dirt with snow</td>
</tr>
<tr>
<td>23</td>
<td>015028.slp</td>
<td align="right">134</td>
<td>100 tiles</td>
<td>grass with snow</td>
</tr>
<tr>
<td>24</td>
<td>015029.slp</td>
<td align="right">136</td>
<td>100 tiles</td>
<td>grass with snow</td>
</tr>
<tr>
<td>25</td>
<td>015030.slp</td>
<td align="right">162</td>
<td>100 tiles</td>
<td>ancient building fundaments with snow</td>
</tr>
<tr>
<td>26</td>
<td>015031.slp</td>
<td align="right">120</td>
<td>100 tiles</td>
<td>grass ancient building fundaments</td>
</tr>
</tbody>
</table><p>One terrain tile is a parallelogram with equal side lengths, and the same angles in edges on opposing sides. (This is also known as a rhombus.)</p>
<p>Tile image height = 97px
Tile image width  = 49px</p>
<p>Half-tile structure: (<code class="docutils literal notranslate"><span class="pre">#</span></code> is any pixel, <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> is the center pixel for the entire tile)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>	                                                <span class="c1">#</span>
	                                              <span class="c1">#####</span>
	                                            <span class="c1">#########</span>
	                                          <span class="c1">#############</span>
	                                        <span class="c1">#################</span>
	                                      <span class="c1">#####################</span>
	                                    <span class="c1">#########################</span>
	                                  <span class="c1">#############################</span>
	                                <span class="c1">#################################</span>
	                              <span class="c1">#####################################</span>
	                            <span class="c1">#########################################</span>
	                          <span class="c1">#############################################</span>
	                        <span class="c1">#################################################</span>
	                      <span class="c1">#####################################################</span>
	                    <span class="c1">#########################################################</span>
	                  <span class="c1">#############################################################</span>
	                <span class="c1">#################################################################</span>
	              <span class="c1">#####################################################################</span>
	            <span class="c1">#########################################################################</span>
	          <span class="c1">#############################################################################</span>
	        <span class="c1">#################################################################################</span>
	      <span class="c1">#####################################################################################</span>
	    <span class="c1">#########################################################################################</span>
	  <span class="c1">#############################################################################################</span>
	<span class="c1">################################################@################################################ &lt;| 97 pixels, 25th row</span>
</pre></div>
</div>
<p>Drawing smooth uniform terrain is simple:</p>
<p><code class="docutils literal notranslate"><span class="pre">#</span></code> is a single terrain tile.
this illustration shows the coordinate grid we use for the tile drawing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>	         <span class="mi">3</span>
	       <span class="mi">2</span>   <span class="c1">#</span>
	     <span class="mi">1</span>   <span class="c1">#   #</span>
	<span class="n">x</span><span class="o">=</span> <span class="mi">0</span>   <span class="c1">#   *   #</span>
	     <span class="c1">#   #   #   #</span>
	<span class="n">y</span><span class="o">=</span> <span class="mi">0</span>   <span class="c1">#   #   #</span>
	     <span class="mi">1</span>   <span class="c1">#   #</span>
	       <span class="mi">2</span>   <span class="c1">#</span>
	         <span class="mi">3</span>
</pre></div>
</div>
<p>Tile <code class="docutils literal notranslate"><span class="pre">*</span></code> is at (2, 1).
The formula for selecting the correct terrain .SLP frame index at position (x, y):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tc</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">terraintilecount</span><span class="p">)</span> <span class="c1">#=10 for regular terrains</span>
<span class="n">frame_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="n">tc</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">y</span> <span class="o">%</span> <span class="n">tc</span><span class="p">)</span> <span class="o">*</span> <span class="n">tc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="terrain-blending-modes">
<h2>Terrain blending modes<a class="headerlink" href="#terrain-blending-modes" title="Permalink to this headline">¶</a></h2>
<p>blending mode: see the <a class="reference internal" href="blendomatic.html"><span class="doc">blendomatic docs</span></a> for
more information about terrain blending.</p>
<p>blending mode id correction:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="right">stored mode</th>
<th>terrain type</th>
<th>corrected mode</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td>dirt, grass</td>
<td>1</td>
</tr>
<tr>
<td align="right">1</td>
<td>farms</td>
<td>3</td>
</tr>
<tr>
<td align="right">2</td>
<td>beach</td>
<td>2</td>
</tr>
<tr>
<td align="right">3</td>
<td>water</td>
<td>0</td>
</tr>
<tr>
<td align="right">4</td>
<td>shallows</td>
<td>1</td>
</tr>
<tr>
<td align="right">5</td>
<td>roads</td>
<td>4</td>
</tr>
<tr>
<td align="right">6</td>
<td>ice</td>
<td>5</td>
</tr>
<tr>
<td align="right">7</td>
<td>snow</td>
<td>6</td>
</tr>
<tr>
<td align="right">8</td>
<td>not assigned</td>
<td>4</td>
</tr>
</tbody>
</table></div>
<div class="section" id="terrain-elevations">
<h2>Terrain elevations<a class="headerlink" href="#terrain-elevations" title="Permalink to this headline">¶</a></h2>
<p>Drawing and blending in flat elevation.</p>
<div class="section" id="sloped-tiles">
<h3>Sloped tiles<a class="headerlink" href="#sloped-tiles" title="Permalink to this headline">¶</a></h3>
<p>generated by texture mapping the flat tiles and lighting them (in HSV color space)
blend RGB space, maybe blending them in HSV space could reduce the amount of grey.
lift up the vertices by half of their diamond height.</p>
</div>
</div>
<div class="section" id="view-icm-dat">
<h2>view_icm.dat<a class="headerlink" href="#view-icm-dat" title="Permalink to this headline">¶</a></h2>
<p>“inverse color map”</p>
<p>=&gt; get best color_palette entry
rgb to palette index transformation table with 10 variations of brightness</p>
<p>=&gt; 10 color maps, 32x32x32 lookup table, 1 byte indices.
=&gt; 10 32 kilobyte structures</p>
<p>brightness variation: use row 0..9</p>
<p>fetches the closest color index in the color_table for a given rgb (3 x 8 bit) value.
set each “axis” (the 32 bit position) to the upper 5 bits of r, g, b (shift &gt;&gt; 3)
select one row =&gt; coordinates in the table:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">offset</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="mi">32</span><span class="o">^</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="mi">32</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="mi">32</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">i</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">icm</span> <span class="n">index</span>
<span class="n">palette_index</span> <span class="o">=</span> <span class="n">byte_at</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
</pre></div>
</div>
<p>sloped terrain lighting brightness levels
1 ICM:  normal/unlit pixels (flat tiles)
9 ICMs: lighting
=&gt; 4 step of darkening and 4 steps of brightening, 1 neutral.
one ICM maps to the 50500 palette
the other 9 adjust the pixel brightness.</p>
<p>generating the other ICMs:
lighting in HSV color space, modify S and V separately.
for each RGB value in the ICM, convert to HSV, multiply (clamped) S and V by modifiers
convert the resulting HSV color back to RGB.
look up this color by the standard ICM, store back palette indices for the modified light to new ICM.</p>
<p>lighting on sloped tiles:
sloped/elevation tiles are dynamically generated by texturemapping flat tile data onto the sloped format
filtermaps.dat does that
texture mapping operates on the RGB values |&gt; weighted bilinear filtering of the source pixels
=&gt; to convert the resultant R G B back to a palette_index ==&gt; ICM lookup
multiple ICMs: pixel lighting step done in higher quality HSV color,
no performance impact: lighting data is precalculated.</p>
<p>ICMs may not contain system reserved colors at the beginning and end of the palette
=&gt; some colors are not used/present in the ICMs</p>
</div>
<div class="section" id="tileedge-dat-blkedge-dat-format">
<h2>tileedge.dat / blkedge.dat format<a class="headerlink" href="#tileedge-dat-blkedge-dat-format" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">blkedge.dat</span></code> contains bitmasks that are used for drawing edges for fog of war and unexplored regions.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">tile_edge</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">elevation_offsets</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">uint32_t</span> <span class="n">tile_offsets</span><span class="p">[</span><span class="mi">94</span><span class="p">];</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="p">{</span>
				<span class="n">uint8</span> <span class="n">y</span><span class="p">;</span>   <span class="c1">// 0 &lt;= y &lt;= 72</span>
				<span class="n">uint8</span> <span class="n">x0</span><span class="p">;</span>  <span class="c1">// 0 &lt;= x0 &lt;= 96</span>
				<span class="n">uint8</span> <span class="n">x1</span><span class="p">;</span>  <span class="c1">// 0 &lt;= x1 &lt;= 96 &amp;&amp; x0 &lt;= x1</span>
			<span class="p">}</span> <span class="n">spans</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>    <span class="c1">// repeat until y == 255</span>
		<span class="p">}</span> <span class="n">tiles</span><span class="p">[</span><span class="mi">94</span><span class="p">];</span>       <span class="c1">// each starting at tile_offsets[i]</span>
	<span class="p">}</span> <span class="n">elevations</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>      <span class="c1">// each starting at elevation_offsets[i]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>blkedge.dat: replace 94 with 47, otherwise same format.</p>
<p>each ‘spans’ == pixels from (x0,y) to (x1,y) (inclusive) to set to 1;
=&gt; 17*94 tiles, each 97x73 1-bit pixels</p>
</div>
<div class="section" id="patternmasks-dat-format">
<h2>patternmasks.dat format<a class="headerlink" href="#patternmasks-dat-format" title="Permalink to this headline">¶</a></h2>
<p>No idea what this data is for, also the format’s not verified yet.
filesize = 164000 bytes = 2^5 * 5^3 * 41 bytes</p>
<p>164000 bytes / 16 = 10250 bytes</p>
<p>64 * 64 * 40 bytes = 163840 bytes, 160 bytes left then.
(64 * 64 + 4) * 40 bytes = 164000 =&gt; win.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">patternmasks</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">uint_32</span> <span class="n">unknown</span><span class="p">;</span>  <span class="c1">//4 bytes: 0x00100000 =&gt; if uint32: 1048576</span>
		<span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">64</span><span class="o">*</span><span class="mi">64</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">mask</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2019 openage-Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>