<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.13">
  <compounddef id="dc/dcd/terrain_8cpp" kind="file" language="C++">
    <compoundname>terrain.cpp</compoundname>
    <includes refid="d8/db6/terrain_8h" local="yes">terrain.h</includes>
    <includes local="no">cmath</includes>
    <includes local="no">memory</includes>
    <includes local="no">set</includes>
    <includes local="no">unordered_map</includes>
    <includes refid="d7/d7f/log_8h" local="yes">../log/log.h</includes>
    <includes refid="d7/dce/error_2error_8h" local="yes">../error/error.h</includes>
    <includes refid="d1/d55/engine_8h" local="yes">../engine.h</includes>
    <includes refid="da/db1/game__renderer_8h" local="yes">../game_renderer.h</includes>
    <includes refid="dd/dcd/pixel_8h" local="yes">../coord/pixel.h</includes>
    <includes refid="dd/dd5/chunk_8h" local="yes">../coord/chunk.h</includes>
    <includes refid="da/dce/tile_8h" local="yes">../coord/tile.h</includes>
    <includes refid="d4/d08/misc_8h" local="yes">../util/misc.h</includes>
    <includes refid="d6/d90/strings_8h" local="yes">../util/strings.h</includes>
    <includes refid="dd/deb/terrain__chunk_8h" local="yes">terrain_chunk.h</includes>
    <includes refid="d0/d94/terrain__object_8h" local="yes">terrain_object.h</includes>
    <incdepgraph>
      <node id="24432">
        <label>list</label>
      </node>
      <node id="24415">
        <label>../util/language.h</label>
        <link refid="d8/dce/language_8h"/>
      </node>
      <node id="24424">
        <label>atomic</label>
      </node>
      <node id="24513">
        <label>timing.h</label>
        <link refid="db/d41/timing_8h"/>
        <childnode refid="24408" relation="include">
        </childnode>
      </node>
      <node id="24512">
        <label>timer.h</label>
        <link refid="d5/dd0/timer_8h"/>
        <childnode refid="24408" relation="include">
        </childnode>
        <childnode refid="24513" relation="include">
        </childnode>
      </node>
      <node id="24466">
        <label>../log/log.h</label>
        <link refid="d7/d7f/log_8h"/>
        <childnode refid="24433" relation="include">
        </childnode>
        <childnode refid="24420" relation="include">
        </childnode>
      </node>
      <node id="24429">
        <label>iomanip</label>
      </node>
      <node id="24397">
        <label>functional</label>
      </node>
      <node id="24439">
        <label>fslike/native.h</label>
        <link refid="d3/d0f/fslike_2native_8h"/>
      </node>
      <node id="24489">
        <label>queue</label>
      </node>
      <node id="24446">
        <label>limits</label>
      </node>
      <node id="24498">
        <label>job.h</label>
        <link refid="d3/d6a/job_8h"/>
        <childnode refid="24494" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24493" relation="include">
        </childnode>
      </node>
      <node id="24473">
        <label>category.h</label>
        <link refid="d8/d0a/category_8h"/>
        <childnode refid="24418" relation="include">
        </childnode>
      </node>
      <node id="24504">
        <label>event.h</label>
        <link refid="d9/d15/input_2event_8h"/>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24505" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24468" relation="include">
        </childnode>
      </node>
      <node id="24469">
        <label>QObject</label>
      </node>
      <node id="24408">
        <label>cstdint</label>
      </node>
      <node id="24426">
        <label>externalsstream.h</label>
        <link refid="dc/dcf/externalsstream_8h"/>
        <childnode refid="24418" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
      </node>
      <node id="24514">
        <label>util/profiler.h</label>
        <link refid="dd/dff/profiler_8h"/>
        <childnode refid="24455" relation="include">
        </childnode>
        <childnode refid="24515" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
      </node>
      <node id="24414">
        <label>signal.h</label>
        <link refid="d8/d39/signal_8h"/>
        <childnode refid="24414" relation="include">
        </childnode>
      </node>
      <node id="24448">
        <label>misc.h</label>
        <link refid="d4/d08/misc_8h"/>
        <childnode refid="24443" relation="include">
        </childnode>
        <childnode refid="24449" relation="include">
        </childnode>
        <childnode refid="24445" relation="include">
        </childnode>
        <childnode refid="24450" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24417" relation="include">
        </childnode>
        <childnode refid="24412" relation="include">
        </childnode>
      </node>
      <node id="24451">
        <label>coord_nese.gen.h</label>
      </node>
      <node id="24497">
        <label>types.h</label>
        <link refid="da/d65/job_2types_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
      </node>
      <node id="24482">
        <label>stdlib.h</label>
      </node>
      <node id="24499">
        <label>job_group.h</label>
        <link refid="d3/d81/job__group_8h"/>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24417" relation="include">
        </childnode>
        <childnode refid="24491" relation="include">
        </childnode>
        <childnode refid="24498" relation="include">
        </childnode>
        <childnode refid="24500" relation="include">
        </childnode>
        <childnode refid="24497" relation="include">
        </childnode>
        <childnode refid="24501" relation="include">
        </childnode>
      </node>
      <node id="24440">
        <label>../coord/chunk.h</label>
        <link refid="dd/dd5/chunk_8h"/>
        <childnode refid="24441" relation="include">
        </childnode>
        <childnode refid="24451" relation="include">
        </childnode>
        <childnode refid="24452" relation="include">
        </childnode>
      </node>
      <node id="24403">
        <label>../assetmanager.h</label>
        <link refid="d0/d45/assetmanager_8h"/>
        <childnode refid="24404" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24406" relation="include">
        </childnode>
      </node>
      <node id="24410">
        <label>functional.h</label>
        <link refid="d8/dea/functional_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24411" relation="include">
        </childnode>
        <childnode refid="24412" relation="include">
        </childnode>
        <childnode refid="24415" relation="include">
        </childnode>
        <childnode refid="24416" relation="include">
        </childnode>
        <childnode refid="24436" relation="include">
        </childnode>
      </node>
      <node id="24453">
        <label>../coord/phys.h</label>
        <link refid="d0/d8a/phys_8h"/>
        <childnode refid="24448" relation="include">
        </childnode>
        <childnode refid="24454" relation="include">
        </childnode>
        <childnode refid="24441" relation="include">
        </childnode>
        <childnode refid="24451" relation="include">
        </childnode>
        <childnode refid="24452" relation="include">
        </childnode>
      </node>
      <node id="24445">
        <label>cmath</label>
      </node>
      <node id="24419">
        <label>stdexcept</label>
      </node>
      <node id="24508">
        <label>options.h</label>
        <link refid="d7/d5b/options_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24509" relation="include">
        </childnode>
      </node>
      <node id="24416">
        <label>exctranslate.h</label>
        <link refid="dd/d5f/exctranslate_8h"/>
        <childnode refid="24417" relation="include">
        </childnode>
      </node>
      <node id="24428">
        <label>cstdarg</label>
      </node>
      <node id="24405">
        <label>string</label>
      </node>
      <node id="24431">
        <label>logsink.h</label>
        <link refid="d3/d4e/logsink_8h"/>
        <childnode refid="24432" relation="include">
        </childnode>
        <childnode refid="24411" relation="include">
        </childnode>
        <childnode refid="24433" relation="include">
        </childnode>
      </node>
      <node id="24457">
        <label>../coord/pixel.h</label>
        <link refid="dd/dcd/pixel_8h"/>
        <childnode refid="24458" relation="include">
        </childnode>
        <childnode refid="24441" relation="include">
        </childnode>
      </node>
      <node id="24484">
        <label>gui/engine_info.h</label>
        <link refid="d9/d29/engine__info_8h"/>
        <childnode refid="24406" relation="include">
        </childnode>
        <childnode refid="24485" relation="include">
        </childnode>
      </node>
      <node id="24505">
        <label>unordered_set</label>
      </node>
      <node id="24511">
        <label>util/fps.h</label>
        <link refid="d5/d3e/fps_8h"/>
        <childnode refid="24512" relation="include">
        </childnode>
      </node>
      <node id="24502">
        <label>input/input_manager.h</label>
        <link refid="d8/dd2/input__manager_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24468" relation="include">
        </childnode>
        <childnode refid="24486" relation="include">
        </childnode>
        <childnode refid="24503" relation="include">
        </childnode>
        <childnode refid="24504" relation="include">
        </childnode>
        <childnode refid="24506" relation="include">
        </childnode>
      </node>
      <node id="24523">
        <label>../game_renderer.h</label>
        <link refid="da/db1/game__renderer_8h"/>
        <childnode refid="24468" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24505" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24459" relation="include">
        </childnode>
        <childnode refid="24486" relation="include">
        </childnode>
        <childnode refid="24508" relation="include">
        </childnode>
      </node>
      <node id="24494">
        <label>exception</label>
      </node>
      <node id="24399">
        <label>stddef.h</label>
      </node>
      <node id="24471">
        <label>fstream</label>
      </node>
      <node id="24447">
        <label>ostream</label>
      </node>
      <node id="24480">
        <label>coord/coordmanager.h</label>
        <link refid="da/d63/coordmanager_8h"/>
        <childnode refid="24453" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
        <childnode refid="24459" relation="include">
        </childnode>
      </node>
      <node id="24420">
        <label>../log/message.h</label>
        <link refid="d2/d0d/message_8h"/>
        <childnode refid="24408" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24404" relation="include">
        </childnode>
        <childnode refid="24421" relation="include">
        </childnode>
        <childnode refid="24423" relation="include">
        </childnode>
        <childnode refid="24431" relation="include">
        </childnode>
        <childnode refid="24433" relation="include">
        </childnode>
      </node>
      <node id="24449">
        <label>limits.h</label>
      </node>
      <node id="24479">
        <label>loader_policy.h</label>
        <link refid="d2/d64/loader__policy_8h"/>
        <childnode refid="24447" relation="include">
        </childnode>
      </node>
      <node id="24464">
        <label>shader/shader.h</label>
        <link refid="d2/d22/shader_2shader_8h"/>
        <childnode refid="24465" relation="include">
        </childnode>
        <childnode refid="24461" relation="include">
        </childnode>
      </node>
      <node id="24434">
        <label>../util/enum.h</label>
        <link refid="d0/d9b/enum_8h"/>
        <childnode refid="24418" relation="include">
        </childnode>
        <childnode refid="24435" relation="include">
        </childnode>
        <childnode refid="24412" relation="include">
        </childnode>
      </node>
      <node id="24452">
        <label>coord_neseup.gen.h</label>
      </node>
      <node id="24476">
        <label>sound.h</label>
        <link refid="d9/d88/sound_8h"/>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24473" relation="include">
        </childnode>
      </node>
      <node id="24496">
        <label>job_state_base.h</label>
        <link refid="d3/d8b/job__state__base_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24497" relation="include">
        </childnode>
      </node>
      <node id="24468">
        <label>SDL2/SDL.h</label>
      </node>
      <node id="24474">
        <label>hash_functions.h</label>
        <link refid="df/dd0/hash__functions_8h"/>
        <childnode refid="24475" relation="include">
        </childnode>
        <childnode refid="24473" relation="include">
        </childnode>
      </node>
      <node id="24487">
        <label>job/job_manager.h</label>
        <link refid="d3/de6/job__manager_8h"/>
        <childnode refid="24424" relation="include">
        </childnode>
        <childnode refid="24488" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24411" relation="include">
        </childnode>
        <childnode refid="24489" relation="include">
        </childnode>
        <childnode refid="24490" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24491" relation="include">
        </childnode>
        <childnode refid="24498" relation="include">
        </childnode>
        <childnode refid="24499" relation="include">
        </childnode>
        <childnode refid="24500" relation="include">
        </childnode>
        <childnode refid="24496" relation="include">
        </childnode>
        <childnode refid="24497" relation="include">
        </childnode>
      </node>
      <node id="24488">
        <label>condition_variable</label>
      </node>
      <node id="24485">
        <label>guisys/public/gui_singleton_items_info.h</label>
        <link refid="da/ddd/gui__singleton__items__info_8h"/>
      </node>
      <node id="24500">
        <label>job_state.h</label>
        <link refid="d3/d6e/job__state_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24493" relation="include">
        </childnode>
        <childnode refid="24497" relation="include">
        </childnode>
      </node>
      <node id="24437">
        <label>file.h</label>
        <link refid="d2/d4d/file_8h"/>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24438" relation="include">
        </childnode>
        <childnode refid="24407" relation="include">
        </childnode>
      </node>
      <node id="24438">
        <label>filelike/filelike.h</label>
        <link refid="d7/db5/filelike_8h"/>
        <childnode refid="24418" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24412" relation="include">
        </childnode>
      </node>
      <node id="24435">
        <label>typeinfo</label>
      </node>
      <node id="24518">
        <label>bitset</label>
      </node>
      <node id="24458">
        <label>coord_xy.gen.h</label>
      </node>
      <node id="24475">
        <label>tuple</label>
      </node>
      <node id="24522">
        <label>ctime</label>
      </node>
      <node id="24396">
        <label>terrain.h</label>
        <link refid="d8/db6/terrain_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24399" relation="include">
        </childnode>
        <childnode refid="24400" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24403" relation="include">
        </childnode>
        <childnode refid="24440" relation="include">
        </childnode>
        <childnode refid="24453" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
        <childnode refid="24459" relation="include">
        </childnode>
        <childnode refid="24460" relation="include">
        </childnode>
        <childnode refid="24448" relation="include">
        </childnode>
      </node>
      <node id="24524">
        <label>terrain_chunk.h</label>
        <link refid="dd/deb/terrain__chunk_8h"/>
        <childnode refid="24399" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
        <childnode refid="24459" relation="include">
        </childnode>
        <childnode refid="24460" relation="include">
        </childnode>
        <childnode refid="24437" relation="include">
        </childnode>
      </node>
      <node id="24520">
        <label>unit_container.h</label>
        <link refid="d5/ddb/unit__container_8h"/>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24459" relation="include">
        </childnode>
        <childnode refid="24486" relation="include">
        </childnode>
        <childnode refid="24513" relation="include">
        </childnode>
      </node>
      <node id="24517">
        <label>ability.h</label>
        <link refid="df/d23/ability_8h"/>
        <childnode refid="24518" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24425" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24453" relation="include">
        </childnode>
        <childnode refid="24519" relation="include">
        </childnode>
      </node>
      <node id="24507">
        <label>stack</label>
      </node>
      <node id="24402">
        <label>vector</label>
      </node>
      <node id="24413">
        <label>ciso646</label>
      </node>
      <node id="24442">
        <label>../util/fixed_point.h</label>
        <link refid="de/d62/fixed__point_8h"/>
        <childnode refid="24443" relation="include">
        </childnode>
        <childnode refid="24444" relation="include">
        </childnode>
        <childnode refid="24445" relation="include">
        </childnode>
        <childnode refid="24429" relation="include">
        </childnode>
        <childnode refid="24446" relation="include">
        </childnode>
        <childnode refid="24447" relation="include">
        </childnode>
        <childnode refid="24425" relation="include">
        </childnode>
        <childnode refid="24448" relation="include">
        </childnode>
      </node>
      <node id="24470">
        <label>log/file_logsink.h</label>
        <link refid="de/d61/file__logsink_8h"/>
        <childnode refid="24418" relation="include">
        </childnode>
        <childnode refid="24471" relation="include">
        </childnode>
        <childnode refid="24431" relation="include">
        </childnode>
      </node>
      <node id="24454">
        <label>../util/hash.h</label>
        <link refid="db/dfb/hash_8h"/>
        <childnode refid="24422" relation="include">
        </childnode>
        <childnode refid="24455" relation="include">
        </childnode>
        <childnode refid="24456" relation="include">
        </childnode>
      </node>
      <node id="24409">
        <label>defs.h</label>
        <link refid="d5/d64/defs_8h"/>
      </node>
      <node id="24417">
        <label>../error/error.h</label>
        <link refid="d7/dce/error_2error_8h"/>
        <childnode refid="24418" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24419" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24412" relation="include">
        </childnode>
        <childnode refid="24420" relation="include">
        </childnode>
      </node>
      <node id="24483">
        <label>utility</label>
      </node>
      <node id="24455">
        <label>array</label>
      </node>
      <node id="24430">
        <label>sstream</label>
      </node>
      <node id="24525">
        <label>terrain_object.h</label>
        <link refid="d0/d94/terrain__object_8h"/>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24399" relation="include">
        </childnode>
        <childnode refid="24459" relation="include">
        </childnode>
        <childnode refid="24453" relation="include">
        </childnode>
      </node>
      <node id="24478">
        <label>format.h</label>
        <link refid="d0/d0a/format_8h"/>
        <childnode refid="24447" relation="include">
        </childnode>
      </node>
      <node id="24503">
        <label>action.h</label>
        <link refid="d9/d00/input_2action_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
        <childnode refid="24504" relation="include">
        </childnode>
      </node>
      <node id="24461">
        <label>epoxy/gl.h</label>
      </node>
      <node id="24509">
        <label>util/variable.h</label>
        <link refid="da/d89/variable_8h"/>
      </node>
      <node id="24510">
        <label>util/externalprofiler.h</label>
        <link refid="d6/d3a/externalprofiler_8h"/>
      </node>
      <node id="24481">
        <label>cvar/cvar.h</label>
        <link refid="dd/d54/cvar_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24482" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24483" relation="include">
        </childnode>
        <childnode refid="24410" relation="include">
        </childnode>
        <childnode refid="24406" relation="include">
        </childnode>
      </node>
      <node id="24462">
        <label>gamedata/texture.gen.h</label>
      </node>
      <node id="24436">
        <label>setup.h</label>
        <link refid="d7/df7/setup_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24412" relation="include">
        </childnode>
      </node>
      <node id="24412">
        <label>../util/compiler.h</label>
        <link refid="d4/dd1/compiler_8h"/>
        <childnode refid="24413" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24414" relation="include">
        </childnode>
      </node>
      <node id="24422">
        <label>cstdlib</label>
      </node>
      <node id="24459">
        <label>../coord/tile.h</label>
        <link refid="da/dce/tile_8h"/>
        <childnode refid="24441" relation="include">
        </childnode>
        <childnode refid="24451" relation="include">
        </childnode>
        <childnode refid="24452" relation="include">
        </childnode>
        <childnode refid="24448" relation="include">
        </childnode>
        <childnode refid="24454" relation="include">
        </childnode>
      </node>
      <node id="24433">
        <label>level.h</label>
        <link refid="de/d09/level_8h"/>
        <childnode refid="24434" relation="include">
        </childnode>
      </node>
      <node id="24418">
        <label>iostream</label>
      </node>
      <node id="24516">
        <label>unit/selection.h</label>
        <link refid="df/d48/selection_8h"/>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
        <childnode refid="24486" relation="include">
        </childnode>
        <childnode refid="24517" relation="include">
        </childnode>
        <childnode refid="24520" relation="include">
        </childnode>
      </node>
      <node id="24421">
        <label>../util/constexpr.h</label>
        <link refid="d1/d06/constexpr_8h"/>
        <childnode refid="24422" relation="include">
        </childnode>
      </node>
      <node id="24407">
        <label>../pyinterface/pyobject.h</label>
        <link refid="d2/d4b/pyobject_8h"/>
        <childnode refid="24408" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24409" relation="include">
        </childnode>
        <childnode refid="24410" relation="include">
        </childnode>
      </node>
      <node id="24460">
        <label>../texture.h</label>
        <link refid="df/dba/texture_8h"/>
        <childnode refid="24461" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24462" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
        <childnode refid="24459" relation="include">
        </childnode>
        <childnode refid="24463" relation="include">
        </childnode>
        <childnode refid="24464" relation="include">
        </childnode>
        <childnode refid="24406" relation="include">
        </childnode>
      </node>
      <node id="24427">
        <label>strings.h</label>
        <link refid="d6/d90/strings_8h"/>
        <childnode refid="24428" relation="include">
        </childnode>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24429" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24430" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
      </node>
      <node id="24401">
        <label>unordered_map</label>
      </node>
      <node id="24477">
        <label>resource_def.h</label>
        <link refid="de/db3/resource__def_8h"/>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24406" relation="include">
        </childnode>
        <childnode refid="24473" relation="include">
        </childnode>
        <childnode refid="24478" relation="include">
        </childnode>
        <childnode refid="24479" relation="include">
        </childnode>
      </node>
      <node id="24444">
        <label>climits</label>
      </node>
      <node id="24521">
        <label>screenshot.h</label>
        <link refid="dc/d9e/screenshot_8h"/>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24522" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
      </node>
      <node id="24411">
        <label>mutex</label>
      </node>
      <node id="24515">
        <label>chrono</label>
      </node>
      <node id="24490">
        <label>thread</label>
      </node>
      <node id="24495">
        <label>../util/thread_id.h</label>
        <link refid="d2/d4c/thread__id_8h"/>
        <childnode refid="24399" relation="include">
        </childnode>
      </node>
      <node id="24486">
        <label>handlers.h</label>
        <link refid="d0/dfb/handlers_8h"/>
        <childnode refid="24468" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
      </node>
      <node id="24441">
        <label>declarations.h</label>
        <link refid="db/d40/declarations_8h"/>
        <childnode refid="24408" relation="include">
        </childnode>
        <childnode refid="24442" relation="include">
        </childnode>
      </node>
      <node id="24423">
        <label>../util/stringformatter.h</label>
        <link refid="de/d65/stringformatter_8h"/>
        <childnode refid="24424" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24425" relation="include">
        </childnode>
        <childnode refid="24412" relation="include">
        </childnode>
        <childnode refid="24426" relation="include">
        </childnode>
        <childnode refid="24427" relation="include">
        </childnode>
      </node>
      <node id="24425">
        <label>type_traits</label>
      </node>
      <node id="24400">
        <label>set</label>
      </node>
      <node id="24404">
        <label>config.h</label>
      </node>
      <node id="24443">
        <label>algorithm</label>
      </node>
      <node id="24493">
        <label>typed_job_state_base.h</label>
        <link refid="da/d6c/typed__job__state__base_8h"/>
        <childnode refid="24424" relation="include">
        </childnode>
        <childnode refid="24494" relation="include">
        </childnode>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24495" relation="include">
        </childnode>
        <childnode refid="24417" relation="include">
        </childnode>
        <childnode refid="24492" relation="include">
        </childnode>
        <childnode refid="24496" relation="include">
        </childnode>
        <childnode refid="24497" relation="include">
        </childnode>
      </node>
      <node id="24406">
        <label>util/path.h</label>
        <link refid="d1/d11/util_2path_8h"/>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24407" relation="include">
        </childnode>
        <childnode refid="24437" relation="include">
        </childnode>
        <childnode refid="24439" relation="include">
        </childnode>
      </node>
      <node id="24467">
        <label>../engine.h</label>
        <link refid="d1/d55/engine_8h"/>
        <childnode refid="24408" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24468" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24469" relation="include">
        </childnode>
        <childnode refid="24466" relation="include">
        </childnode>
        <childnode refid="24470" relation="include">
        </childnode>
        <childnode refid="24472" relation="include">
        </childnode>
        <childnode refid="24480" relation="include">
        </childnode>
        <childnode refid="24453" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
        <childnode refid="24481" relation="include">
        </childnode>
        <childnode refid="24484" relation="include">
        </childnode>
        <childnode refid="24486" relation="include">
        </childnode>
        <childnode refid="24487" relation="include">
        </childnode>
        <childnode refid="24502" relation="include">
        </childnode>
        <childnode refid="24503" relation="include">
        </childnode>
        <childnode refid="24508" relation="include">
        </childnode>
        <childnode refid="24510" relation="include">
        </childnode>
        <childnode refid="24511" relation="include">
        </childnode>
        <childnode refid="24406" relation="include">
        </childnode>
        <childnode refid="24514" relation="include">
        </childnode>
        <childnode refid="24516" relation="include">
        </childnode>
        <childnode refid="24427" relation="include">
        </childnode>
        <childnode refid="24521" relation="include">
        </childnode>
      </node>
      <node id="24463">
        <label>shader/program.h</label>
        <link refid="d1/dea/program_8h"/>
        <childnode refid="24461" relation="include">
        </childnode>
      </node>
      <node id="24450">
        <label>cstring</label>
      </node>
      <node id="24395">
        <label>/mnt/c/Users/Jameson/Desktop/git/openage-new-doc-system/libopenage/terrain/terrain.cpp</label>
        <link refid="dc/dcd/terrain_8cpp"/>
        <childnode refid="24396" relation="include">
        </childnode>
        <childnode refid="24445" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24400" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24466" relation="include">
        </childnode>
        <childnode refid="24417" relation="include">
        </childnode>
        <childnode refid="24467" relation="include">
        </childnode>
        <childnode refid="24523" relation="include">
        </childnode>
        <childnode refid="24457" relation="include">
        </childnode>
        <childnode refid="24440" relation="include">
        </childnode>
        <childnode refid="24459" relation="include">
        </childnode>
        <childnode refid="24448" relation="include">
        </childnode>
        <childnode refid="24427" relation="include">
        </childnode>
        <childnode refid="24524" relation="include">
        </childnode>
        <childnode refid="24525" relation="include">
        </childnode>
      </node>
      <node id="24506">
        <label>input_context.h</label>
        <link refid="dd/d92/input__context_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24507" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24503" relation="include">
        </childnode>
        <childnode refid="24504" relation="include">
        </childnode>
      </node>
      <node id="24472">
        <label>audio/audio_manager.h</label>
        <link refid="da/d68/audio__manager_8h"/>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
        <childnode refid="24401" relation="include">
        </childnode>
        <childnode refid="24402" relation="include">
        </childnode>
        <childnode refid="24468" relation="include">
        </childnode>
        <childnode refid="24473" relation="include">
        </childnode>
        <childnode refid="24474" relation="include">
        </childnode>
        <childnode refid="24476" relation="include">
        </childnode>
        <childnode refid="24477" relation="include">
        </childnode>
      </node>
      <node id="24519">
        <label>../gamestate/resource.h</label>
        <link refid="df/d9c/gamestate_2resource_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24405" relation="include">
        </childnode>
      </node>
      <node id="24491">
        <label>abortable_job_state.h</label>
        <link refid="dd/ddf/abortable__job__state_8h"/>
        <childnode refid="24397" relation="include">
        </childnode>
        <childnode refid="24492" relation="include">
        </childnode>
        <childnode refid="24493" relation="include">
        </childnode>
        <childnode refid="24497" relation="include">
        </childnode>
      </node>
      <node id="24398">
        <label>memory</label>
      </node>
      <node id="24465">
        <label>initializer_list</label>
      </node>
      <node id="24456">
        <label>typeindex</label>
      </node>
      <node id="24501">
        <label>worker.h</label>
        <link refid="da/da5/worker_8h"/>
        <childnode refid="24424" relation="include">
        </childnode>
        <childnode refid="24488" relation="include">
        </childnode>
        <childnode refid="24398" relation="include">
        </childnode>
        <childnode refid="24489" relation="include">
        </childnode>
        <childnode refid="24490" relation="include">
        </childnode>
        <childnode refid="24496" relation="include">
        </childnode>
      </node>
      <node id="24492">
        <label>job_aborted_exception.h</label>
        <link refid="df/d29/job__aborted__exception_8h"/>
        <childnode refid="24419" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <innernamespace refid="da/d23/namespaceopenage">openage</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>2013-2019<sp/>the<sp/>openage<sp/>authors.<sp/>See<sp/>copying.md<sp/>for<sp/>legal<sp/>info.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="d8/db6/terrain_8h" kindref="compound">terrain.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cmath&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;memory&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;set&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;unordered_map&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../log/log.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../error/error.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../engine.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../game_renderer.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../coord/pixel.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../coord/chunk.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../coord/tile.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../util/misc.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../util/strings.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="dd/deb/terrain__chunk_8h" kindref="compound">terrain_chunk.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="d0/d94/terrain__object_8h" kindref="compound">terrain_object.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="da/d23/namespaceopenage" kindref="compound">openage</ref><sp/>{</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="25" refid="d3/dd0/classopenage_1_1_tile_content_1a5d266a55d460605258299b7950b1dfc1" refkind="member"><highlight class="normal"><ref refid="d3/dd0/classopenage_1_1_tile_content_1a5d266a55d460605258299b7950b1dfc1" kindref="member">TileContent::TileContent</ref>()<sp/>:</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>terrain_id{0}<sp/>{</highlight></codeline>
<codeline lineno="27"><highlight class="normal">}</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29" refid="d3/dd0/classopenage_1_1_tile_content_1aa9e037cf0a97b5a1957337f283747968" refkind="member"><highlight class="normal"><ref refid="d3/dd0/classopenage_1_1_tile_content_1aa9e037cf0a97b5a1957337f283747968" kindref="member">TileContent::~TileContent</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31" refid="d4/d15/classopenage_1_1_terrain_1a2cd98e5c07d94c82f4ccccf507885895" refkind="member"><highlight class="normal"><ref refid="d4/d15/classopenage_1_1_terrain_1a2cd98e5c07d94c82f4ccccf507885895" kindref="member">Terrain::Terrain</ref>(<ref refid="d3/dcb/structopenage_1_1terrain__meta" kindref="compound">terrain_meta</ref><sp/>*meta,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_infinite)</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>infinite{is_infinite},</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>{<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>}<sp/>{</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//this-&gt;limit_positive<sp/>=</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//this-&gt;limit_negative<sp/>=</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>maps<sp/>chunk<sp/>position<sp/>to<sp/>chunks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1addad1085e0e15e34f8abf6ec270d5137" kindref="member">chunks</ref><sp/>=<sp/>std::unordered_map&lt;coord::chunk,<sp/>TerrainChunk<sp/>*,<sp/>coord_chunk_hash&gt;{};</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal">}</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45" refid="d4/d15/classopenage_1_1_terrain_1a4855244807ea15873a7ecd3f25dcfc34" refkind="member"><highlight class="normal"><ref refid="d4/d15/classopenage_1_1_terrain_1a4855244807ea15873a7ecd3f25dcfc34" kindref="member">Terrain::~Terrain</ref>()<sp/>{</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d1a/namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Cleanup<sp/>terrain&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;chunk<sp/>:<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1addad1085e0e15e34f8abf6ec270d5137" kindref="member">chunks</ref>)<sp/>{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>chunk<sp/>was<sp/>autogenerated,<sp/>so<sp/>clean<sp/>it<sp/>up</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(chunk.second-&gt;manually_created<sp/>==<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal"><sp/>chunk.second;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="54"><highlight class="normal">}</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56" refid="d4/d15/classopenage_1_1_terrain_1a143090daace4caa26b8f0e9af5b4b69c" refkind="member"><highlight class="normal">std::vector&lt;coord::chunk&gt;<sp/><ref refid="d4/d15/classopenage_1_1_terrain_1a143090daace4caa26b8f0e9af5b4b69c" kindref="member">Terrain::used_chunks</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;coord::chunk&gt;<sp/><ref refid="d5/d0e/namespaceopenage_1_1testing_1_1testing_1ac25bf81db406af62d08113ef7ae9fd6e" kindref="member">result</ref>;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;c<sp/>:<sp/><ref refid="d4/d15/classopenage_1_1_terrain_1addad1085e0e15e34f8abf6ec270d5137" kindref="member">chunks</ref>)<sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result.push_back(c.first);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d5/d0e/namespaceopenage_1_1testing_1_1testing_1ac25bf81db406af62d08113ef7ae9fd6e" kindref="member">result</ref>;</highlight></codeline>
<codeline lineno="62"><highlight class="normal">}</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight></codeline>
<codeline lineno="64" refid="d4/d15/classopenage_1_1_terrain_1ac5f73cac07115849392bb22598ae8fba" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1ac5f73cac07115849392bb22598ae8fba" kindref="member">Terrain::fill</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*data,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="db/db5/structopenage_1_1coord_1_1tile__delta" kindref="compound">coord::tile_delta</ref><sp/>&amp;size)<sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>was_cut<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>pos<sp/>=<sp/>{0,<sp/>0};</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;<sp/>pos.ne<sp/>&lt;<sp/>size.ne;<sp/>pos.ne++)<sp/>{</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(pos.se<sp/>=<sp/>0;<sp/>pos.se<sp/>&lt;<sp/>size.se;<sp/>pos.se++)<sp/>{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1ab9457472de4a25ef737684e27d1d5810" kindref="member">check_tile</ref>(pos)<sp/>==<sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aafedb2d84cafe20862cb4399751a8a7e3" kindref="member">tile_state::invalid</ref>)<sp/>{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>was_cut<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>terrain_id<sp/>=<sp/>data[pos.ne<sp/>*<sp/>size.ne<sp/>+<sp/>pos.se];</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*chunk<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a7837ff925b6c466824b2388e55c198f4" kindref="member">get_create_chunk</ref>(pos);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chunk-&gt;<ref refid="d9/dab/classopenage_1_1_terrain_chunk_1af163db3fba4ae99206de76666f8424df" kindref="member">get_data</ref>(pos)-&gt;<ref refid="d3/dd0/classopenage_1_1_tile_content_1ac370821023f0c2e78ef4ab0c27c7bf09" kindref="member">terrain_id</ref><sp/>=<sp/>terrain_id;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>was_cut;</highlight></codeline>
<codeline lineno="80"><highlight class="normal">}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82" refid="d4/d15/classopenage_1_1_terrain_1af40a0b5e61397331f4efc9543f7fdd44" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1af40a0b5e61397331f4efc9543f7fdd44" kindref="member">Terrain::attach_chunk</ref>(<ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*new_chunk,</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="db/dac/structopenage_1_1coord_1_1chunk" kindref="compound">coord::chunk</ref><sp/>&amp;position,</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>manually_created)<sp/>{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>new_chunk-&gt;<ref refid="d9/dab/classopenage_1_1_terrain_chunk_1ae77efc0ad732593eddaeb1f34a1452ac" kindref="member">set_terrain</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>new_chunk-&gt;<ref refid="d9/dab/classopenage_1_1_terrain_chunk_1acae374402b048f40f7a730b5d05adcdc" kindref="member">manually_created</ref><sp/>=<sp/>manually_created;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d1a/namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Inserting<sp/>new<sp/>chunk<sp/>at<sp/>(&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>position.ne<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>position.se<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1addad1085e0e15e34f8abf6ec270d5137" kindref="member">chunks</ref>[position]<sp/>=<sp/>new_chunk;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d8/d91/structopenage_1_1chunk__neighbors" kindref="compound">chunk_neighbors</ref><sp/>neigh<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a9ce94c372f7e86310506844b352fb20c" kindref="member">get_chunk_neighbors</ref>(position);</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>8;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*neighbor<sp/>=<sp/>neigh.<ref refid="d8/d91/structopenage_1_1chunk__neighbors_1aa77bd299cd7666a9072e5eb7575eb578" kindref="member">neighbor</ref>[i];</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(neighbor<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>new<sp/>chunks<sp/>neighbor<sp/>to<sp/>the<sp/>neighbor<sp/>chunk</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_chunk-&gt;<ref refid="d9/dab/classopenage_1_1_terrain_chunk_1a6477efccb3a365d5b9ad716a306d4541" kindref="member">neighbors</ref>.<ref refid="d8/d91/structopenage_1_1chunk__neighbors_1aa77bd299cd7666a9072e5eb7575eb578" kindref="member">neighbor</ref>[i]<sp/>=<sp/>neighbor;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>neighbors<sp/>neighbor<sp/>on<sp/>the<sp/>opposite<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//to<sp/>the<sp/>new<sp/>chunk</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>neighbor-&gt;<ref refid="d9/dab/classopenage_1_1_terrain_chunk_1a6477efccb3a365d5b9ad716a306d4541" kindref="member">neighbors</ref>.<ref refid="d8/d91/structopenage_1_1chunk__neighbors_1aa77bd299cd7666a9072e5eb7575eb578" kindref="member">neighbor</ref>[(i+4)<sp/>%<sp/>8]<sp/>=<sp/>new_chunk;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d1a/namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Neighbor<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>i<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>gets<sp/>notified<sp/>of<sp/>new<sp/>neighbor.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d1a/namespaceopenage_1_1log_1a0eff614e7d6e818746700ed9d29e583f" kindref="member">log::log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Neighbor<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>i<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;<sp/>not<sp/>found.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="107"><highlight class="normal">}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109" refid="d4/d15/classopenage_1_1_terrain_1a6e0db07445c5dcc346c5e9d28458c516" refkind="member"><highlight class="normal"><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1a6e0db07445c5dcc346c5e9d28458c516" kindref="member">Terrain::get_chunk</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="db/dac/structopenage_1_1coord_1_1chunk" kindref="compound">coord::chunk</ref><sp/>&amp;position)<sp/>{</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>iter<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1addad1085e0e15e34f8abf6ec270d5137" kindref="member">chunks</ref>.find(position);</highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(iter<sp/>==<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1addad1085e0e15e34f8abf6ec270d5137" kindref="member">chunks</ref>.end())<sp/>{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>iter-&gt;second;</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="118"><highlight class="normal">}</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120" refid="d4/d15/classopenage_1_1_terrain_1a3c3153682d7a70b539ff15f492e0f06b" refkind="member"><highlight class="normal"><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1a6e0db07445c5dcc346c5e9d28458c516" kindref="member">Terrain::get_chunk</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>&amp;position)<sp/>{</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a6e0db07445c5dcc346c5e9d28458c516" kindref="member">get_chunk</ref>(position.<ref refid="d5/d10/structopenage_1_1coord_1_1tile_1a47c3fa2d9edf30712ddbc3b8ae217eb0" kindref="member">to_chunk</ref>());</highlight></codeline>
<codeline lineno="122"><highlight class="normal">}</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124" refid="d4/d15/classopenage_1_1_terrain_1a7837ff925b6c466824b2388e55c198f4" refkind="member"><highlight class="normal"><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1a7837ff925b6c466824b2388e55c198f4" kindref="member">Terrain::get_create_chunk</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="db/dac/structopenage_1_1coord_1_1chunk" kindref="compound">coord::chunk</ref><sp/>&amp;position)<sp/>{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*res<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a6e0db07445c5dcc346c5e9d28458c516" kindref="member">get_chunk</ref>(position);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(res<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>res<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref>();</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1af40a0b5e61397331f4efc9543f7fdd44" kindref="member">attach_chunk</ref>(res,<sp/>position,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>res;</highlight></codeline>
<codeline lineno="131"><highlight class="normal">}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133" refid="d4/d15/classopenage_1_1_terrain_1a9fc8a00464422b06cd5ea0dbda4c7d2f" refkind="member"><highlight class="normal"><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1a7837ff925b6c466824b2388e55c198f4" kindref="member">Terrain::get_create_chunk</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>&amp;position)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a7837ff925b6c466824b2388e55c198f4" kindref="member">get_create_chunk</ref>(position.<ref refid="d5/d10/structopenage_1_1coord_1_1tile_1a47c3fa2d9edf30712ddbc3b8ae217eb0" kindref="member">to_chunk</ref>());</highlight></codeline>
<codeline lineno="135"><highlight class="normal">}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137" refid="d4/d15/classopenage_1_1_terrain_1a437d04e21933a02a08861b50a585135e" refkind="member"><highlight class="normal"><ref refid="d3/dd0/classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1a437d04e21933a02a08861b50a585135e" kindref="member">Terrain::get_data</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>&amp;position)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*c<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a6e0db07445c5dcc346c5e9d28458c516" kindref="member">get_chunk</ref>(position.<ref refid="d5/d10/structopenage_1_1coord_1_1tile_1a47c3fa2d9edf30712ddbc3b8ae217eb0" kindref="member">to_chunk</ref>());</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>c-&gt;<ref refid="d9/dab/classopenage_1_1_terrain_chunk_1af163db3fba4ae99206de76666f8424df" kindref="member">get_data</ref>(position.<ref refid="d5/d10/structopenage_1_1coord_1_1tile_1ab4811e492cabe885d33e85df51ceff83" kindref="member">get_pos_on_chunk</ref>());</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="144"><highlight class="normal">}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146" refid="d4/d15/classopenage_1_1_terrain_1aa4d53dc392a6fd6da85ba49625d70478" refkind="member"><highlight class="normal"><ref refid="db/db3/classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1aa4d53dc392a6fd6da85ba49625d70478" kindref="member">Terrain::obj_at_point</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;point)<sp/>{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>t<sp/>=<sp/>point.<ref refid="d2/da4/structopenage_1_1coord_1_1phys3_1aa8aa4b7a7a76ddb625b8770ba12484d6" kindref="member">to_tile</ref>();</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d3/dd0/classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*tc<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a437d04e21933a02a08861b50a585135e" kindref="member">get_data</ref>(t);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tc)<sp/>{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>prioritise<sp/>selecting<sp/>the<sp/>smallest<sp/>object</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db/db3/classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*smallest<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>obj_ptr<sp/>:<sp/>tc-&gt;<ref refid="d3/dd0/classopenage_1_1_tile_content_1aaeff054a61d61cc0c65cfefcc78de233" kindref="member">obj</ref>)<sp/>{</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(obj_ptr-&gt;contains(point)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(!smallest<sp/>||<sp/>obj_ptr-&gt;<ref refid="db/db3/classopenage_1_1_terrain_object_1a6b82e5577be0620a320954e13d0f5f08" kindref="member">min_axis</ref>()<sp/>&lt;<sp/>smallest-&gt;<ref refid="db/db3/classopenage_1_1_terrain_object_1a6b82e5577be0620a320954e13d0f5f08" kindref="member">min_axis</ref>()))<sp/>{</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>smallest<sp/>=<sp/>obj_ptr;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>smallest;</highlight></codeline>
<codeline lineno="162"><highlight class="normal">}</highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight></codeline>
<codeline lineno="164" refid="d4/d15/classopenage_1_1_terrain_1a76cd02c887a27a6c91331573ecb84907" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1a76cd02c887a27a6c91331573ecb84907" kindref="member">Terrain::validate_terrain</ref>(<ref refid="da/d23/namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>terrain_id)<sp/>{</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(terrain_id<sp/>&gt;=<sp/>(ssize_t)this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>-&gt;<ref refid="d3/dcb/structopenage_1_1terrain__meta_1adac0256f3bb43b543864aba0079d84a8" kindref="member">terrain_id_count</ref>)<sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/><ref refid="d0/df4/classopenage_1_1error_1_1_error" kindref="compound">Error</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1ab6b4b10be67af93ab6c4d5a36139736e" kindref="member">err</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Requested<sp/>terrain_id<sp/>is<sp/>out<sp/>of<sp/>range:<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>terrain_id);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="171"><highlight class="normal">}</highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173" refid="d4/d15/classopenage_1_1_terrain_1adfa825aeaadbb2ce0a8dd13c335ffee1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1adfa825aeaadbb2ce0a8dd13c335ffee1" kindref="member">Terrain::validate_mask</ref>(ssize_t<sp/>mask_id)<sp/>{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mask_id<sp/>&gt;=<sp/>(ssize_t)this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>-&gt;<ref refid="d3/dcb/structopenage_1_1terrain__meta_1ac0a032b35502a554d168d791213ad74c" kindref="member">blendmode_count</ref>)<sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/><ref refid="d0/df4/classopenage_1_1error_1_1_error" kindref="compound">Error</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1ab6b4b10be67af93ab6c4d5a36139736e" kindref="member">err</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Requested<sp/>mask_id<sp/>is<sp/>out<sp/>of<sp/>range:<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>mask_id);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="180"><highlight class="normal">}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182" refid="d4/d15/classopenage_1_1_terrain_1a0de0b286ad2d9129d42b4f64e3ed9ffd" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1a0de0b286ad2d9129d42b4f64e3ed9ffd" kindref="member">Terrain::priority</ref>(<ref refid="da/d23/namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>terrain_id)<sp/>{</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a76cd02c887a27a6c91331573ecb84907" kindref="member">validate_terrain</ref>(terrain_id);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>-&gt;<ref refid="d3/dcb/structopenage_1_1terrain__meta_1a42422b3e85c83467828991b119ca216c" kindref="member">terrain_id_priority_map</ref>[terrain_id];</highlight></codeline>
<codeline lineno="185"><highlight class="normal">}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187" refid="d4/d15/classopenage_1_1_terrain_1ae5704a3d8f41acd79c3c3dca6f284ce7" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1ae5704a3d8f41acd79c3c3dca6f284ce7" kindref="member">Terrain::blendmode</ref>(<ref refid="da/d23/namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>terrain_id)<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a76cd02c887a27a6c91331573ecb84907" kindref="member">validate_terrain</ref>(terrain_id);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>-&gt;<ref refid="d3/dcb/structopenage_1_1terrain__meta_1ad4721fb504831e4c6797380603f3c734" kindref="member">terrain_id_blendmode_map</ref>[terrain_id];</highlight></codeline>
<codeline lineno="190"><highlight class="normal">}</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192" refid="d4/d15/classopenage_1_1_terrain_1a6e394fadeb8534aef0c7098939f25b23" refkind="member"><highlight class="normal"><ref refid="d4/d5b/classopenage_1_1_texture" kindref="compound">Texture</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1a6e394fadeb8534aef0c7098939f25b23" kindref="member">Terrain::texture</ref>(<ref refid="da/d23/namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>terrain_id)<sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a76cd02c887a27a6c91331573ecb84907" kindref="member">validate_terrain</ref>(terrain_id);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>-&gt;<ref refid="d3/dcb/structopenage_1_1terrain__meta_1a4b4c97d4834037b1ff79270d5c4876f7" kindref="member">textures</ref>[terrain_id];</highlight></codeline>
<codeline lineno="195"><highlight class="normal">}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="197" refid="d4/d15/classopenage_1_1_terrain_1a30da324d9ca8573bb3ac45bb12166298" refkind="member"><highlight class="normal"><ref refid="d4/d5b/classopenage_1_1_texture" kindref="compound">Texture</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1a30da324d9ca8573bb3ac45bb12166298" kindref="member">Terrain::blending_mask</ref>(ssize_t<sp/>mask_id)<sp/>{</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1adfa825aeaadbb2ce0a8dd13c335ffee1" kindref="member">validate_mask</ref>(mask_id);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>-&gt;<ref refid="d3/dcb/structopenage_1_1terrain__meta_1a2fdf2bb79faa0aa896e6f8cec3ffad72" kindref="member">blending_masks</ref>[mask_id];</highlight></codeline>
<codeline lineno="200"><highlight class="normal">}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202" refid="d4/d15/classopenage_1_1_terrain_1a88ec2ee796cfe5d6c97570ad73db43cc" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1a88ec2ee796cfe5d6c97570ad73db43cc" kindref="member">Terrain::get_subtexture_id</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>&amp;pos,<sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>atlas_size)<sp/>{</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/><ref refid="d5/d0e/namespaceopenage_1_1testing_1_1testing_1ac25bf81db406af62d08113ef7ae9fd6e" kindref="member">result</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>result<sp/>+=<sp/>util::mod&lt;coord::tile_t&gt;(pos.se,<sp/>atlas_size);</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>result<sp/>*=<sp/>atlas_size;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>result<sp/>+=<sp/>util::mod&lt;coord::tile_t&gt;(pos.ne,<sp/>atlas_size);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d5/d0e/namespaceopenage_1_1testing_1_1testing_1ac25bf81db406af62d08113ef7ae9fd6e" kindref="member">result</ref>;</highlight></codeline>
<codeline lineno="210"><highlight class="normal">}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212" refid="d4/d15/classopenage_1_1_terrain_1a9ce94c372f7e86310506844b352fb20c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d8/d91/structopenage_1_1chunk__neighbors" kindref="compound">chunk_neighbors</ref><sp/><ref refid="d4/d15/classopenage_1_1_terrain" kindref="compound">Terrain</ref>::<ref refid="d4/d15/classopenage_1_1_terrain_1a9ce94c372f7e86310506844b352fb20c" kindref="member">get_chunk_neighbors</ref>(const<sp/>coord::chunk<sp/>&amp;position)<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d8/d91/structopenage_1_1chunk__neighbors" kindref="compound">chunk_neighbors</ref><sp/>ret;</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>8;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db/dac/structopenage_1_1coord_1_1chunk" kindref="compound">coord::chunk</ref><sp/>tmp<sp/>{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>position.ne<sp/>+<sp/>(<ref refid="d1/d93/namespaceopenage_1_1coord_1a7ef0c2cf43638acb541a4c9d37bf9e24" kindref="member">coord::chunk_t</ref>)<sp/><ref refid="da/d23/namespaceopenage_1a46e91d5e7a9e134b40bddec3742b1c1e" kindref="member">neigh_offsets</ref>[i].ne,</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>position.se<sp/>+<sp/>(<ref refid="d1/d93/namespaceopenage_1_1coord_1a7ef0c2cf43638acb541a4c9d37bf9e24" kindref="member">coord::chunk_t</ref>)<sp/><ref refid="da/d23/namespaceopenage_1a46e91d5e7a9e134b40bddec3742b1c1e" kindref="member">neigh_offsets</ref>[i].se</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret.<ref refid="d8/d91/structopenage_1_1chunk__neighbors_1aa77bd299cd7666a9072e5eb7575eb578" kindref="member">neighbor</ref>[i]<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a6e0db07445c5dcc346c5e9d28458c516" kindref="member">get_chunk</ref>(tmp);</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ret;</highlight></codeline>
<codeline lineno="224"><highlight class="normal">}</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226" refid="d4/d15/classopenage_1_1_terrain_1aac2534a0373a7bbd8efdcf659977a881" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1aac2534a0373a7bbd8efdcf659977a881" kindref="member">Terrain::get_blending_mode</ref>(<ref refid="da/d23/namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>base_id,<sp/><ref refid="da/d23/namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>neighbor_id)<sp/>{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="228"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>this<sp/>function<sp/>may<sp/>require<sp/>much<sp/>more<sp/>code,<sp/>but<sp/>this<sp/>simple</highlight></codeline>
<codeline lineno="229"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>magnitude<sp/>comparison<sp/>seems<sp/>to<sp/>do<sp/>the<sp/>job.</highlight></codeline>
<codeline lineno="230"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>feel<sp/>free<sp/>to<sp/>confirm<sp/>or<sp/>fix<sp/>the<sp/>behavior.</highlight></codeline>
<codeline lineno="231"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="232"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>my<sp/>guess<sp/>is<sp/>that<sp/>the<sp/>blending<sp/>mode<sp/>encodes<sp/>another<sp/>information</highlight></codeline>
<codeline lineno="233"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>not<sp/>publicly<sp/>noticed<sp/>yet:<sp/>the<sp/>overlay<sp/>priority.</highlight></codeline>
<codeline lineno="234"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>the<sp/>higher<sp/>the<sp/>blendmode<sp/>id,<sp/>the<sp/>higher<sp/>the<sp/>mode<sp/>priority.</highlight></codeline>
<codeline lineno="235"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>this<sp/>may<sp/>also<sp/>be<sp/>the<sp/>reason<sp/>why<sp/>there<sp/>are<sp/>mask<sp/>duplicates</highlight></codeline>
<codeline lineno="236"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>in<sp/>blendomatic.dat</highlight></codeline>
<codeline lineno="237"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="238"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>funny<sp/>enough,<sp/>just<sp/>using<sp/>the<sp/>modes<sp/>in<sp/>the<sp/>dat<sp/>file<sp/>lead</highlight></codeline>
<codeline lineno="239"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>a<sp/>totally<sp/>wrong<sp/>render.<sp/>the<sp/>convert<sp/>script<sp/>reassigns<sp/>the</highlight></codeline>
<codeline lineno="240"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>blending<sp/>modes<sp/>with<sp/>a<sp/>simple<sp/>key=&gt;val<sp/>mapping,</highlight></codeline>
<codeline lineno="241"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>after<sp/>that,<sp/>it<sp/>looks<sp/>perfect.</highlight></codeline>
<codeline lineno="242"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>base_mode<sp/><sp/><sp/><sp/><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1ae5704a3d8f41acd79c3c3dca6f284ce7" kindref="member">blendmode</ref>(base_id);</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>neighbor_mode<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1ae5704a3d8f41acd79c3c3dca6f284ce7" kindref="member">blendmode</ref>(neighbor_id);</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(neighbor_mode<sp/>&gt;<sp/>base_mode)<sp/>{</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>neighbor_mode;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>base_mode;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal">}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254" refid="d4/d15/classopenage_1_1_terrain_1ab9457472de4a25ef737684e27d1d5810" refkind="member"><highlight class="normal"><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4a" kindref="member">tile_state</ref><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1ab9457472de4a25ef737684e27d1d5810" kindref="member">Terrain::check_tile</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>&amp;position)<sp/>{</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0e35745e96c0b263a74dcf2ec2abffb" kindref="member">check_tile_position</ref>(position))<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aafedb2d84cafe20862cb4399751a8a7e3" kindref="member">tile_state::invalid</ref>;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dab/classopenage_1_1_terrain_chunk" kindref="compound">TerrainChunk</ref><sp/>*chunk<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a6e0db07445c5dcc346c5e9d28458c516" kindref="member">get_chunk</ref>(position);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(chunk<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aa3035da8cd016b46a243c7230ac213cb6" kindref="member">tile_state::creatable</ref>;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aaf4e0ac58eb46d88efc451c164db3b837" kindref="member">tile_state::existing</ref>;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="267"><highlight class="normal">}</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269" refid="d4/d15/classopenage_1_1_terrain_1aa0e35745e96c0b263a74dcf2ec2abffb" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1aa0e35745e96c0b263a74dcf2ec2abffb" kindref="member">Terrain::check_tile_position</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>&amp;</highlight><highlight class="comment">/*pos*/</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a59ab681b936ea55851dcbffb4e90b7a0" kindref="member">infinite</ref>)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/><ref refid="d0/df4/classopenage_1_1error_1_1_error" kindref="compound">Error</ref>(<ref refid="d2/d0d/message_8h_1a735563036dced0b7d6cc98f97ea4978b" kindref="member">ERR</ref><sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;non-infinite<sp/>terrains<sp/>are<sp/>not<sp/>supported<sp/>yet&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="276"><highlight class="normal">}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278" refid="d4/d15/classopenage_1_1_terrain_1ae8e6bd38cdaa86dcff31251de1c6deec" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1ae8e6bd38cdaa86dcff31251de1c6deec" kindref="member">Terrain::draw</ref>(<ref refid="d6/d40/classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>*<ref refid="d3/d8f/namespaceopenage_1_1gui_1af04609e6ca54bc68fde786f6bb33f14e" kindref="member">engine</ref>,<sp/><ref refid="dd/df6/classopenage_1_1_render_options" kindref="compound">RenderOptions</ref><sp/>*settings)<sp/>{</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>move<sp/>this<sp/>draw<sp/>invokation<sp/>to<sp/>a<sp/>render<sp/>manager.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>it<sp/>can<sp/>reorder<sp/>the<sp/>draw<sp/>instructions<sp/>and<sp/>minimize<sp/>texture<sp/>switching.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>query<sp/>the<sp/>window<sp/>coordinates<sp/>from<sp/>the<sp/>engine<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/dcd/structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref><sp/>wbl<sp/>=<sp/><ref refid="d2/dcd/structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref>{0,<sp/>0};</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/dcd/structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref><sp/>wbr<sp/>=<sp/><ref refid="d2/dcd/structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref>{engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>.<ref refid="de/db5/classopenage_1_1coord_1_1_coord_manager_1a5dae949d1b16387cee8ea1d865884507" kindref="member">viewport_size</ref>.x,<sp/>0};</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/dcd/structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref><sp/>wtl<sp/>=<sp/><ref refid="d2/dcd/structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref>{0,<sp/>engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>.<ref refid="de/db5/classopenage_1_1coord_1_1_coord_manager_1a5dae949d1b16387cee8ea1d865884507" kindref="member">viewport_size</ref>.y};</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/dcd/structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref><sp/>wtr<sp/>=<sp/><ref refid="d2/dcd/structopenage_1_1coord_1_1viewport" kindref="compound">coord::viewport</ref>{engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>.<ref refid="de/db5/classopenage_1_1coord_1_1_coord_manager_1a5dae949d1b16387cee8ea1d865884507" kindref="member">viewport_size</ref>.x,<sp/>engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>.<ref refid="de/db5/classopenage_1_1coord_1_1_coord_manager_1a5dae949d1b16387cee8ea1d865884507" kindref="member">viewport_size</ref>.y};</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>top<sp/>left,<sp/>bottom<sp/>right<sp/>tile<sp/>coordinates</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>that<sp/>are<sp/>currently<sp/>visible<sp/>in<sp/>the<sp/>window</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>convert<sp/>them<sp/>to<sp/>tile<sp/>coordinates.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>tl<sp/>=<sp/>wtl.<ref refid="d2/dcd/structopenage_1_1coord_1_1viewport_1ad78ba1b1f9b64caa7b6eda78aaf7513a" kindref="member">to_tile</ref>(engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>tr<sp/>=<sp/>wtr.<ref refid="d2/dcd/structopenage_1_1coord_1_1viewport_1ad78ba1b1f9b64caa7b6eda78aaf7513a" kindref="member">to_tile</ref>(engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>bl<sp/>=<sp/>wbl.<ref refid="d2/dcd/structopenage_1_1coord_1_1viewport_1ad78ba1b1f9b64caa7b6eda78aaf7513a" kindref="member">to_tile</ref>(engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>br<sp/>=<sp/>wbr.<ref refid="d2/dcd/structopenage_1_1coord_1_1viewport_1ad78ba1b1f9b64caa7b6eda78aaf7513a" kindref="member">to_tile</ref>(engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>);</highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>main<sp/>terrain<sp/>calculation<sp/>call:<sp/>get<sp/>the<sp/>`terrain_render_data`</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>draw_data<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1ab0736d57ce5014c9caea96125ad87b0d" kindref="member">create_draw_advice</ref>(tl,<sp/>tr,<sp/>br,<sp/>bl,<sp/>settings-&gt;<ref refid="dd/df6/classopenage_1_1_render_options_1afa9ff97e7c4c0d15f01e0765f9a05ce0" kindref="member">terrain_blending</ref>.<ref refid="df/d2d/classopenage_1_1util_1_1_variable_1a2a5e67f8f00e6d539210f496513633b5" kindref="member">value</ref>);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>the<sp/>following<sp/>loop<sp/>is<sp/>totally<sp/>inefficient<sp/>and<sp/>shit.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>it<sp/>reloads<sp/>the<sp/>drawing<sp/>texture<sp/>to<sp/>the<sp/>gpu<sp/>FOR<sp/>EACH<sp/>TILE!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>nevertheless,<sp/>currently<sp/>it<sp/>works.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>draw<sp/>the<sp/>terrain<sp/>ground</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;tile<sp/>:<sp/>draw_data.tiles)<sp/>{</highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>over<sp/>all<sp/>layers<sp/>to<sp/>be<sp/>drawn</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>tile.count;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="db/dde/structopenage_1_1tile__data" kindref="compound">tile_data</ref><sp/>*layer<sp/>=<sp/>&amp;tile.data[i];</highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>position,<sp/>where<sp/>the<sp/>tile<sp/>is<sp/>drawn</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>tile_pos<sp/>=<sp/>layer-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1abf5ae33e043c9877c1312b583fddcffa" kindref="member">pos</ref>;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>mask_id<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>layer-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1aef74e061ba5aea22401f1c443423afb9" kindref="member">mask_id</ref>;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d4/d5b/classopenage_1_1_texture" kindref="compound">Texture</ref><sp/>*<ref refid="d4/d15/classopenage_1_1_terrain_1a6e394fadeb8534aef0c7098939f25b23" kindref="member">texture</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>layer-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1ad9e49e097703a4386dac3b90bdc02d5e" kindref="member">tex</ref>;</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>subtexture_id<sp/>=<sp/>layer-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1acd0094b0c8a95d0499c5f2b6d57b12a1" kindref="member">subtexture_id</ref>;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d4/d5b/classopenage_1_1_texture" kindref="compound">Texture</ref><sp/>*<ref refid="db/da3/namespaceopenage_1_1alphamask__shader_1a64874bd7ffd0c4f356826976af477bb3" kindref="member">mask_texture</ref><sp/><sp/>=<sp/>layer-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1aafb07c8fa1ecda12f76b957bb0b972ed" kindref="member">mask_tex</ref>;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>texture-&gt;<ref refid="d4/d5b/classopenage_1_1_texture_1a0bb8ecfa34c39de191c45b95139da3ed" kindref="member">draw</ref>(engine-&gt;<ref refid="d6/d40/classopenage_1_1_engine_1ad5478f5f2e6dba3a8b4aab3fe828ef3c" kindref="member">coord</ref>,<sp/>*</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/>tile_pos,<sp/><ref refid="da/d23/namespaceopenage_1a8f58bd5706ab9adf5f5905a0966d188a" kindref="member">ALPHAMASKED</ref>,<sp/>subtexture_id,<sp/>mask_texture,<sp/>mask_id);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>drawing<sp/>buildings<sp/>can&apos;t<sp/>be<sp/>the<sp/>job<sp/>of<sp/>the<sp/>terrain..</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>draw<sp/>the<sp/>buildings</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;</highlight><highlight class="keywordtype">object</highlight><highlight class="normal"><sp/>:<sp/>draw_data.objects)<sp/>{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">object</highlight><highlight class="normal">-&gt;draw(*engine);</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="327"><highlight class="normal">}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329" refid="d4/d15/classopenage_1_1_terrain_1ab0736d57ce5014c9caea96125ad87b0d" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d1/daf/structopenage_1_1terrain__render__data" kindref="compound">terrain_render_data</ref><sp/><ref refid="d4/d15/classopenage_1_1_terrain" kindref="compound">Terrain</ref>::<ref refid="d4/d15/classopenage_1_1_terrain_1ab0736d57ce5014c9caea96125ad87b0d" kindref="member">create_draw_advice</ref>(const<sp/>coord::tile<sp/>&amp;ab,</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>coord::tile<sp/>&amp;cd,</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>coord::tile<sp/>&amp;ef,</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>coord::tile<sp/>&amp;gh,</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bool<sp/>blending_enabled)<sp/>{</highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="336"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>passed<sp/>parameters<sp/>define<sp/>the<sp/>screen<sp/>corners.</highlight></codeline>
<codeline lineno="337"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="338"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>ne,<sp/>se<sp/>coordinates</highlight></codeline>
<codeline lineno="339"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>o<sp/>=<sp/>screen<sp/>corner,<sp/>where<sp/>the<sp/>tile<sp/>coordinates<sp/>can<sp/>be<sp/>queried.</highlight></codeline>
<codeline lineno="340"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>x<sp/>=<sp/>corner<sp/>of<sp/>the<sp/>rhombus<sp/>that<sp/>will<sp/>be<sp/>drawn,<sp/>calculated<sp/>by<sp/>all<sp/>o.</highlight></codeline>
<codeline lineno="341"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="342"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cb</highlight></codeline>
<codeline lineno="343"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x</highlight></codeline>
<codeline lineno="344"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/><sp/><sp/>.</highlight></codeline>
<codeline lineno="345"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/><sp/><sp/><sp/><sp/><sp/><sp/>.</highlight></codeline>
<codeline lineno="346"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ab<sp/>o===========o<sp/>cd</highlight></codeline>
<codeline lineno="347"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/>=<sp/><sp/>visible<sp/><sp/>=<sp/>.</highlight></codeline>
<codeline lineno="348"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/>gb<sp/>x<sp/><sp/><sp/>=<sp/><sp/>screen<sp/><sp/><sp/>=<sp/><sp/><sp/>x<sp/>cf</highlight></codeline>
<codeline lineno="349"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/>=<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>.</highlight></codeline>
<codeline lineno="350"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gh<sp/>o===========o<sp/>ef</highlight></codeline>
<codeline lineno="351"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/><sp/><sp/><sp/><sp/><sp/><sp/>.</highlight></codeline>
<codeline lineno="352"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/><sp/><sp/>.</highlight></codeline>
<codeline lineno="353"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x</highlight></codeline>
<codeline lineno="354"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gf</highlight></codeline>
<codeline lineno="355"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="356"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>rendering<sp/>area<sp/>may<sp/>be<sp/>optimized<sp/>further<sp/>in<sp/>the<sp/>future,</highlight></codeline>
<codeline lineno="357"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>exactly<sp/>fit<sp/>the<sp/>visible<sp/>screen.</highlight></codeline>
<codeline lineno="358"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>For<sp/>now,<sp/>we<sp/>are<sp/>drawing<sp/>the<sp/>big<sp/>rhombus.</highlight></codeline>
<codeline lineno="359"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>procedure:<sp/>find<sp/>all<sp/>the<sp/>tiles<sp/>to<sp/>be<sp/>drawn</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>store<sp/>them<sp/>to<sp/>a<sp/>tile<sp/>drawing<sp/>instruction<sp/>structure</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d1/daf/structopenage_1_1terrain__render__data" kindref="compound">terrain_render_data</ref><sp/>data;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>vector<sp/>of<sp/>tiles<sp/>to<sp/>be<sp/>drawn</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;struct<sp/>tile_draw_data&gt;<sp/>*tiles<sp/>=<sp/>&amp;data.<ref refid="d1/daf/structopenage_1_1terrain__render__data_1ad5b2392d7b810a03e69bdfaa2819376b" kindref="member">tiles</ref>;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ordered<sp/>set<sp/>of<sp/>objects<sp/>on<sp/>the<sp/>terrain<sp/>(buildings.)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>it&apos;s<sp/>ordered<sp/>by<sp/>the<sp/>visibility<sp/>layers.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>objects<sp/>=<sp/>&amp;data.<ref refid="d1/daf/structopenage_1_1terrain__render__data_1ad81ef86c42feed78b16041c4be633fda" kindref="member">objects</ref>;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>gb<sp/>=<sp/>{gh.ne,<sp/>ab.se};</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>cf<sp/>=<sp/>{cd.ne,<sp/>ef.se};</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>hint<sp/>the<sp/>vector<sp/>about<sp/>the<sp/>number<sp/>of<sp/>tiles<sp/>it<sp/>will<sp/>contain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>tiles_count<sp/>=<sp/><ref refid="d8/dcc/namespacestd_1a6af851cc1249a970adde4dc422ff824a" kindref="member">std::abs</ref>(cf.ne<sp/>-<sp/>gb.ne)<sp/>*<sp/><ref refid="d8/dcc/namespacestd_1a6af851cc1249a970adde4dc422ff824a" kindref="member">std::abs</ref>(cf.se<sp/>-<sp/>gb.se);</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>tiles-&gt;reserve(tiles_count);</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sweep<sp/>the<sp/>whole<sp/>rhombus<sp/>area</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>tilepos<sp/>=<sp/>gb;<sp/>tilepos.ne<sp/>&lt;=<sp/>cf.ne;<sp/>tilepos.ne++)<sp/>{</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(tilepos.se<sp/>=<sp/>gb.se;<sp/>tilepos.se<sp/>&lt;=<sp/>cf.se;<sp/>tilepos.se++)<sp/>{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>terrain<sp/>tile<sp/>drawing<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>tile<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a16e91ba2a775715dc81088e47e508786" kindref="member">create_tile_advice</ref>(tilepos,<sp/>blending_enabled);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tiles-&gt;push_back(tile);</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>object<sp/>standing<sp/>on<sp/>the<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>make<sp/>the<sp/>terrain<sp/>independent<sp/>of<sp/>objects<sp/>standing<sp/>on<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d3/dd0/classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*tile_content<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a437d04e21933a02a08861b50a585135e" kindref="member">get_data</ref>(tilepos);</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tile_content<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>obj_item<sp/>:<sp/>tile_content-&gt;<ref refid="d3/dd0/classopenage_1_1_tile_content_1aaeff054a61d61cc0c65cfefcc78de233" kindref="member">obj</ref>)<sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>objects-&gt;insert(obj_item);</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data;</highlight></codeline>
<codeline lineno="399"><highlight class="normal">}</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight></codeline>
<codeline lineno="402" refid="d4/d15/classopenage_1_1_terrain_1a16e91ba2a775715dc81088e47e508786" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d7/d14/structopenage_1_1tile__draw__data" kindref="compound">tile_draw_data</ref><sp/><ref refid="d4/d15/classopenage_1_1_terrain" kindref="compound">Terrain</ref>::<ref refid="d4/d15/classopenage_1_1_terrain_1a16e91ba2a775715dc81088e47e508786" kindref="member">create_tile_advice</ref>(coord::tile<sp/>position,<sp/>bool<sp/>blending_enabled)<sp/>{</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>struct<sp/>will<sp/>be<sp/>filled<sp/>with<sp/>all<sp/>tiles<sp/>and<sp/>overlays<sp/>to<sp/>draw.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d7/d14/structopenage_1_1tile__draw__data" kindref="compound">tile_draw_data</ref><sp/>tile;</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/>tile.<ref refid="d7/d14/structopenage_1_1tile__draw__data_1a6df5238236b9996b79e44bd59f4d2b46" kindref="member">count</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d3/dd0/classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*base_tile_content<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a437d04e21933a02a08861b50a585135e" kindref="member">get_data</ref>(position);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>chunk<sp/>of<sp/>this<sp/>tile<sp/>does<sp/>not<sp/>exist</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(base_tile_content<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>tile;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="db/dde/structopenage_1_1tile__data" kindref="compound">tile_data</ref><sp/>base_tile_data;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>base<sp/>terrain<sp/>id<sp/>of<sp/>the<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1af0b5bcdebb37222eb9d443033ec97aff" kindref="member">terrain_id</ref><sp/>=<sp/>base_tile_content-&gt;<ref refid="d3/dd0/classopenage_1_1_tile_content_1ac370821023f0c2e78ef4ab0c27c7bf09" kindref="member">terrain_id</ref>;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>base<sp/>terrain<sp/>is<sp/>not<sp/>existant.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1af0b5bcdebb37222eb9d443033ec97aff" kindref="member">terrain_id</ref><sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>tile;</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a76cd02c887a27a6c91331573ecb84907" kindref="member">validate_terrain</ref>(base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1af0b5bcdebb37222eb9d443033ec97aff" kindref="member">terrain_id</ref>);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d4/d5b/classopenage_1_1_texture" kindref="compound">Texture</ref><sp/>*tex<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a6e394fadeb8534aef0c7098939f25b23" kindref="member">texture</ref>(base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1af0b5bcdebb37222eb9d443033ec97aff" kindref="member">terrain_id</ref>);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1a7e05c08e74c2be5e11d6c86f4ffc291c" kindref="member">state</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aaf4e0ac58eb46d88efc451c164db3b837" kindref="member">tile_state::existing</ref>;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1abf5ae33e043c9877c1312b583fddcffa" kindref="member">pos</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>position;</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1a820454b286bedff8df818d0c47c58695" kindref="member">priority</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a0de0b286ad2d9129d42b4f64e3ed9ffd" kindref="member">priority</ref>(base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1af0b5bcdebb37222eb9d443033ec97aff" kindref="member">terrain_id</ref>);</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1ad9e49e097703a4386dac3b90bdc02d5e" kindref="member">tex</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>tex;</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1acd0094b0c8a95d0499c5f2b6d57b12a1" kindref="member">subtexture_id</ref><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a88ec2ee796cfe5d6c97570ad73db43cc" kindref="member">get_subtexture_id</ref>(</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>position,</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/dcc/namespacestd_1a0fc492a11cf74e80f976b24bea2a2eb2" kindref="member">std::sqrt</ref>(tex-&gt;<ref refid="d4/d5b/classopenage_1_1_texture_1a4548b2bc3eb5310a97deee94ab536035" kindref="member">get_subtexture_count</ref>())</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1a43ad7a45a29a2056ff8300633478c62e" kindref="member">blend_mode</ref><sp/><sp/><sp/><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1aafb07c8fa1ecda12f76b957bb0b972ed" kindref="member">mask_tex</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>base_tile_data.<ref refid="db/dde/structopenage_1_1tile__data_1aef74e061ba5aea22401f1c443423afb9" kindref="member">mask_id</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/>tile.<ref refid="d7/d14/structopenage_1_1tile__draw__data_1abb735fac94699d37947a4456ac4177a9" kindref="member">data</ref>[tile.<ref refid="d7/d14/structopenage_1_1tile__draw__data_1a6df5238236b9996b79e44bd59f4d2b46" kindref="member">count</ref>]<sp/>=<sp/>base_tile_data;</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/>tile.<ref refid="d7/d14/structopenage_1_1tile__draw__data_1a6df5238236b9996b79e44bd59f4d2b46" kindref="member">count</ref><sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>blendomatic!!111</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>see<sp/>doc/media/blendomatic<sp/>for<sp/>the<sp/>idea<sp/>behind<sp/>this.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(blending_enabled)<sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>neighbors<sp/>of<sp/>the<sp/>base<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d7/d21/structopenage_1_1neighbor__tile" kindref="compound">neighbor_tile</ref><sp/>neigh_data[8];</highlight></codeline>
<codeline lineno="449"><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>all<sp/>neighbor<sp/>tiles<sp/>around<sp/>position,<sp/>reset<sp/>the<sp/>influence<sp/>directions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1adf4e2cfb2010657a5384efc6c37a9748" kindref="member">get_neighbors</ref>(position,<sp/>neigh_data,<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>-&gt;<ref refid="d3/dcb/structopenage_1_1terrain__meta_1a80c4c8312262c03a979437c70a3eb4eb" kindref="member">influences_buf</ref>.get());</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>influence<sp/>list<sp/>(direction,<sp/>priority)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>strip<sp/>and<sp/>order<sp/>influences,<sp/>get<sp/>the<sp/>final<sp/>influence<sp/>data<sp/>structure</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d9/d65/structopenage_1_1influence__group" kindref="compound">influence_group</ref><sp/>influence_group<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a202cab41ccd1d5af5e0e7a5e658f3f30" kindref="member">calculate_influences</ref>(</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;base_tile_data,<sp/>neigh_data,</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aa0970b751b0d154bfa6be8c4f6dc850d" kindref="member">meta</ref>-&gt;<ref refid="d3/dcb/structopenage_1_1terrain__meta_1a80c4c8312262c03a979437c70a3eb4eb" kindref="member">influences_buf</ref>.get()</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>the<sp/>draw_masks<sp/>from<sp/>the<sp/>calculated<sp/>influences</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a72f81eb7623d4ade8272f8163bfcb4d9" kindref="member">calculate_masks</ref>(position,<sp/>&amp;tile,<sp/>&amp;influence_group);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="463"><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>tile;</highlight></codeline>
<codeline lineno="465"><highlight class="normal">}</highlight></codeline>
<codeline lineno="466"><highlight class="normal"></highlight></codeline>
<codeline lineno="467" refid="d4/d15/classopenage_1_1_terrain_1adf4e2cfb2010657a5384efc6c37a9748" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1adf4e2cfb2010657a5384efc6c37a9748" kindref="member">Terrain::get_neighbors</ref>(<ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>basepos,</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d7/d21/structopenage_1_1neighbor__tile" kindref="compound">neighbor_tile</ref><sp/>*neigh_data,</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d6/d08/structopenage_1_1influence" kindref="compound">influence</ref><sp/>*influences_by_terrain_id)<sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>walk<sp/>over<sp/>all<sp/>given<sp/>neighbor<sp/>tiles<sp/>and<sp/>store<sp/>them<sp/>to<sp/>the<sp/>influence<sp/>list,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>group<sp/>them<sp/>by<sp/>terrain<sp/>id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>neigh_id<sp/>=<sp/>0;<sp/>neigh_id<sp/>&lt;<sp/>8;<sp/>neigh_id++)<sp/>{</highlight></codeline>
<codeline lineno="475"><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>current<sp/>neighbor</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>neighbor<sp/>=<sp/>&amp;neigh_data[neigh_id];</highlight></codeline>
<codeline lineno="478"><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>calculate<sp/>the<sp/>pos<sp/>of<sp/>the<sp/>neighbor<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>neigh_pos<sp/>=<sp/>basepos<sp/>+<sp/><ref refid="da/d23/namespaceopenage_1a46e91d5e7a9e134b40bddec3742b1c1e" kindref="member">neigh_offsets</ref>[neigh_id];</highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>neighbor<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d3/dd0/classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*neigh_content<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a437d04e21933a02a08861b50a585135e" kindref="member">get_data</ref>(neigh_pos);</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>chunk<sp/>for<sp/>neighbor<sp/>or<sp/>single<sp/>tile<sp/>is<sp/>not<sp/>existant</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(neigh_content<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal"><sp/>||<sp/>neigh_content-&gt;<ref refid="d3/dd0/classopenage_1_1_tile_content_1ac370821023f0c2e78ef4ab0c27c7bf09" kindref="member">terrain_id</ref><sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>neighbor-&gt;state<sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aaea21841da70e6405af19fabc4ff8bdd9" kindref="member">tile_state::missing</ref>;</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>neighbor-&gt;terrain_id<sp/>=<sp/>neigh_content-&gt;<ref refid="d3/dd0/classopenage_1_1_tile_content_1ac370821023f0c2e78ef4ab0c27c7bf09" kindref="member">terrain_id</ref>;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>neighbor-&gt;state<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aaf4e0ac58eb46d88efc451c164db3b837" kindref="member">tile_state::existing</ref>;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>neighbor-&gt;priority<sp/><sp/><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a0de0b286ad2d9129d42b4f64e3ed9ffd" kindref="member">priority</ref>(neighbor-&gt;terrain_id);</highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>reset<sp/>influence<sp/>directions<sp/>for<sp/>this<sp/>tile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>influences_by_terrain_id[neighbor-&gt;terrain_id].<ref refid="d6/d08/structopenage_1_1influence_1ae2f8c30c2afb451327be4a424c1d34a0" kindref="member">direction</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="498"><highlight class="normal">}</highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight></codeline>
<codeline lineno="500" refid="d4/d15/classopenage_1_1_terrain_1a202cab41ccd1d5af5e0e7a5e658f3f30" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d9/d65/structopenage_1_1influence__group" kindref="compound">influence_group</ref><sp/><ref refid="d4/d15/classopenage_1_1_terrain" kindref="compound">Terrain</ref>::<ref refid="d4/d15/classopenage_1_1_terrain_1a202cab41ccd1d5af5e0e7a5e658f3f30" kindref="member">calculate_influences</ref>(struct<sp/>tile_data<sp/>*base_tile,</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>struct<sp/>neighbor_tile<sp/>*neigh_data,</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>struct<sp/>influence<sp/>*influences_by_terrain_id)<sp/>{</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>influences<sp/>to<sp/>actually<sp/>draw<sp/>(-&gt;<sp/>maximum<sp/>8)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d9/d65/structopenage_1_1influence__group" kindref="compound">influence_group</ref><sp/>influences;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1a45caedf1c1dd3ff9b8a74d0284e6e45e" kindref="member">count</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>process<sp/>adjacent<sp/>neighbors<sp/>first,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>add<sp/>diagonal<sp/>influences,<sp/>if<sp/>no<sp/>adjacent<sp/>influence<sp/>was<sp/>found</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/>constexpr<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>neigh_id_lookup[]<sp/>=<sp/>{1,<sp/>3,<sp/>5,<sp/>7,<sp/>0,<sp/>2,<sp/>4,<sp/>6};</highlight></codeline>
<codeline lineno="510"><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>8;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>diagonal<sp/>neighbors:<sp/>(neigh_id<sp/>%<sp/>2)<sp/>==<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>adjacent<sp/>neighbors:<sp/>(neigh_id<sp/>%<sp/>2)<sp/>==<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>neigh_id<sp/>=<sp/>neigh_id_lookup[i];</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_adjacent_neighbor<sp/>=<sp/>neigh_id<sp/>%<sp/>2<sp/>==<sp/>1;</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_diagonal_neighbor<sp/>=<sp/>not<sp/>is_adjacent_neighbor;</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>current<sp/>neighbor_tile.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>neighbor<sp/>=<sp/>&amp;neigh_data[neigh_id];</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>neighbor<sp/>is<sp/>nonexistant</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(neighbor-&gt;state<sp/>==<sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aaea21841da70e6405af19fabc4ff8bdd9" kindref="member">tile_state::missing</ref>)<sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>neighbor<sp/>only<sp/>interesting<sp/>if<sp/>it&apos;s<sp/>a<sp/>different<sp/>terrain<sp/>than<sp/>the<sp/>base.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>it<sp/>is<sp/>the<sp/>same<sp/>id,<sp/>the<sp/>priorities<sp/>are<sp/>equal.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>neighbor<sp/>draws<sp/>over<sp/>the<sp/>base<sp/>if<sp/>it&apos;s<sp/>priority<sp/>is<sp/>greater.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(neighbor-&gt;priority<sp/>&gt;<sp/>base_tile-&gt;priority)<sp/>{</highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>influence<sp/>storage<sp/>for<sp/>the<sp/>neighbor<sp/>terrain<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>group<sp/>influences<sp/>by<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="d6/d08/structopenage_1_1influence" kindref="compound">influence</ref><sp/>=<sp/>&amp;influences_by_terrain_id[neighbor-&gt;terrain_id];</highlight></codeline>
<codeline lineno="535"><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>diagonal<sp/>influence<sp/>is<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_diagonal_neighbor)<sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>adjacent<sp/>neighbors<sp/>to<sp/>the<sp/>current<sp/>diagonal</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>influence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>(a<sp/>&amp;<sp/>0x07)<sp/>==<sp/>(a<sp/>%<sp/>8)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>adj_neigh_0<sp/>=<sp/>(neigh_id<sp/>-<sp/>1)<sp/>&amp;<sp/>0x07;</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>adj_neigh_1<sp/>=<sp/>(neigh_id<sp/>+<sp/>1)<sp/>&amp;<sp/>0x07;</highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>neigh_mask<sp/>=<sp/>(1<sp/>&lt;&lt;<sp/>adj_neigh_0)<sp/>|<sp/>(1<sp/>&lt;&lt;<sp/>adj_neigh_1);</highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>adjacent<sp/>neigbors<sp/>are<sp/>already<sp/>influencing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>current<sp/>tile,<sp/>therefore<sp/>don&apos;t<sp/>apply<sp/>the<sp/>diagonal<sp/>mask</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((<ref refid="d6/d08/structopenage_1_1influence" kindref="compound">influence</ref>-&gt;<ref refid="d6/d08/structopenage_1_1influence_1ae2f8c30c2afb451327be4a424c1d34a0" kindref="member">direction</ref><sp/>&amp;<sp/>neigh_mask)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="552"><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>terrain<sp/>id<sp/>hasn&apos;t<sp/>had<sp/>influence<sp/>so<sp/>far:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>it<sp/>to<sp/>the<sp/>list<sp/>of<sp/>influences.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d6/d08/structopenage_1_1influence" kindref="compound">influence</ref>-&gt;<ref refid="d6/d08/structopenage_1_1influence_1ae2f8c30c2afb451327be4a424c1d34a0" kindref="member">direction</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1a207f831f9570564df1e122906e289c92" kindref="member">terrain_ids</ref>[influences.<ref refid="d9/d65/structopenage_1_1influence__group_1a45caedf1c1dd3ff9b8a74d0284e6e45e" kindref="member">count</ref>]<sp/>=<sp/>neighbor-&gt;terrain_id;</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1a45caedf1c1dd3ff9b8a74d0284e6e45e" kindref="member">count</ref><sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="559"><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>as<sp/>tile<sp/>i<sp/>has<sp/>influence<sp/>for<sp/>this<sp/>priority</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>=&gt;<sp/>bit<sp/>i<sp/>is<sp/>set<sp/>to<sp/>1<sp/>by<sp/>2^i</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d6/d08/structopenage_1_1influence" kindref="compound">influence</ref>-&gt;<ref refid="d6/d08/structopenage_1_1influence_1ae2f8c30c2afb451327be4a424c1d34a0" kindref="member">direction</ref><sp/>|=<sp/>1<sp/>&lt;&lt;<sp/>neigh_id;</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d6/d08/structopenage_1_1influence" kindref="compound">influence</ref>-&gt;<ref refid="d6/d08/structopenage_1_1influence_1a6e1779e4d13ae850ab47cd4d2f4262fb" kindref="member">priority</ref><sp/>=<sp/>neighbor-&gt;priority;</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d6/d08/structopenage_1_1influence" kindref="compound">influence</ref>-&gt;<ref refid="d6/d08/structopenage_1_1influence_1a73ce7fff36bf30903eb10c0d74415675" kindref="member">terrain_id</ref><sp/>=<sp/>neighbor-&gt;terrain_id;</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="567"><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>influences_by_terrain_id<sp/>will<sp/>be<sp/>merged<sp/>in<sp/>the<sp/>following,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>unused<sp/>terrain<sp/>ids<sp/>will<sp/>be<sp/>dropped<sp/>now.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>shrink<sp/>the<sp/>big<sp/>influence<sp/>buffer<sp/>that<sp/>had<sp/>entries<sp/>for<sp/>all<sp/>terrains</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>by<sp/>copying<sp/>the<sp/>possible<sp/>(max<sp/>8)<sp/>influences<sp/>to<sp/>a<sp/>separate<sp/>buffer.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1a45caedf1c1dd3ff9b8a74d0284e6e45e" kindref="member">count</ref>;<sp/>k++)<sp/>{</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>relevant_id<sp/><sp/><sp/><sp/>=<sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1a207f831f9570564df1e122906e289c92" kindref="member">terrain_ids</ref>[k];</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1ab8bb2e9f0051921099959bbf40ce7e45" kindref="member">data</ref>[k]<sp/>=<sp/>influences_by_terrain_id[relevant_id];</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="577"><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>order<sp/>the<sp/>influences<sp/>by<sp/>their<sp/>priority</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>1;<sp/>k<sp/>&lt;<sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1a45caedf1c1dd3ff9b8a74d0284e6e45e" kindref="member">count</ref>;<sp/>k++)<sp/>{</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="d6/d08/structopenage_1_1influence" kindref="compound">influence</ref><sp/>tmp_influence<sp/>=<sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1ab8bb2e9f0051921099959bbf40ce7e45" kindref="member">data</ref>[k];</highlight></codeline>
<codeline lineno="581"><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>k<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(l<sp/>&gt;=<sp/>0<sp/>&amp;&amp;<sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1ab8bb2e9f0051921099959bbf40ce7e45" kindref="member">data</ref>[l].<ref refid="d6/d08/structopenage_1_1influence_1a6e1779e4d13ae850ab47cd4d2f4262fb" kindref="member">priority</ref><sp/>&gt;<sp/>tmp_influence.<ref refid="d6/d08/structopenage_1_1influence_1a6e1779e4d13ae850ab47cd4d2f4262fb" kindref="member">priority</ref>)<sp/>{</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1ab8bb2e9f0051921099959bbf40ce7e45" kindref="member">data</ref>[l<sp/>+<sp/>1]<sp/>=<sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1ab8bb2e9f0051921099959bbf40ce7e45" kindref="member">data</ref>[l];</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l<sp/>-=<sp/>1;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>influences.<ref refid="d9/d65/structopenage_1_1influence__group_1ab8bb2e9f0051921099959bbf40ce7e45" kindref="member">data</ref>[l<sp/>+<sp/>1]<sp/>=<sp/>tmp_influence;</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>influences;</highlight></codeline>
<codeline lineno="592"><highlight class="normal">}</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595" refid="d4/d15/classopenage_1_1_terrain_1a72f81eb7623d4ade8272f8163bfcb4d9" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d4/d15/classopenage_1_1_terrain_1a72f81eb7623d4ade8272f8163bfcb4d9" kindref="member">Terrain::calculate_masks</ref>(<ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>position,</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="d7/d14/structopenage_1_1tile__draw__data" kindref="compound">tile_draw_data</ref><sp/>*<ref refid="db/dde/structopenage_1_1tile__data" kindref="compound">tile_data</ref>,</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="d9/d65/structopenage_1_1influence__group" kindref="compound">influence_group</ref><sp/>*influences)<sp/>{</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>influences<sp/>are<sp/>grouped<sp/>by<sp/>terrain<sp/>id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>direction<sp/>member<sp/>has<sp/>each<sp/>bit<sp/>set<sp/>to<sp/>1<sp/>that<sp/>is<sp/>an<sp/>influence<sp/>from<sp/>that<sp/>direction.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>a<sp/>mask<sp/>for<sp/>this<sp/>direction<sp/>combination.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>base<sp/>tile<sp/>is<sp/>stored<sp/>at<sp/>position<sp/>0<sp/>of<sp/>the<sp/>draw_mask</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="da/d23/namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>base_terrain_id<sp/>=<sp/>tile_data-&gt;<ref refid="d7/d14/structopenage_1_1tile__draw__data_1abb735fac94699d37947a4456ac4177a9" kindref="member">data</ref>[0].<ref refid="db/dde/structopenage_1_1tile__data_1af0b5bcdebb37222eb9d443033ec97aff" kindref="member">terrain_id</ref>;</highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>over<sp/>all<sp/>neighbors<sp/>(with<sp/>different<sp/>terrain_ids)<sp/>that<sp/>have<sp/>influence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(ssize_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>influences-&gt;<ref refid="d9/d65/structopenage_1_1influence__group_1a45caedf1c1dd3ff9b8a74d0284e6e45e" kindref="member">count</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>neighbor<sp/>id<sp/>of<sp/>the<sp/>current<sp/>influence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>direction_bits<sp/>=<sp/>influences-&gt;<ref refid="d9/d65/structopenage_1_1influence__group_1ab8bb2e9f0051921099959bbf40ce7e45" kindref="member">data</ref>[i].<ref refid="d6/d08/structopenage_1_1influence_1ae2f8c30c2afb451327be4a424c1d34a0" kindref="member">direction</ref>;</highlight></codeline>
<codeline lineno="611"><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>all<sp/>bits<sp/>are<sp/>0<sp/>-&gt;<sp/>no<sp/>influence<sp/>directions<sp/>stored.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>=&gt;<sp/>no<sp/>influence<sp/>can<sp/>be<sp/>ignored.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(direction_bits<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="617"><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/d23/namespaceopenage_1a0078c87a2baae2c33889beb8379a8270" kindref="member">terrain_t</ref><sp/>neighbor_terrain_id<sp/>=<sp/>influences-&gt;<ref refid="d9/d65/structopenage_1_1influence__group_1ab8bb2e9f0051921099959bbf40ce7e45" kindref="member">data</ref>[i].<ref refid="d6/d08/structopenage_1_1influence_1a73ce7fff36bf30903eb10c0d74415675" kindref="member">terrain_id</ref>;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>adjacent_mask_id<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="620"><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>neighbor<sp/>ids:</highlight></codeline>
<codeline lineno="622"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0</highlight></codeline>
<codeline lineno="623"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>7<sp/><sp/><sp/>1<sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>8<sp/>neighbors<sp/>that<sp/>can<sp/>have<sp/>influence<sp/>on</highlight></codeline>
<codeline lineno="624"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>6<sp/><sp/><sp/>@<sp/><sp/><sp/>2<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>mask<sp/>id<sp/>selection.</highlight></codeline>
<codeline lineno="625"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>5<sp/><sp/><sp/>3</highlight></codeline>
<codeline lineno="626"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4</highlight></codeline>
<codeline lineno="627"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>filter<sp/>adjacent<sp/>and<sp/>diagonal<sp/>influences<sp/><sp/><sp/><sp/>neighbor_id:<sp/>76543210</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>direction_bits_adjacent<sp/>=<sp/>direction_bits<sp/>&amp;<sp/>0xAA;<sp/></highlight><highlight class="comment">//0b10101010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>direction_bits_diagonal<sp/>=<sp/>direction_bits<sp/>&amp;<sp/>0x55;<sp/></highlight><highlight class="comment">//0b01010101</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(direction_bits_adjacent)<sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x08:<sp/><sp/></highlight><highlight class="comment">//0b00001000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>0;<sp/><sp/></highlight><highlight class="comment">//0..3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x02:<sp/><sp/></highlight><highlight class="comment">//0b00000010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>4;<sp/><sp/></highlight><highlight class="comment">//4..7</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x20:<sp/><sp/></highlight><highlight class="comment">//0b00100000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>8;<sp/><sp/></highlight><highlight class="comment">//8..11</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x80:<sp/><sp/></highlight><highlight class="comment">//0b10000000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>12;<sp/></highlight><highlight class="comment">//12..15</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x22:<sp/><sp/></highlight><highlight class="comment">//0b00100010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>20;</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x88:<sp/><sp/></highlight><highlight class="comment">//0b10001000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>21;</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0xA0:<sp/><sp/></highlight><highlight class="comment">//0b10100000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>22;</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x82:<sp/><sp/></highlight><highlight class="comment">//0b10000010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>23;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x28:<sp/><sp/></highlight><highlight class="comment">//0b00101000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>24;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x0A:<sp/><sp/></highlight><highlight class="comment">//0b00001010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>25;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x2A:<sp/><sp/></highlight><highlight class="comment">//0b00101010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>26;</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0xA8:<sp/><sp/></highlight><highlight class="comment">//0b10101000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>27;</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0xA2:<sp/><sp/></highlight><highlight class="comment">//0b10100010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>28;</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0x8A:<sp/><sp/></highlight><highlight class="comment">//0b10001010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>29;</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>0xAA:<sp/><sp/></highlight><highlight class="comment">//0b10101010</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>=<sp/>30;</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="680"><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>it&apos;s<sp/>the<sp/>linear<sp/>adjacent<sp/>mask,<sp/>cycle<sp/>the<sp/>4<sp/>possible<sp/>masks.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>e.g.<sp/>long<sp/>shorelines<sp/>don&apos;t<sp/>look<sp/>the<sp/>same<sp/>then.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>maskid<sp/>==<sp/>0x08<sp/>0x02<sp/>0x80<sp/>0x20<sp/>for<sp/>that.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(adjacent_mask_id<sp/>&lt;=<sp/>12<sp/>&amp;&amp;<sp/>adjacent_mask_id<sp/>%<sp/>4<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//we<sp/>have<sp/>4<sp/>=<sp/>2^2<sp/>anti<sp/>redundancy<sp/>masks,<sp/>so<sp/>keep<sp/>the<sp/>last<sp/>2<sp/>bits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>anti_redundancy_offset<sp/>=<sp/>(position.ne<sp/>+<sp/>position.se)<sp/>&amp;<sp/>0x03;</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>adjacent_mask_id<sp/>+=<sp/>anti_redundancy_offset;</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>blending<sp/>mode<sp/>(the<sp/>mask<sp/>selection)<sp/>for<sp/>this<sp/>transition</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>mode<sp/>is<sp/>dependent<sp/>on<sp/>the<sp/>two<sp/>meeting<sp/>terrain<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>blend_mode<sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1aac2534a0373a7bbd8efdcf659977a881" kindref="member">get_blending_mode</ref>(base_terrain_id,<sp/>neighbor_terrain_id);</highlight></codeline>
<codeline lineno="693"><highlight class="normal"></highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>append<sp/>the<sp/>mask<sp/>for<sp/>the<sp/>adjacent<sp/>blending</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(adjacent_mask_id<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">tile_data<sp/>*overlay<sp/>=<sp/>&amp;tile_data-&gt;<ref refid="d7/d14/structopenage_1_1tile__draw__data_1abb735fac94699d37947a4456ac4177a9" kindref="member">data</ref>[tile_data-&gt;<ref refid="d7/d14/structopenage_1_1tile__draw__data_1a6df5238236b9996b79e44bd59f4d2b46" kindref="member">count</ref>];</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1abf5ae33e043c9877c1312b583fddcffa" kindref="member">pos</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>position;</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1aef74e061ba5aea22401f1c443423afb9" kindref="member">mask_id</ref><sp/><sp/><sp/><sp/>=<sp/>adjacent_mask_id;</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1a43ad7a45a29a2056ff8300633478c62e" kindref="member">blend_mode</ref><sp/>=<sp/>blend_mode;</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1af0b5bcdebb37222eb9d443033ec97aff" kindref="member">terrain_id</ref><sp/>=<sp/>neighbor_terrain_id;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1ad9e49e097703a4386dac3b90bdc02d5e" kindref="member">tex</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a6e394fadeb8534aef0c7098939f25b23" kindref="member">texture</ref>(neighbor_terrain_id);</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1acd0094b0c8a95d0499c5f2b6d57b12a1" kindref="member">subtexture_id</ref><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a88ec2ee796cfe5d6c97570ad73db43cc" kindref="member">get_subtexture_id</ref>(</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>position,</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/dcc/namespacestd_1a0fc492a11cf74e80f976b24bea2a2eb2" kindref="member">std::sqrt</ref>(overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1ad9e49e097703a4386dac3b90bdc02d5e" kindref="member">tex</ref>-&gt;<ref refid="d4/d5b/classopenage_1_1_texture_1a4548b2bc3eb5310a97deee94ab536035" kindref="member">get_subtexture_count</ref>())</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1aafb07c8fa1ecda12f76b957bb0b972ed" kindref="member">mask_tex</ref><sp/><sp/><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a30da324d9ca8573bb3ac45bb12166298" kindref="member">blending_mask</ref>(blend_mode);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1a7e05c08e74c2be5e11d6c86f4ffc291c" kindref="member">state</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aaf4e0ac58eb46d88efc451c164db3b837" kindref="member">tile_state::existing</ref>;</highlight></codeline>
<codeline lineno="708"><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tile_data-&gt;<ref refid="d7/d14/structopenage_1_1tile__draw__data_1a6df5238236b9996b79e44bd59f4d2b46" kindref="member">count</ref><sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="711"><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>append<sp/>the<sp/>mask<sp/>for<sp/>the<sp/>diagonal<sp/>blending</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(direction_bits_diagonal<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>0;<sp/>l<sp/>&lt;<sp/>4;<sp/>l++)<sp/>{</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>generate<sp/>one<sp/>mask<sp/>for<sp/>each<sp/>influencing<sp/>diagonal<sp/>neighbor<sp/>id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>even<sp/>if<sp/>they<sp/>all<sp/>have<sp/>the<sp/>same<sp/>terrain_id,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>because<sp/>we<sp/>don&apos;t<sp/>have<sp/>combined<sp/>diagonal<sp/>influence<sp/>masks.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>l<sp/>==<sp/>0:<sp/>pos<sp/>=<sp/>0b000000001,<sp/>mask<sp/>=<sp/>18</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>l<sp/>==<sp/>1:<sp/>pos<sp/>=<sp/>0b000000100,<sp/>mask<sp/>=<sp/>16</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>l<sp/>==<sp/>2:<sp/>pos<sp/>=<sp/>0b000010000,<sp/>mask<sp/>=<sp/>17</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>l<sp/>==<sp/>3:<sp/>pos<sp/>=<sp/>0b001000000,<sp/>mask<sp/>=<sp/>19</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>current_direction_bit<sp/>=<sp/>1<sp/>&lt;&lt;<sp/>(l*2);</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>constexpr<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>diag_mask_id_map[4]<sp/>=<sp/>{18,<sp/>16,<sp/>17,<sp/>19};</highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(direction_bits_diagonal<sp/>&amp;<sp/>current_direction_bit)<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">tile_data<sp/>*overlay<sp/>=<sp/>&amp;tile_data-&gt;<ref refid="d7/d14/structopenage_1_1tile__draw__data_1abb735fac94699d37947a4456ac4177a9" kindref="member">data</ref>[tile_data-&gt;<ref refid="d7/d14/structopenage_1_1tile__draw__data_1a6df5238236b9996b79e44bd59f4d2b46" kindref="member">count</ref>];</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1abf5ae33e043c9877c1312b583fddcffa" kindref="member">pos</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>position;</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1aef74e061ba5aea22401f1c443423afb9" kindref="member">mask_id</ref><sp/><sp/><sp/><sp/>=<sp/>diag_mask_id_map[l];</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1a43ad7a45a29a2056ff8300633478c62e" kindref="member">blend_mode</ref><sp/>=<sp/>blend_mode;</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1af0b5bcdebb37222eb9d443033ec97aff" kindref="member">terrain_id</ref><sp/>=<sp/>neighbor_terrain_id;</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1ad9e49e097703a4386dac3b90bdc02d5e" kindref="member">tex</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a6e394fadeb8534aef0c7098939f25b23" kindref="member">texture</ref>(neighbor_terrain_id);</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1acd0094b0c8a95d0499c5f2b6d57b12a1" kindref="member">subtexture_id</ref><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a88ec2ee796cfe5d6c97570ad73db43cc" kindref="member">get_subtexture_id</ref>(</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>position,</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/dcc/namespacestd_1a0fc492a11cf74e80f976b24bea2a2eb2" kindref="member">std::sqrt</ref>(overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1ad9e49e097703a4386dac3b90bdc02d5e" kindref="member">tex</ref>-&gt;<ref refid="d4/d5b/classopenage_1_1_texture_1a4548b2bc3eb5310a97deee94ab536035" kindref="member">get_subtexture_count</ref>())</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1aafb07c8fa1ecda12f76b957bb0b972ed" kindref="member">mask_tex</ref><sp/><sp/><sp/>=<sp/>this-&gt;<ref refid="d4/d15/classopenage_1_1_terrain_1a30da324d9ca8573bb3ac45bb12166298" kindref="member">blending_mask</ref>(blend_mode);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlay-&gt;<ref refid="db/dde/structopenage_1_1tile__data_1a7e05c08e74c2be5e11d6c86f4ffc291c" kindref="member">state</ref><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a452923c63b865b21223a44ea86714b4aaf4e0ac58eb46d88efc451c164db3b837" kindref="member">tile_state::existing</ref>;</highlight></codeline>
<codeline lineno="740"><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tile_data-&gt;<ref refid="d7/d14/structopenage_1_1tile__draw__data_1a6df5238236b9996b79e44bd59f4d2b46" kindref="member">count</ref><sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="746"><highlight class="normal">}</highlight></codeline>
<codeline lineno="747"><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace<sp/>openage</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/mnt/c/Users/Jameson/Desktop/git/openage-new-doc-system/libopenage/terrain/terrain.cpp"/>
  </compounddef>
</doxygen>
