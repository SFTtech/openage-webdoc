<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.13">
  <compounddef id="de/d96/unit_2action_8cpp" kind="file" language="C++">
    <compoundname>action.cpp</compoundname>
    <includes local="no">algorithm</includes>
    <includes local="no">cmath</includes>
    <includes refid="d1/d55/engine_8h" local="yes">../engine.h</includes>
    <includes refid="d3/dce/a__star_8h" local="yes">../pathfinding/a_star.h</includes>
    <includes refid="df/d8d/heuristics_8h" local="yes">../pathfinding/heuristics.h</includes>
    <includes refid="d8/db6/terrain_8h" local="yes">../terrain/terrain.h</includes>
    <includes refid="de/da5/terrain__search_8h" local="yes">../terrain/terrain_search.h</includes>
    <includes refid="d8/d1f/unit_2action_8h" local="yes">action.h</includes>
    <includes refid="d0/d09/command_8h" local="yes">command.h</includes>
    <includes refid="d9/d2c/producer_8h" local="yes">producer.h</includes>
    <includes refid="d1/d8c/research_8h" local="yes">research.h</includes>
    <includes refid="dd/dde/unit__texture_8h" local="yes">unit_texture.h</includes>
    <incdepgraph>
      <node id="15405">
        <label>list</label>
      </node>
      <node id="15419">
        <label>../util/language.h</label>
        <link refid="d8/dce/language_8h"/>
      </node>
      <node id="15396">
        <label>atomic</label>
      </node>
      <node id="15525">
        <label>unit_type.h</label>
        <link refid="d7/dfc/unit__type_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15526" relation="include">
        </childnode>
        <childnode refid="15513" relation="include">
        </childnode>
      </node>
      <node id="15480">
        <label>timing.h</label>
        <link refid="db/d41/timing_8h"/>
        <childnode refid="15376" relation="include">
        </childnode>
      </node>
      <node id="15515">
        <label>producer.h</label>
        <link refid="d9/d2c/producer_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
        <childnode refid="15516" relation="include">
        </childnode>
        <childnode refid="15517" relation="include">
        </childnode>
        <childnode refid="15518" relation="include">
        </childnode>
        <childnode refid="15511" relation="include">
        </childnode>
        <childnode refid="15525" relation="include">
        </childnode>
      </node>
      <node id="15492">
        <label>path.h</label>
        <link refid="da/d7a/pathfinding_2path_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
        <childnode refid="15493" relation="include">
        </childnode>
        <childnode refid="15432" relation="include">
        </childnode>
        <childnode refid="15435" relation="include">
        </childnode>
      </node>
      <node id="15479">
        <label>timer.h</label>
        <link refid="d5/dd0/timer_8h"/>
        <childnode refid="15376" relation="include">
        </childnode>
        <childnode refid="15480" relation="include">
        </childnode>
      </node>
      <node id="15382">
        <label>log/log.h</label>
        <link refid="d7/d7f/log_8h"/>
        <childnode refid="15383" relation="include">
        </childnode>
        <childnode refid="15391" relation="include">
        </childnode>
      </node>
      <node id="15402">
        <label>iomanip</label>
      </node>
      <node id="15401">
        <label>functional</label>
      </node>
      <node id="15426">
        <label>fslike/native.h</label>
        <link refid="d3/d0f/fslike_2native_8h"/>
      </node>
      <node id="15455">
        <label>queue</label>
      </node>
      <node id="15441">
        <label>limits</label>
      </node>
      <node id="15511">
        <label>unit.h</label>
        <link refid="d1/da2/unit_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15406" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15455" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15452" relation="include">
        </childnode>
        <childnode refid="15512" relation="include">
        </childnode>
        <childnode refid="15509" relation="include">
        </childnode>
        <childnode refid="15480" relation="include">
        </childnode>
        <childnode refid="15484" relation="include">
        </childnode>
        <childnode refid="15506" relation="include">
        </childnode>
        <childnode refid="15513" relation="include">
        </childnode>
        <childnode refid="15514" relation="include">
        </childnode>
        <childnode refid="15487" relation="include">
        </childnode>
      </node>
      <node id="15523">
        <label>population_tracker.h</label>
        <link refid="d4/d3e/population__tracker_8h"/>
      </node>
      <node id="15505">
        <label>action.h</label>
        <link refid="d8/d1f/unit_2action_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15492" relation="include">
        </childnode>
        <childnode refid="15486" relation="include">
        </childnode>
        <childnode refid="15506" relation="include">
        </childnode>
        <childnode refid="15510" relation="include">
        </childnode>
        <childnode refid="15511" relation="include">
        </childnode>
        <childnode refid="15487" relation="include">
        </childnode>
      </node>
      <node id="15465">
        <label>job.h</label>
        <link refid="d3/d6a/job_8h"/>
        <childnode refid="15460" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15459" relation="include">
        </childnode>
      </node>
      <node id="15410">
        <label>category.h</label>
        <link refid="d8/d0a/category_8h"/>
        <childnode refid="15385" relation="include">
        </childnode>
      </node>
      <node id="15471">
        <label>event.h</label>
        <link refid="d9/d15/input_2event_8h"/>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15472" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15378" relation="include">
        </childnode>
      </node>
      <node id="15381">
        <label>QObject</label>
      </node>
      <node id="15376">
        <label>cstdint</label>
      </node>
      <node id="15398">
        <label>externalsstream.h</label>
        <link refid="dc/dcf/externalsstream_8h"/>
        <childnode refid="15385" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
      </node>
      <node id="15526">
        <label>../gamestate/cost.h</label>
        <link refid="d3/d8d/cost_8h"/>
        <childnode refid="15486" relation="include">
        </childnode>
      </node>
      <node id="15481">
        <label>util/profiler.h</label>
        <link refid="dd/dff/profiler_8h"/>
        <childnode refid="15436" relation="include">
        </childnode>
        <childnode refid="15482" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
      </node>
      <node id="15390">
        <label>signal.h</label>
        <link refid="d8/d39/signal_8h"/>
        <childnode refid="15390" relation="include">
        </childnode>
      </node>
      <node id="15432">
        <label>../util/misc.h</label>
        <link refid="d4/d08/misc_8h"/>
        <childnode refid="15373" relation="include">
        </childnode>
        <childnode refid="15433" relation="include">
        </childnode>
        <childnode refid="15374" relation="include">
        </childnode>
        <childnode refid="15434" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15421" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
      </node>
      <node id="15442">
        <label>coord_nese.gen.h</label>
      </node>
      <node id="15464">
        <label>types.h</label>
        <link refid="da/d65/job_2types_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
      </node>
      <node id="15448">
        <label>stdlib.h</label>
      </node>
      <node id="15466">
        <label>job_group.h</label>
        <link refid="d3/d81/job__group_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15421" relation="include">
        </childnode>
        <childnode refid="15457" relation="include">
        </childnode>
        <childnode refid="15465" relation="include">
        </childnode>
        <childnode refid="15467" relation="include">
        </childnode>
        <childnode refid="15464" relation="include">
        </childnode>
        <childnode refid="15468" relation="include">
        </childnode>
      </node>
      <node id="15497">
        <label>../coord/chunk.h</label>
        <link refid="dd/dd5/chunk_8h"/>
        <childnode refid="15438" relation="include">
        </childnode>
        <childnode refid="15442" relation="include">
        </childnode>
        <childnode refid="15443" relation="include">
        </childnode>
      </node>
      <node id="15496">
        <label>../assetmanager.h</label>
        <link refid="d0/d45/assetmanager_8h"/>
        <childnode refid="15392" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15415" relation="include">
        </childnode>
      </node>
      <node id="15418">
        <label>functional.h</label>
        <link refid="d8/dea/functional_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15406" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
        <childnode refid="15419" relation="include">
        </childnode>
        <childnode refid="15420" relation="include">
        </childnode>
        <childnode refid="15423" relation="include">
        </childnode>
      </node>
      <node id="15506">
        <label>attribute.h</label>
        <link refid="d3/d7c/attribute_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15507" relation="include">
        </childnode>
        <childnode refid="15373" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
        <childnode refid="15508" relation="include">
        </childnode>
        <childnode refid="15509" relation="include">
        </childnode>
        <childnode refid="15486" relation="include">
        </childnode>
        <childnode refid="15487" relation="include">
        </childnode>
      </node>
      <node id="15431">
        <label>phys.h</label>
        <link refid="d0/d8a/phys_8h"/>
        <childnode refid="15432" relation="include">
        </childnode>
        <childnode refid="15435" relation="include">
        </childnode>
        <childnode refid="15438" relation="include">
        </childnode>
        <childnode refid="15442" relation="include">
        </childnode>
        <childnode refid="15443" relation="include">
        </childnode>
      </node>
      <node id="15374">
        <label>cmath</label>
      </node>
      <node id="15516">
        <label>../gamedata/gamedata.gen.h</label>
      </node>
      <node id="15422">
        <label>stdexcept</label>
      </node>
      <node id="15475">
        <label>options.h</label>
        <link refid="d7/d5b/options_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15476" relation="include">
        </childnode>
      </node>
      <node id="15420">
        <label>exctranslate.h</label>
        <link refid="dd/d5f/exctranslate_8h"/>
        <childnode refid="15421" relation="include">
        </childnode>
      </node>
      <node id="15524">
        <label>score.h</label>
        <link refid="dd/df8/score_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15486" relation="include">
        </childnode>
      </node>
      <node id="15400">
        <label>cstdarg</label>
      </node>
      <node id="15389">
        <label>string</label>
      </node>
      <node id="15404">
        <label>logsink.h</label>
        <link refid="d3/d4e/logsink_8h"/>
        <childnode refid="15405" relation="include">
        </childnode>
        <childnode refid="15406" relation="include">
        </childnode>
        <childnode refid="15383" relation="include">
        </childnode>
      </node>
      <node id="15444">
        <label>pixel.h</label>
        <link refid="dd/dcd/pixel_8h"/>
        <childnode refid="15445" relation="include">
        </childnode>
        <childnode refid="15438" relation="include">
        </childnode>
      </node>
      <node id="15507">
        <label>map</label>
      </node>
      <node id="15450">
        <label>gui/engine_info.h</label>
        <link refid="d9/d29/engine__info_8h"/>
        <childnode refid="15415" relation="include">
        </childnode>
        <childnode refid="15451" relation="include">
        </childnode>
      </node>
      <node id="15510">
        <label>research.h</label>
        <link refid="d1/d8c/research_8h"/>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
      </node>
      <node id="15508">
        <label>../gamedata/unit.gen.h</label>
      </node>
      <node id="15472">
        <label>unordered_set</label>
      </node>
      <node id="15478">
        <label>util/fps.h</label>
        <link refid="d5/d3e/fps_8h"/>
        <childnode refid="15479" relation="include">
        </childnode>
      </node>
      <node id="15520">
        <label>game_spec.h</label>
        <link refid="d4/d97/game__spec_8h"/>
        <childnode refid="15465" relation="include">
        </childnode>
        <childnode refid="15516" relation="include">
        </childnode>
        <childnode refid="15517" relation="include">
        </childnode>
        <childnode refid="15494" relation="include">
        </childnode>
        <childnode refid="15521" relation="include">
        </childnode>
        <childnode refid="15522" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15381" relation="include">
        </childnode>
      </node>
      <node id="15469">
        <label>input/input_manager.h</label>
        <link refid="d8/dd2/input__manager_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15378" relation="include">
        </childnode>
        <childnode refid="15452" relation="include">
        </childnode>
        <childnode refid="15470" relation="include">
        </childnode>
        <childnode refid="15471" relation="include">
        </childnode>
        <childnode refid="15473" relation="include">
        </childnode>
      </node>
      <node id="15512">
        <label>../log/logsource.h</label>
        <link refid="d4/dda/logsource_8h"/>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15391" relation="include">
        </childnode>
      </node>
      <node id="15460">
        <label>exception</label>
      </node>
      <node id="15462">
        <label>stddef.h</label>
      </node>
      <node id="15408">
        <label>fstream</label>
      </node>
      <node id="15428">
        <label>ostream</label>
      </node>
      <node id="15513">
        <label>attributes.h</label>
        <link refid="da/d6e/attributes_8h"/>
        <childnode refid="15507" relation="include">
        </childnode>
        <childnode refid="15506" relation="include">
        </childnode>
      </node>
      <node id="15430">
        <label>coord/coordmanager.h</label>
        <link refid="da/d63/coordmanager_8h"/>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15444" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
      </node>
      <node id="15391">
        <label>message.h</label>
        <link refid="d2/d0d/message_8h"/>
        <childnode refid="15376" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15392" relation="include">
        </childnode>
        <childnode refid="15393" relation="include">
        </childnode>
        <childnode refid="15395" relation="include">
        </childnode>
        <childnode refid="15404" relation="include">
        </childnode>
        <childnode refid="15383" relation="include">
        </childnode>
      </node>
      <node id="15433">
        <label>limits.h</label>
      </node>
      <node id="15429">
        <label>loader_policy.h</label>
        <link refid="d2/d64/loader__policy_8h"/>
        <childnode refid="15428" relation="include">
        </childnode>
      </node>
      <node id="15502">
        <label>shader/shader.h</label>
        <link refid="d2/d22/shader_2shader_8h"/>
        <childnode refid="15503" relation="include">
        </childnode>
        <childnode refid="15499" relation="include">
        </childnode>
      </node>
      <node id="15384">
        <label>../util/enum.h</label>
        <link refid="d0/d9b/enum_8h"/>
        <childnode refid="15385" relation="include">
        </childnode>
        <childnode refid="15386" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
      </node>
      <node id="15491">
        <label>heuristics.h</label>
        <link refid="df/d8d/heuristics_8h"/>
        <childnode refid="15492" relation="include">
        </childnode>
      </node>
      <node id="15443">
        <label>coord_neseup.gen.h</label>
      </node>
      <node id="15413">
        <label>sound.h</label>
        <link refid="d9/d88/sound_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15410" relation="include">
        </childnode>
      </node>
      <node id="15463">
        <label>job_state_base.h</label>
        <link refid="d3/d8b/job__state__base_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15464" relation="include">
        </childnode>
      </node>
      <node id="15378">
        <label>SDL2/SDL.h</label>
      </node>
      <node id="15411">
        <label>hash_functions.h</label>
        <link refid="df/dd0/hash__functions_8h"/>
        <childnode refid="15412" relation="include">
        </childnode>
        <childnode refid="15410" relation="include">
        </childnode>
      </node>
      <node id="15453">
        <label>job/job_manager.h</label>
        <link refid="d3/de6/job__manager_8h"/>
        <childnode refid="15396" relation="include">
        </childnode>
        <childnode refid="15454" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15406" relation="include">
        </childnode>
        <childnode refid="15455" relation="include">
        </childnode>
        <childnode refid="15456" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15457" relation="include">
        </childnode>
        <childnode refid="15465" relation="include">
        </childnode>
        <childnode refid="15466" relation="include">
        </childnode>
        <childnode refid="15467" relation="include">
        </childnode>
        <childnode refid="15463" relation="include">
        </childnode>
        <childnode refid="15464" relation="include">
        </childnode>
      </node>
      <node id="15454">
        <label>condition_variable</label>
      </node>
      <node id="15519">
        <label>civilisation.h</label>
        <link refid="d6/db2/civilisation_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15520" relation="include">
        </childnode>
      </node>
      <node id="15451">
        <label>guisys/public/gui_singleton_items_info.h</label>
        <link refid="da/ddd/gui__singleton__items__info_8h"/>
      </node>
      <node id="15467">
        <label>job_state.h</label>
        <link refid="d3/d6e/job__state_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15459" relation="include">
        </childnode>
        <childnode refid="15464" relation="include">
        </childnode>
      </node>
      <node id="15424">
        <label>file.h</label>
        <link refid="d2/d4d/file_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15425" relation="include">
        </childnode>
        <childnode refid="15416" relation="include">
        </childnode>
      </node>
      <node id="15425">
        <label>filelike/filelike.h</label>
        <link refid="d7/db5/filelike_8h"/>
        <childnode refid="15385" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
      </node>
      <node id="15386">
        <label>typeinfo</label>
      </node>
      <node id="15485">
        <label>bitset</label>
      </node>
      <node id="15445">
        <label>coord_xy.gen.h</label>
      </node>
      <node id="15412">
        <label>tuple</label>
      </node>
      <node id="15489">
        <label>ctime</label>
      </node>
      <node id="15494">
        <label>../terrain/terrain.h</label>
        <link refid="d8/db6/terrain_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15462" relation="include">
        </childnode>
        <childnode refid="15495" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15496" relation="include">
        </childnode>
        <childnode refid="15497" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15444" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
        <childnode refid="15498" relation="include">
        </childnode>
        <childnode refid="15432" relation="include">
        </childnode>
      </node>
      <node id="15487">
        <label>unit_container.h</label>
        <link refid="d5/ddb/unit__container_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
        <childnode refid="15452" relation="include">
        </childnode>
        <childnode refid="15480" relation="include">
        </childnode>
      </node>
      <node id="15484">
        <label>ability.h</label>
        <link refid="df/d23/ability_8h"/>
        <childnode refid="15485" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15397" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15486" relation="include">
        </childnode>
      </node>
      <node id="15514">
        <label>command.h</label>
        <link refid="d0/d09/command_8h"/>
        <childnode refid="15472" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15484" relation="include">
        </childnode>
      </node>
      <node id="15474">
        <label>stack</label>
      </node>
      <node id="15380">
        <label>vector</label>
      </node>
      <node id="15388">
        <label>ciso646</label>
      </node>
      <node id="15439">
        <label>../util/fixed_point.h</label>
        <link refid="de/d62/fixed__point_8h"/>
        <childnode refid="15373" relation="include">
        </childnode>
        <childnode refid="15440" relation="include">
        </childnode>
        <childnode refid="15374" relation="include">
        </childnode>
        <childnode refid="15402" relation="include">
        </childnode>
        <childnode refid="15441" relation="include">
        </childnode>
        <childnode refid="15428" relation="include">
        </childnode>
        <childnode refid="15397" relation="include">
        </childnode>
        <childnode refid="15432" relation="include">
        </childnode>
      </node>
      <node id="15407">
        <label>log/file_logsink.h</label>
        <link refid="de/d61/file__logsink_8h"/>
        <childnode refid="15385" relation="include">
        </childnode>
        <childnode refid="15408" relation="include">
        </childnode>
        <childnode refid="15404" relation="include">
        </childnode>
      </node>
      <node id="15435">
        <label>../util/hash.h</label>
        <link refid="db/dfb/hash_8h"/>
        <childnode refid="15394" relation="include">
        </childnode>
        <childnode refid="15436" relation="include">
        </childnode>
        <childnode refid="15437" relation="include">
        </childnode>
      </node>
      <node id="15417">
        <label>defs.h</label>
        <link refid="d5/d64/defs_8h"/>
      </node>
      <node id="15421">
        <label>../error/error.h</label>
        <link refid="d7/dce/error_2error_8h"/>
        <childnode refid="15385" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15422" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
        <childnode refid="15391" relation="include">
        </childnode>
      </node>
      <node id="15449">
        <label>utility</label>
      </node>
      <node id="15436">
        <label>array</label>
      </node>
      <node id="15403">
        <label>sstream</label>
      </node>
      <node id="15509">
        <label>../terrain/terrain_object.h</label>
        <link refid="d0/d94/terrain__object_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15462" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
      </node>
      <node id="15372">
        <label>/mnt/c/Users/Jameson/Desktop/git/openage-new-doc-system/libopenage/unit/action.cpp</label>
        <link refid="de/d96/unit_2action_8cpp"/>
        <childnode refid="15373" relation="include">
        </childnode>
        <childnode refid="15374" relation="include">
        </childnode>
        <childnode refid="15375" relation="include">
        </childnode>
        <childnode refid="15490" relation="include">
        </childnode>
        <childnode refid="15491" relation="include">
        </childnode>
        <childnode refid="15494" relation="include">
        </childnode>
        <childnode refid="15504" relation="include">
        </childnode>
        <childnode refid="15505" relation="include">
        </childnode>
        <childnode refid="15514" relation="include">
        </childnode>
        <childnode refid="15515" relation="include">
        </childnode>
        <childnode refid="15510" relation="include">
        </childnode>
        <childnode refid="15521" relation="include">
        </childnode>
      </node>
      <node id="15427">
        <label>format.h</label>
        <link refid="d0/d0a/format_8h"/>
        <childnode refid="15428" relation="include">
        </childnode>
      </node>
      <node id="15522">
        <label>../util/csv.h</label>
        <link refid="d3/d8e/csv_8h"/>
        <childnode refid="15394" relation="include">
        </childnode>
        <childnode refid="15434" relation="include">
        </childnode>
        <childnode refid="15408" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15421" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
        <childnode refid="15426" relation="include">
        </childnode>
        <childnode refid="15415" relation="include">
        </childnode>
      </node>
      <node id="15499">
        <label>epoxy/gl.h</label>
      </node>
      <node id="15470">
        <label>action.h</label>
        <link refid="d9/d00/input_2action_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15444" relation="include">
        </childnode>
        <childnode refid="15471" relation="include">
        </childnode>
      </node>
      <node id="15476">
        <label>util/variable.h</label>
        <link refid="da/d89/variable_8h"/>
      </node>
      <node id="15477">
        <label>util/externalprofiler.h</label>
        <link refid="d6/d3a/externalprofiler_8h"/>
      </node>
      <node id="15447">
        <label>cvar/cvar.h</label>
        <link refid="dd/d54/cvar_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15448" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15449" relation="include">
        </childnode>
        <childnode refid="15418" relation="include">
        </childnode>
        <childnode refid="15415" relation="include">
        </childnode>
      </node>
      <node id="15518">
        <label>../gamestate/player.h</label>
        <link refid="d3/d62/player_8h"/>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15519" relation="include">
        </childnode>
        <childnode refid="15523" relation="include">
        </childnode>
        <childnode refid="15486" relation="include">
        </childnode>
        <childnode refid="15524" relation="include">
        </childnode>
      </node>
      <node id="15500">
        <label>gamedata/texture.gen.h</label>
      </node>
      <node id="15423">
        <label>setup.h</label>
        <link refid="d7/df7/setup_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
      </node>
      <node id="15490">
        <label>../pathfinding/a_star.h</label>
        <link refid="d3/dce/a__star_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15491" relation="include">
        </childnode>
        <childnode refid="15492" relation="include">
        </childnode>
      </node>
      <node id="15387">
        <label>compiler.h</label>
        <link refid="d4/dd1/compiler_8h"/>
        <childnode refid="15388" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15390" relation="include">
        </childnode>
      </node>
      <node id="15394">
        <label>cstdlib</label>
      </node>
      <node id="15446">
        <label>tile.h</label>
        <link refid="da/dce/tile_8h"/>
        <childnode refid="15438" relation="include">
        </childnode>
        <childnode refid="15442" relation="include">
        </childnode>
        <childnode refid="15443" relation="include">
        </childnode>
        <childnode refid="15432" relation="include">
        </childnode>
        <childnode refid="15435" relation="include">
        </childnode>
      </node>
      <node id="15383">
        <label>level.h</label>
        <link refid="de/d09/level_8h"/>
        <childnode refid="15384" relation="include">
        </childnode>
      </node>
      <node id="15385">
        <label>iostream</label>
      </node>
      <node id="15483">
        <label>unit/selection.h</label>
        <link refid="df/d48/selection_8h"/>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15444" relation="include">
        </childnode>
        <childnode refid="15452" relation="include">
        </childnode>
        <childnode refid="15484" relation="include">
        </childnode>
        <childnode refid="15487" relation="include">
        </childnode>
      </node>
      <node id="15393">
        <label>../util/constexpr.h</label>
        <link refid="d1/d06/constexpr_8h"/>
        <childnode refid="15394" relation="include">
        </childnode>
      </node>
      <node id="15416">
        <label>../pyinterface/pyobject.h</label>
        <link refid="d2/d4b/pyobject_8h"/>
        <childnode refid="15376" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15417" relation="include">
        </childnode>
        <childnode refid="15418" relation="include">
        </childnode>
      </node>
      <node id="15498">
        <label>../texture.h</label>
        <link refid="df/dba/texture_8h"/>
        <childnode refid="15499" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15500" relation="include">
        </childnode>
        <childnode refid="15444" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
        <childnode refid="15501" relation="include">
        </childnode>
        <childnode refid="15502" relation="include">
        </childnode>
        <childnode refid="15415" relation="include">
        </childnode>
      </node>
      <node id="15504">
        <label>../terrain/terrain_search.h</label>
        <link refid="de/da5/terrain__search_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15455" relation="include">
        </childnode>
        <childnode refid="15472" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15446" relation="include">
        </childnode>
      </node>
      <node id="15399">
        <label>strings.h</label>
        <link refid="d6/d90/strings_8h"/>
        <childnode refid="15400" relation="include">
        </childnode>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15402" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15403" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
      </node>
      <node id="15379">
        <label>unordered_map</label>
      </node>
      <node id="15414">
        <label>resource_def.h</label>
        <link refid="de/db3/resource__def_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15415" relation="include">
        </childnode>
        <childnode refid="15410" relation="include">
        </childnode>
        <childnode refid="15427" relation="include">
        </childnode>
        <childnode refid="15429" relation="include">
        </childnode>
      </node>
      <node id="15440">
        <label>climits</label>
      </node>
      <node id="15488">
        <label>screenshot.h</label>
        <link refid="dc/d9e/screenshot_8h"/>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15489" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15444" relation="include">
        </childnode>
      </node>
      <node id="15406">
        <label>mutex</label>
      </node>
      <node id="15482">
        <label>chrono</label>
      </node>
      <node id="15521">
        <label>../unit/unit_texture.h</label>
        <link refid="dd/dde/unit__texture_8h"/>
        <childnode refid="15376" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15517" relation="include">
        </childnode>
      </node>
      <node id="15456">
        <label>thread</label>
      </node>
      <node id="15461">
        <label>../util/thread_id.h</label>
        <link refid="d2/d4c/thread__id_8h"/>
        <childnode refid="15462" relation="include">
        </childnode>
      </node>
      <node id="15452">
        <label>handlers.h</label>
        <link refid="d0/dfb/handlers_8h"/>
        <childnode refid="15378" relation="include">
        </childnode>
        <childnode refid="15444" relation="include">
        </childnode>
      </node>
      <node id="15438">
        <label>declarations.h</label>
        <link refid="db/d40/declarations_8h"/>
        <childnode refid="15376" relation="include">
        </childnode>
        <childnode refid="15439" relation="include">
        </childnode>
      </node>
      <node id="15395">
        <label>../util/stringformatter.h</label>
        <link refid="de/d65/stringformatter_8h"/>
        <childnode refid="15396" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15397" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
        <childnode refid="15398" relation="include">
        </childnode>
        <childnode refid="15399" relation="include">
        </childnode>
      </node>
      <node id="15397">
        <label>type_traits</label>
      </node>
      <node id="15495">
        <label>set</label>
      </node>
      <node id="15392">
        <label>config.h</label>
      </node>
      <node id="15493">
        <label>../datastructure/pairing_heap.h</label>
        <link refid="d8/da2/pairing__heap_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15397" relation="include">
        </childnode>
        <childnode refid="15472" relation="include">
        </childnode>
        <childnode refid="15387" relation="include">
        </childnode>
        <childnode refid="15421" relation="include">
        </childnode>
      </node>
      <node id="15373">
        <label>algorithm</label>
      </node>
      <node id="15459">
        <label>typed_job_state_base.h</label>
        <link refid="da/d6c/typed__job__state__base_8h"/>
        <childnode refid="15396" relation="include">
        </childnode>
        <childnode refid="15460" relation="include">
        </childnode>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15461" relation="include">
        </childnode>
        <childnode refid="15421" relation="include">
        </childnode>
        <childnode refid="15458" relation="include">
        </childnode>
        <childnode refid="15463" relation="include">
        </childnode>
        <childnode refid="15464" relation="include">
        </childnode>
      </node>
      <node id="15415">
        <label>../util/path.h</label>
        <link refid="d1/d11/util_2path_8h"/>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15416" relation="include">
        </childnode>
        <childnode refid="15424" relation="include">
        </childnode>
        <childnode refid="15426" relation="include">
        </childnode>
      </node>
      <node id="15375">
        <label>../engine.h</label>
        <link refid="d1/d55/engine_8h"/>
        <childnode refid="15376" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15378" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15381" relation="include">
        </childnode>
        <childnode refid="15382" relation="include">
        </childnode>
        <childnode refid="15407" relation="include">
        </childnode>
        <childnode refid="15409" relation="include">
        </childnode>
        <childnode refid="15430" relation="include">
        </childnode>
        <childnode refid="15431" relation="include">
        </childnode>
        <childnode refid="15444" relation="include">
        </childnode>
        <childnode refid="15447" relation="include">
        </childnode>
        <childnode refid="15450" relation="include">
        </childnode>
        <childnode refid="15452" relation="include">
        </childnode>
        <childnode refid="15453" relation="include">
        </childnode>
        <childnode refid="15469" relation="include">
        </childnode>
        <childnode refid="15470" relation="include">
        </childnode>
        <childnode refid="15475" relation="include">
        </childnode>
        <childnode refid="15477" relation="include">
        </childnode>
        <childnode refid="15478" relation="include">
        </childnode>
        <childnode refid="15415" relation="include">
        </childnode>
        <childnode refid="15481" relation="include">
        </childnode>
        <childnode refid="15483" relation="include">
        </childnode>
        <childnode refid="15399" relation="include">
        </childnode>
        <childnode refid="15488" relation="include">
        </childnode>
      </node>
      <node id="15501">
        <label>shader/program.h</label>
        <link refid="d1/dea/program_8h"/>
        <childnode refid="15499" relation="include">
        </childnode>
      </node>
      <node id="15434">
        <label>cstring</label>
      </node>
      <node id="15517">
        <label>../gamedata/graphic.gen.h</label>
      </node>
      <node id="15473">
        <label>input_context.h</label>
        <link refid="dd/d92/input__context_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15474" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15470" relation="include">
        </childnode>
        <childnode refid="15471" relation="include">
        </childnode>
      </node>
      <node id="15409">
        <label>audio/audio_manager.h</label>
        <link refid="da/d68/audio__manager_8h"/>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
        <childnode refid="15379" relation="include">
        </childnode>
        <childnode refid="15380" relation="include">
        </childnode>
        <childnode refid="15378" relation="include">
        </childnode>
        <childnode refid="15410" relation="include">
        </childnode>
        <childnode refid="15411" relation="include">
        </childnode>
        <childnode refid="15413" relation="include">
        </childnode>
        <childnode refid="15414" relation="include">
        </childnode>
      </node>
      <node id="15486">
        <label>../gamestate/resource.h</label>
        <link refid="df/d9c/gamestate_2resource_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15389" relation="include">
        </childnode>
      </node>
      <node id="15457">
        <label>abortable_job_state.h</label>
        <link refid="dd/ddf/abortable__job__state_8h"/>
        <childnode refid="15401" relation="include">
        </childnode>
        <childnode refid="15458" relation="include">
        </childnode>
        <childnode refid="15459" relation="include">
        </childnode>
        <childnode refid="15464" relation="include">
        </childnode>
      </node>
      <node id="15377">
        <label>memory</label>
      </node>
      <node id="15503">
        <label>initializer_list</label>
      </node>
      <node id="15437">
        <label>typeindex</label>
      </node>
      <node id="15468">
        <label>worker.h</label>
        <link refid="da/da5/worker_8h"/>
        <childnode refid="15396" relation="include">
        </childnode>
        <childnode refid="15454" relation="include">
        </childnode>
        <childnode refid="15377" relation="include">
        </childnode>
        <childnode refid="15455" relation="include">
        </childnode>
        <childnode refid="15456" relation="include">
        </childnode>
        <childnode refid="15463" relation="include">
        </childnode>
      </node>
      <node id="15458">
        <label>job_aborted_exception.h</label>
        <link refid="df/d29/job__aborted__exception_8h"/>
        <childnode refid="15422" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <innernamespace refid="da/d23/namespaceopenage">openage</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>Copyright<sp/>2014-2019<sp/>the<sp/>openage<sp/>authors.<sp/>See<sp/>copying.md<sp/>for<sp/>legal<sp/>info.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;algorithm&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cmath&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../engine.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../pathfinding/a_star.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../pathfinding/heuristics.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../terrain/terrain.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../terrain/terrain_search.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="d8/d1f/unit_2action_8h" kindref="compound">action.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="d0/d09/command_8h" kindref="compound">command.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="d9/d2c/producer_8h" kindref="compound">producer.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="d1/d8c/research_8h" kindref="compound">research.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="dd/dde/unit__texture_8h" kindref="compound">unit_texture.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="da/d23/namespaceopenage" kindref="compound">openage</ref><sp/>{</highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19" refid="de/d24/classopenage_1_1_interval_timer_1a7dca00ce42fb959b4301bf181e52cce1" refkind="member"><highlight class="normal"><ref refid="de/d24/classopenage_1_1_interval_timer_1a7dca00ce42fb959b4301bf181e52cce1" kindref="member">IntervalTimer::IntervalTimer</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>interval)</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d24/classopenage_1_1_interval_timer" kindref="compound">IntervalTimer</ref>{<ref refid="de/d24/classopenage_1_1_interval_timer_1aa2ad12ec2a0c44e57254eba6f8ddd7e6" kindref="member">interval</ref>,<sp/>-1}<sp/>{</highlight></codeline>
<codeline lineno="22"><highlight class="normal">}</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24" refid="de/d24/classopenage_1_1_interval_timer_1a90b5060c84e4c8f25a389ec67b8470b0" refkind="member"><highlight class="normal"><ref refid="de/d24/classopenage_1_1_interval_timer_1a7dca00ce42fb959b4301bf181e52cce1" kindref="member">IntervalTimer::IntervalTimer</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1aa2ad12ec2a0c44e57254eba6f8ddd7e6" kindref="member">interval</ref>,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1aa6bc2e84f7dd42a603beac62f2bcb26d" kindref="member">max_triggers</ref>)</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>interval{interval},</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1aa6bc2e84f7dd42a603beac62f2bcb26d" kindref="member">max_triggers</ref>{<ref refid="de/d24/classopenage_1_1_interval_timer_1aa6bc2e84f7dd42a603beac62f2bcb26d" kindref="member">max_triggers</ref>},</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1ab19d3fc4826dd8d13862832056c97df8" kindref="member">time_left</ref>{<ref refid="de/d24/classopenage_1_1_interval_timer_1aa2ad12ec2a0c44e57254eba6f8ddd7e6" kindref="member">interval</ref>},</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1ad1685289e75cbd0bcc9669981b6de95f" kindref="member">triggers</ref>{0}<sp/>{</highlight></codeline>
<codeline lineno="30"><highlight class="normal">}</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32" refid="de/d24/classopenage_1_1_interval_timer_1a0b8e2a356a40d6fcb2f3b2e0410a675b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1a0b8e2a356a40d6fcb2f3b2e0410a675b" kindref="member">IntervalTimer::skip_to_trigger</ref>()<sp/>{</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ab19d3fc4826dd8d13862832056c97df8" kindref="member">time_left</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="34"><highlight class="normal">}</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36" refid="de/d24/classopenage_1_1_interval_timer_1acb51f379d7d73ad7fff1197f9fa2335b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1acb51f379d7d73ad7fff1197f9fa2335b" kindref="member">IntervalTimer::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ad1685289e75cbd0bcc9669981b6de95f" kindref="member">triggers</ref><sp/>==<sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1aa6bc2e84f7dd42a603beac62f2bcb26d" kindref="member">max_triggers</ref>)<sp/>{</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ab19d3fc4826dd8d13862832056c97df8" kindref="member">time_left</ref><sp/>&gt;<sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ab19d3fc4826dd8d13862832056c97df8" kindref="member">time_left</ref><sp/>-=<sp/>time;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ab19d3fc4826dd8d13862832056c97df8" kindref="member">time_left</ref><sp/>+=<sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1aa2ad12ec2a0c44e57254eba6f8ddd7e6" kindref="member">interval</ref><sp/>-<sp/>time;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ad1685289e75cbd0bcc9669981b6de95f" kindref="member">triggers</ref><sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="47"><highlight class="normal">}</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49" refid="de/d24/classopenage_1_1_interval_timer_1a14bce56d6b2492831cd28e6f327a641e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1a14bce56d6b2492831cd28e6f327a641e" kindref="member">IntervalTimer::get_time_left</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ab19d3fc4826dd8d13862832056c97df8" kindref="member">time_left</ref>;</highlight></codeline>
<codeline lineno="51"><highlight class="normal">}</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53" refid="de/d24/classopenage_1_1_interval_timer_1adf00dc6610faafd2bd5ce329fcb71868" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1adf00dc6610faafd2bd5ce329fcb71868" kindref="member">IntervalTimer::get_progress</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1.0f<sp/>-<sp/>(this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ab19d3fc4826dd8d13862832056c97df8" kindref="member">time_left</ref><sp/>*<sp/>1.0f<sp/>/<sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1aa2ad12ec2a0c44e57254eba6f8ddd7e6" kindref="member">interval</ref>);</highlight></codeline>
<codeline lineno="55"><highlight class="normal">}</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57" refid="de/d24/classopenage_1_1_interval_timer_1a4612f17977fc6e73da3f46c478568da8" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1a4612f17977fc6e73da3f46c478568da8" kindref="member">IntervalTimer::has_triggers</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ad1685289e75cbd0bcc9669981b6de95f" kindref="member">triggers</ref><sp/>&gt;<sp/>0;</highlight></codeline>
<codeline lineno="59"><highlight class="normal">}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61" refid="de/d24/classopenage_1_1_interval_timer_1a8604ecb1237e6f9be407fe6f9e63c6d6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="de/d24/classopenage_1_1_interval_timer_1a8604ecb1237e6f9be407fe6f9e63c6d6" kindref="member">IntervalTimer::finished</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1ad1685289e75cbd0bcc9669981b6de95f" kindref="member">triggers</ref><sp/>==<sp/>this-&gt;<ref refid="de/d24/classopenage_1_1_interval_timer_1aa6bc2e84f7dd42a603beac62f2bcb26d" kindref="member">max_triggers</ref>;</highlight></codeline>
<codeline lineno="63"><highlight class="normal">}</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a0a84fac6b39ee42340f67905dd631956" kindref="member">UnitAction::show_debug</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67" refid="dc/d74/classopenage_1_1_unit_action_1a6a13e1e645b744982544ae65ef1addf3" refkind="member"><highlight class="normal"><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a6a13e1e645b744982544ae65ef1addf3" kindref="member">UnitAction::adjacent_range</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u)<sp/>{</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d3/df4/namespaceopenage_1_1path_1a7e49ca629b6fed008584d7752dc98e9a" kindref="member">path::path_grid_size</ref><sp/>*<sp/>3<sp/>+<sp/>(u-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;min_axis()<sp/>/<sp/>2L);</highlight></codeline>
<codeline lineno="69"><highlight class="normal">}</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight></codeline>
<codeline lineno="71" refid="dc/d74/classopenage_1_1_unit_action_1a6e508baa62ec19cd81bea7fce1721e17" refkind="member"><highlight class="normal"><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a6e508baa62ec19cd81bea7fce1721e17" kindref="member">UnitAction::get_attack_range</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u)<sp/>{</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>range<sp/>=<sp/>adjacent_range(u);</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(u-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36afc7e987f23de5bd6562b7c0063cad659" kindref="member">attr_type::attack</ref>))<sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">attack</ref><sp/>=<sp/>u-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36afc7e987f23de5bd6562b7c0063cad659" kindref="member">attr_type::attack</ref>&gt;();</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>range<sp/>+=<sp/><ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">attack</ref>.max_range;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>range;</highlight></codeline>
<codeline lineno="78"><highlight class="normal">}</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80" refid="dc/d74/classopenage_1_1_unit_action_1a40320d4e1be2a48373f5b9b0f6bef2ef" refkind="member"><highlight class="normal"><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a40320d4e1be2a48373f5b9b0f6bef2ef" kindref="member">UnitAction::get_heal_range</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u)<sp/>{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>range<sp/>=<sp/>adjacent_range(u);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(u-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a214d940b5313897d9e25b3a2b3533770" kindref="member">attr_type::heal</ref>))<sp/>{</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a214d940b5313897d9e25b3a2b3533770" kindref="member">heal</ref><sp/>=<sp/>u-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a214d940b5313897d9e25b3a2b3533770" kindref="member">attr_type::heal</ref>&gt;();</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>range<sp/>+=<sp/><ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a214d940b5313897d9e25b3a2b3533770" kindref="member">heal</ref>.range;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>range;</highlight></codeline>
<codeline lineno="87"><highlight class="normal">}</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89" refid="dc/d74/classopenage_1_1_unit_action_1a3fd3dd936ea6a850726bcfce9664909a" refkind="member"><highlight class="normal"><ref refid="dc/d74/classopenage_1_1_unit_action_1a3fd3dd936ea6a850726bcfce9664909a" kindref="member">UnitAction::UnitAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3b" kindref="member">graphic_type</ref><sp/>initial_gt)</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>entity{u},</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref>{initial_gt},</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref>{.0f},</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref>{.0f}<sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;g_set<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a6cd7405af72dd0cf3994cee74608cf8b" kindref="member">current_graphics</ref>();</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_set.count(initial_gt)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>utex<sp/>=<sp/>g_set.at(initial_gt);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(utex)<sp/>{</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>=<sp/>utex-&gt;frame_rate;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Broken<sp/>graphic<sp/>(null)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Broken<sp/>graphic<sp/>(not<sp/>available)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>a<sp/>random<sp/>starting<sp/>point<sp/>for<sp/>static<sp/>graphics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>creates<sp/>variations<sp/>in<sp/>trees<sp/>/<sp/>houses<sp/>etc</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>value<sp/>is<sp/>also<sp/>deterministic<sp/>to<sp/>match<sp/>across<sp/>clients</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>=<sp/>(u-&gt;id<sp/>*<sp/>u-&gt;id<sp/>*<sp/>19249)<sp/>&amp;<sp/>0xff;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal">}</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119" refid="dc/d74/classopenage_1_1_unit_action_1acbadd90ff8cee12d01aa9fd490501c1a" refkind="member"><highlight class="normal"><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3b" kindref="member">graphic_type</ref><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1acbadd90ff8cee12d01aa9fd490501c1a" kindref="member">UnitAction::type</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref>;</highlight></codeline>
<codeline lineno="121"><highlight class="normal">}</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123" refid="dc/d74/classopenage_1_1_unit_action_1abfdd7e2764fd795c02ce0a5471563508" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1abfdd7e2764fd795c02ce0a5471563508" kindref="member">UnitAction::current_frame</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref>;</highlight></codeline>
<codeline lineno="125"><highlight class="normal">}</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127" refid="dc/d74/classopenage_1_1_unit_action_1a6cd7405af72dd0cf3994cee74608cf8b" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="da/d23/namespaceopenage_1a905fde9cff5779781eb779ca95d80cf1" kindref="member">graphic_set</ref><sp/>&amp;<ref refid="dc/d74/classopenage_1_1_unit_action_1a6cd7405af72dd0cf3994cee74608cf8b" kindref="member">UnitAction::current_graphics</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>the<sp/>default<sp/>graphic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a2d7da7c7ccd95557e10d54a58a033187" kindref="member">unit_type</ref>-&gt;<ref refid="dd/d39/classopenage_1_1_unit_type_1aaf36044630d13a601a4245e34419df90" kindref="member">graphics</ref>;</highlight></codeline>
<codeline lineno="131"><highlight class="normal">}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133" refid="dc/d74/classopenage_1_1_unit_action_1aef5ad04daa194a06790b4f36ed8a3e83" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1aef5ad04daa194a06790b4f36ed8a3e83" kindref="member">UnitAction::draw_debug</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d6/d40/classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>&amp;<ref refid="d3/d8f/namespaceopenage_1_1gui_1af04609e6ca54bc68fde786f6bb33f14e" kindref="member">engine</ref>)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>draw<sp/>debug<sp/>content<sp/>if<sp/>available</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="dc/d74/classopenage_1_1_unit_action_1a0a84fac6b39ee42340f67905dd631956" kindref="member">show_debug</ref><sp/>&amp;&amp;<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a0bbcb9637ce725b95cbe818204921e4f" kindref="member">debug_draw_action</ref>)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a0bbcb9637ce725b95cbe818204921e4f" kindref="member">debug_draw_action</ref>(engine);</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="138"><highlight class="normal">}</highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight></codeline>
<codeline lineno="140" refid="dc/d74/classopenage_1_1_unit_action_1a3ab11130480adc3cfe156af7cfb7a58d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a3ab11130480adc3cfe156af7cfb7a58d" kindref="member">UnitAction::face_towards</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>pos)<sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36aef72c37be9d1b9e6e5bbd6ef09448abe" kindref="member">attr_type::direction</ref>))<sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;d_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36aef72c37be9d1b9e6e5bbd6ef09448abe" kindref="member">attr_type::direction</ref>&gt;();</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>d_attr.unit_dir<sp/>=<sp/>pos<sp/>-<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="145"><highlight class="normal">}</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147" refid="dc/d74/classopenage_1_1_unit_action_1a7beffb7ad454cf467d7a6b843df939c7" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a7beffb7ad454cf467d7a6b843df939c7" kindref="member">UnitAction::damage_unit</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>&amp;target)<sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>killed<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target.<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>))<sp/>{</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dm<sp/>=<sp/>target.<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>&gt;();</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>is<sp/>the<sp/>damage<sp/>calculation<sp/>system</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dm.hp<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>already<sp/>killed,<sp/>do<sp/>nothing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target.<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a3ee45b1ff632881c66b6b92f45a47fd7" kindref="member">attr_type::armor</ref>)<sp/>&amp;&amp;<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36afc7e987f23de5bd6562b7c0063cad659" kindref="member">attr_type::attack</ref>))<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a3ee45b1ff632881c66b6b92f45a47fd7" kindref="member">armor</ref><sp/>=<sp/>target.<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a3ee45b1ff632881c66b6b92f45a47fd7" kindref="member">attr_type::armor</ref>&gt;().<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a3ee45b1ff632881c66b6b92f45a47fd7" kindref="member">armor</ref>;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;damage<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36afc7e987f23de5bd6562b7c0063cad659" kindref="member">attr_type::attack</ref>&gt;().damage;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>actual_damage<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;pair<sp/>:<sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a3ee45b1ff632881c66b6b92f45a47fd7" kindref="member">armor</ref>)<sp/>{</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>search<sp/>=<sp/>damage.find(pair.first);</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(search<sp/>!=<sp/>damage.end())<sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pair.second<sp/>&lt;<sp/>search-&gt;second)<sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>actual_damage<sp/>+=<sp/>search-&gt;second<sp/>-<sp/>pair.second;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>add<sp/>elevation<sp/>modifier<sp/>here</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(actual_damage<sp/>&lt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>actual_damage<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dm.hp<sp/>&gt;<sp/>actual_damage)<sp/>{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dm.hp<sp/>-=<sp/>actual_damage;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dm.hp<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>killed<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>remove<sp/>(keep<sp/>for<sp/>testing)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>dmg<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dm.hp<sp/>&gt;<sp/>dmg)<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dm.hp<sp/>-=<sp/>dmg;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dm.hp<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>killed<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(killed)<sp/>{</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>killed,<sp/>give<sp/>credit<sp/>to<sp/>a<sp/>player</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>))<sp/>{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>.killed_unit(target);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>killed;</highlight></codeline>
<codeline lineno="206"><highlight class="normal">}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208" refid="dc/d74/classopenage_1_1_unit_action_1a16660bd780984c6f11ba30e0c7f634ad" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a16660bd780984c6f11ba30e0c7f634ad" kindref="member">UnitAction::move_to</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>&amp;target,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="da/d23/namespaceopenage_1a355391982e6c1257c3fc4de3b6402b3aa0f99c9f01a52f21f547acbeb2bb67dc5" kindref="member">use_range</ref>)<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;player<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d8/dda/classopenage_1_1_command" kindref="compound">Command</ref><sp/>cmd(player,<sp/>&amp;target);</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/>cmd.set_ability(<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a3734a903022249b3010be1897042568e" kindref="member">ability_type::move</ref>);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(use_range)<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.add_flag(<ref refid="da/d23/namespaceopenage_1a355391982e6c1257c3fc4de3b6402b3aa0f99c9f01a52f21f547acbeb2bb67dc5" kindref="member">command_flag::use_range</ref>);</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1ac5dcdf3180dcd4bdce67b765d8ef2134" kindref="member">queue_cmd</ref>(cmd);</highlight></codeline>
<codeline lineno="216"><highlight class="normal">}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218" refid="d6/ddd/classopenage_1_1_target_action_1adc56f07dc94e70968fb02276f1a3ae57" refkind="member"><highlight class="normal"><ref refid="d6/ddd/classopenage_1_1_target_action_1adc56f07dc94e70968fb02276f1a3ae57" kindref="member">TargetAction::TargetAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3b" kindref="member">graphic_type</ref><sp/>gt,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>r,<sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>rad)</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>(u,<sp/>gt),</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>target{r},</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1ab11cdd208c9eb76eb88bfdea0c0d054a" kindref="member">target_type_id</ref>{0},</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1a5b6ca88d9b6aec08b4d03697f0cd03a1" kindref="member">repath_attempts</ref>{10},</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1ace49b8e31592f2e8671dff1d681e8a59" kindref="member">end_action</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1abf5a6940a40fea92b70b36482c1d1ee0" kindref="member">radius</ref>{rad}<sp/>{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>target_ptr<sp/>=<sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>();</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1ab11cdd208c9eb76eb88bfdea0c0d054a" kindref="member">target_type_id</ref><sp/>=<sp/>target_ptr-&gt;unit_type-&gt;id();</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>initial<sp/>value<sp/>for<sp/>distance</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a2ad32343ebe475f1f3c1477f659314db" kindref="member">update_distance</ref>();</highlight></codeline>
<codeline lineno="235"><highlight class="normal">}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237" refid="d6/ddd/classopenage_1_1_target_action_1a8ac661518fe44bcbdca2f97212d90bf7" refkind="member"><highlight class="normal"><ref refid="d6/ddd/classopenage_1_1_target_action_1adc56f07dc94e70968fb02276f1a3ae57" kindref="member">TargetAction::TargetAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*u,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3b" kindref="member">graphic_type</ref><sp/>gt,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>r)</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action" kindref="compound">TargetAction</ref>(u,<sp/>gt,<sp/>r,<sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a6a13e1e645b744982544ae65ef1addf3" kindref="member">adjacent_range</ref>(u))<sp/>{</highlight></codeline>
<codeline lineno="240"><highlight class="normal">}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242" refid="d6/ddd/classopenage_1_1_target_action_1af63a55c8043382d2648815d46e2c4c92" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1af63a55c8043382d2648815d46e2c4c92" kindref="member">TargetAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>target_ptr<sp/>=<sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a2ad32343ebe475f1f3c1477f659314db" kindref="member">update_distance</ref>();</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!target_ptr)<sp/>{</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>target<sp/>has<sp/>become<sp/>invalid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>update<sp/>moves<sp/>a<sp/>unit<sp/>within<sp/>radius<sp/>of<sp/>the<sp/>target</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>once<sp/>within<sp/>the<sp/>radius<sp/>the<sp/>update<sp/>gets<sp/>passed<sp/>to<sp/>the<sp/>class</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>derived<sp/>from<sp/>TargetAction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>direction<sp/>unit<sp/>should<sp/>face</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a3ab11130480adc3cfe156af7cfb7a58d" kindref="member">face_towards</ref>(target_ptr-&gt;location-&gt;pos.draw);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>move<sp/>to<sp/>within<sp/>the<sp/>set<sp/>radius</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;dist_to_target<sp/>&lt;=<sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1abf5a6940a40fea92b70b36482c1d1ee0" kindref="member">radius</ref>)<sp/>{</highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>derived<sp/>class<sp/>controls<sp/>what<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>when<sp/>in<sp/>range<sp/>of<sp/>the<sp/>target</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a0689cb2d55ae8ad82e704c79b4596bca" kindref="member">update_in_range</ref>(time,<sp/>target_ptr);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a5b6ca88d9b6aec08b4d03697f0cd03a1" kindref="member">repath_attempts</ref><sp/>=<sp/>10;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a5b6ca88d9b6aec08b4d03697f0cd03a1" kindref="member">repath_attempts</ref>)<sp/>{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>out<sp/>of<sp/>range<sp/>so<sp/>try<sp/>move<sp/>towards</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>this<sp/>unit<sp/>has<sp/>a<sp/>move<sp/>ability</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a16660bd780984c6f11ba30e0c7f634ad" kindref="member">move_to</ref>(*target_ptr);</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a5b6ca88d9b6aec08b4d03697f0cd03a1" kindref="member">repath_attempts</ref><sp/>-=<sp/>1;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>unit<sp/>is<sp/>stuck</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1ace49b8e31592f2e8671dff1d681e8a59" kindref="member">end_action</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal">}</highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight></codeline>
<codeline lineno="277" refid="d6/ddd/classopenage_1_1_target_action_1ac489c70f995ea358f685676e403df8cc" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1ac489c70f995ea358f685676e403df8cc" kindref="member">TargetAction::on_completion</ref>()<sp/>{</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>not<sp/>retask<sp/>if<sp/>action<sp/>is<sp/>forced<sp/>to<sp/>end</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1ace49b8e31592f2e8671dff1d681e8a59" kindref="member">end_action</ref><sp/>||</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>)<sp/>{</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>retask<sp/>units<sp/>on<sp/>nearby<sp/>objects</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>such<sp/>as<sp/>gathers<sp/>targeting<sp/>a<sp/>new<sp/>resource</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>when<sp/>the<sp/>current<sp/>target<sp/>expires</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a32fc1723b0f6ce5e3bdb76794ff1ccf1" kindref="member">on_completion_in_range</ref>(this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1ab11cdd208c9eb76eb88bfdea0c0d054a" kindref="member">target_type_id</ref>);</highlight></codeline>
<codeline lineno="288"><highlight class="normal">}</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290" refid="d6/ddd/classopenage_1_1_target_action_1acd97248a087415b6d08fa3e97e90397d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1acd97248a087415b6d08fa3e97e90397d" kindref="member">TargetAction::completed</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1ace49b8e31592f2e8671dff1d681e8a59" kindref="member">end_action</ref><sp/>||</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>()<sp/>||</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>()-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>)<sp/>{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a43bd7367738e16d715df0a1bfbd080cf" kindref="member">completed_in_range</ref>(this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>());</highlight></codeline>
<codeline lineno="297"><highlight class="normal">}</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299" refid="d6/ddd/classopenage_1_1_target_action_1a285c6a59466e76c934a21221e9990f86" refkind="member"><highlight class="normal"><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1a285c6a59466e76c934a21221e9990f86" kindref="member">TargetAction::distance_to_target</ref>()<sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a440df45773b6e3b6e2a0b60f1ba6ca98" kindref="member">dist_to_target</ref>;</highlight></codeline>
<codeline lineno="301"><highlight class="normal">}</highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303" refid="d6/ddd/classopenage_1_1_target_action_1a2ad32343ebe475f1f3c1477f659314db" refkind="member"><highlight class="normal"><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*<ref refid="d6/ddd/classopenage_1_1_target_action_1a2ad32343ebe475f1f3c1477f659314db" kindref="member">TargetAction::update_distance</ref>()<sp/>{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>object<sp/>is<sp/>not<sp/>garrisoned</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>target_ptr<sp/>=<sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>();</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!target_ptr-&gt;location)<sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>distance</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a440df45773b6e3b6e2a0b60f1ba6ca98" kindref="member">dist_to_target</ref><sp/>=<sp/>target_ptr-&gt;location-&gt;from_edge(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>the<sp/>targeted<sp/>unit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>target_ptr;</highlight></codeline>
<codeline lineno="319"><highlight class="normal">}</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="321" refid="d6/ddd/classopenage_1_1_target_action_1a234df6738799d71928d3fc3acc8d39ab" refkind="member"><highlight class="normal"><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1a234df6738799d71928d3fc3acc8d39ab" kindref="member">TargetAction::get_target</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>;</highlight></codeline>
<codeline lineno="323"><highlight class="normal">}</highlight></codeline>
<codeline lineno="324"><highlight class="normal"></highlight></codeline>
<codeline lineno="325" refid="d6/ddd/classopenage_1_1_target_action_1a4f8c4aca219e96e7e0f2e8439385d7b1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1a4f8c4aca219e96e7e0f2e8439385d7b1" kindref="member">TargetAction::get_target_type_id</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1ab11cdd208c9eb76eb88bfdea0c0d054a" kindref="member">target_type_id</ref>;</highlight></codeline>
<codeline lineno="327"><highlight class="normal">}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329" refid="d6/ddd/classopenage_1_1_target_action_1a48de4ef9580b1202464808af55b78fae" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1a48de4ef9580b1202464808af55b78fae" kindref="member">TargetAction::set_target</ref>(<ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>new_target)<sp/>{</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(new_target.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref><sp/>=<sp/>new_target;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a2ad32343ebe475f1f3c1477f659314db" kindref="member">update_distance</ref>();</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1ace49b8e31592f2e8671dff1d681e8a59" kindref="member">end_action</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="337"><highlight class="normal">}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight></codeline>
<codeline lineno="339" refid="d6/dd7/classopenage_1_1_decay_action_1ae358f662cbbce7df5b5c0a4f7c59cbb0" refkind="member"><highlight class="normal"><ref refid="d6/dd7/classopenage_1_1_decay_action_1ae358f662cbbce7df5b5c0a4f7c59cbb0" kindref="member">DecayAction::DecayAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e)</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>(e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3b" kindref="member">graphic_type</ref>::<ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">standing</ref>),</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>end_frame{.0f}<sp/>{</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;g_set<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a6cd7405af72dd0cf3994cee74608cf8b" kindref="member">current_graphics</ref>();</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_set.count(this-&gt;graphic)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/dd7/classopenage_1_1_decay_action_1a6bfc7de58c273075516fdc580ecf2929" kindref="member">end_frame</ref><sp/>=<sp/>g_set.at(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref>)-&gt;frame_count<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="348"><highlight class="normal">}</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350" refid="d6/dd7/classopenage_1_1_decay_action_1a4c49cb25e83bcde8dbab2abd606c4cb1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/dd7/classopenage_1_1_decay_action_1a4c49cb25e83bcde8dbab2abd606c4cb1" kindref="member">DecayAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>/<sp/>10000.0f;</highlight></codeline>
<codeline lineno="352"><highlight class="normal">}</highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight></codeline>
<codeline lineno="354" refid="d6/dd7/classopenage_1_1_decay_action_1af64495c81f78d627e726254329a68205" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/dd7/classopenage_1_1_decay_action_1af64495c81f78d627e726254329a68205" kindref="member">DecayAction::on_completion</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356" refid="d6/dd7/classopenage_1_1_decay_action_1abe448cf9a59766e8a6bf77b0ed870b2e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d6/dd7/classopenage_1_1_decay_action_1abe448cf9a59766e8a6bf77b0ed870b2e" kindref="member">DecayAction::completed</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>&gt;<sp/>this-&gt;<ref refid="d6/dd7/classopenage_1_1_decay_action_1a6bfc7de58c273075516fdc580ecf2929" kindref="member">end_frame</ref>;</highlight></codeline>
<codeline lineno="358"><highlight class="normal">}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360" refid="df/d52/classopenage_1_1_dead_action_1a1664940d9230b21fa686155dd4929dba" refkind="member"><highlight class="normal"><ref refid="df/d52/classopenage_1_1_dead_action_1a1664940d9230b21fa686155dd4929dba" kindref="member">DeadAction::DeadAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/>std::function&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">()&gt;<sp/>on_complete)</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>(e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3b" kindref="member">graphic_type</ref>::<ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba564202d4005974a8279609ef0f95d43b" kindref="member">dying</ref>),</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/dd7/classopenage_1_1_decay_action_1a6bfc7de58c273075516fdc580ecf2929" kindref="member">end_frame</ref>{.0f},</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="df/d52/classopenage_1_1_dead_action_1a2a3c6b2261bdcffe1bd35253e488d9cb" kindref="member">on_complete_func</ref>{on_complete}<sp/>{</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;g_set<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a6cd7405af72dd0cf3994cee74608cf8b" kindref="member">current_graphics</ref>();</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_set.count(<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref>)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="df/d52/classopenage_1_1_dead_action_1af2f70e785f65066f0cf4e0aeede0ef50" kindref="member">end_frame</ref><sp/>=<sp/>g_set.at(<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref>)-&gt;frame_count<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="370"><highlight class="normal">}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372" refid="df/d52/classopenage_1_1_dead_action_1aed142b3043beef29d27b16b06887c701" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="df/d52/classopenage_1_1_dead_action_1aed142b3043beef29d27b16b06887c701" kindref="member">DeadAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>))<sp/>{</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dm<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>&gt;();</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dm.hp<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>decay<sp/>resources</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>))<sp/>{</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">resource</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">resource</ref>.decay<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">resource</ref>.amount<sp/>-=<sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">resource</ref>.decay;</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame<sp/>but<sp/>do<sp/>not<sp/>pass<sp/>the<sp/>end<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>end<sp/>frame<sp/>will<sp/>remain<sp/>if<sp/>the<sp/>object<sp/>carries<sp/>resources</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;frame<sp/>&lt;<sp/>this-&gt;<ref refid="df/d52/classopenage_1_1_dead_action_1af2f70e785f65066f0cf4e0aeede0ef50" kindref="member">end_frame</ref>)<sp/>{</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>0.001<sp/>+<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>/<sp/>3.0f;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>=<sp/>this-&gt;<ref refid="df/d52/classopenage_1_1_dead_action_1af2f70e785f65066f0cf4e0aeede0ef50" kindref="member">end_frame</ref>;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="394"><highlight class="normal">}</highlight></codeline>
<codeline lineno="395"><highlight class="normal"></highlight></codeline>
<codeline lineno="396" refid="df/d52/classopenage_1_1_dead_action_1a27ffe695020847a2bb58018a1133a342" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="df/d52/classopenage_1_1_dead_action_1a27ffe695020847a2bb58018a1133a342" kindref="member">DeadAction::on_completion</ref>()<sp/>{</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>))<sp/>{</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>.active_unit_removed(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>);<sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>move<sp/>before<sp/>the<sp/>start<sp/>of<sp/>dead<sp/>action?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="df/d52/classopenage_1_1_dead_action_1a2a3c6b2261bdcffe1bd35253e488d9cb" kindref="member">on_complete_func</ref>();</highlight></codeline>
<codeline lineno="403"><highlight class="normal">}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405" refid="df/d52/classopenage_1_1_dead_action_1ad89ee79aa618b974b24f76e54e81ec29" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="df/d52/classopenage_1_1_dead_action_1ad89ee79aa618b974b24f76e54e81ec29" kindref="member">DeadAction::completed</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="406"><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>resource,<sp/>trees/huntables<sp/>with<sp/>resource<sp/>are<sp/>not<sp/>removed<sp/>but<sp/>not<sp/>workers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>)<sp/>&amp;&amp;<sp/>!this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">attr_type::worker</ref>))<sp/>{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;res_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>res_attr.amount<sp/>&lt;=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>cannot<sp/>complete<sp/>when<sp/>resource<sp/>remains</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>&gt;<sp/>this-&gt;<ref refid="df/d52/classopenage_1_1_dead_action_1af2f70e785f65066f0cf4e0aeede0ef50" kindref="member">end_frame</ref>;</highlight></codeline>
<codeline lineno="413"><highlight class="normal">}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415" refid="d4/d40/classopenage_1_1_foundation_action_1a594f192345d78e546e1600c49f844ae4" refkind="member"><highlight class="normal"><ref refid="d4/d40/classopenage_1_1_foundation_action_1a594f192345d78e546e1600c49f844ae4" kindref="member">FoundationAction::FoundationAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>add_destruction)</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>(e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3b" kindref="member">graphic_type</ref>::<ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bae62068a633874d298459a25f8868d306" kindref="member">construct</ref>),</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/>add_destruct_effect{add_destruction},</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d4/d40/classopenage_1_1_foundation_action_1a7d94cd0fbc846bf1665ddf2cf3ae07be" kindref="member">cancel</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal">}</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422" refid="d4/d40/classopenage_1_1_foundation_action_1a64d49836c0b234cd233f631248c895b6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d4/d40/classopenage_1_1_foundation_action_1a64d49836c0b234cd233f631248c895b6" kindref="member">FoundationAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>)<sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d4/d40/classopenage_1_1_foundation_action_1a7d94cd0fbc846bf1665ddf2cf3ae07be" kindref="member">cancel</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="426"><highlight class="normal">}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428" refid="d4/d40/classopenage_1_1_foundation_action_1a5415b3f1ad67e64d171c5762cec97479" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d4/d40/classopenage_1_1_foundation_action_1a5415b3f1ad67e64d171c5762cec97479" kindref="member">FoundationAction::on_completion</ref>()<sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>nothing<sp/>if<sp/>construction<sp/>is<sp/>cancelled</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d4/d40/classopenage_1_1_foundation_action_1a7d94cd0fbc846bf1665ddf2cf3ae07be" kindref="member">cancel</ref>)<sp/>{</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>))<sp/>{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>.active_unit_added(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>destruction<sp/>effect<sp/>when<sp/>available</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d4/d40/classopenage_1_1_foundation_action_1ab7626198d87de5875e82f1e8c25b83e3" kindref="member">add_destruct_effect</ref>)<sp/>{</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1aecd686fafc67487f4df4d3637f2621f4" kindref="member">push_action</ref>(std::make_unique&lt;DeadAction&gt;(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1aecd686fafc67487f4df4d3637f2621f4" kindref="member">push_action</ref>(std::make_unique&lt;IdleAction&gt;(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="445"><highlight class="normal">}</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447" refid="d4/d40/classopenage_1_1_foundation_action_1acb94c9f36774fdf9f94c7a6fc2ce9df9" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d4/d40/classopenage_1_1_foundation_action_1acb94c9f36774fdf9f94c7a6fc2ce9df9" kindref="member">FoundationAction::completed</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d4/d40/classopenage_1_1_foundation_action_1a7d94cd0fbc846bf1665ddf2cf3ae07be" kindref="member">cancel</ref><sp/>||</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>&gt;().<ref refid="d4/d40/classopenage_1_1_foundation_action_1acb94c9f36774fdf9f94c7a6fc2ce9df9" kindref="member">completed</ref><sp/>&gt;=<sp/>1.0f));</highlight></codeline>
<codeline lineno="451"><highlight class="normal">}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453" refid="da/dd8/classopenage_1_1_idle_action_1abcf912f0414876c23214ee699b2f1763" refkind="member"><highlight class="normal"><ref refid="da/dd8/classopenage_1_1_idle_action_1abcf912f0414876c23214ee699b2f1763" kindref="member">IdleAction::IdleAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e)</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>(e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3b" kindref="member">graphic_type</ref>::<ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">standing</ref>)<sp/>{</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>terrain<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;get_terrain();</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>current_tile<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw.to_tile3().to_tile();</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="da/dd8/classopenage_1_1_idle_action_1a0bffa20bbade5d23ee9769bab68e0487" kindref="member">search</ref><sp/>=<sp/>std::make_shared&lt;TerrainSearch&gt;(terrain,<sp/>current_tile,<sp/>5.0f);</highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>currently<sp/>allow<sp/>attack<sp/>and<sp/>heal<sp/>automatically</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="da/dd8/classopenage_1_1_idle_action_1ac20b323a66cb5a327a56bee631acb49d" kindref="member">auto_abilities</ref><sp/>=<sp/><ref refid="d3/d44/classopenage_1_1_unit_ability_1a282f5d02a2a6912670b27aedb7f4f337" kindref="member">UnitAbility::set_from_list</ref>({<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">ability_type::attack</ref>,<sp/><ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a214d940b5313897d9e25b3a2b3533770" kindref="member">ability_type::heal</ref>});</highlight></codeline>
<codeline lineno="462"><highlight class="normal">}</highlight></codeline>
<codeline lineno="463"><highlight class="normal"></highlight></codeline>
<codeline lineno="464" refid="da/dd8/classopenage_1_1_idle_action_1a90d182b9575459830744488f776a2f4e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="da/dd8/classopenage_1_1_idle_action_1a90d182b9575459830744488f776a2f4e" kindref="member">IdleAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="465"><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>auto<sp/>task<sp/>searching</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref><sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;entity-&gt;has_attribute(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36afc7e987f23de5bd6562b7c0063cad659" kindref="member">attr_type::attack</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36af1a41f239896dc63a6eaeba863f0e7ce" kindref="member">attr_type::formation</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36af1a41f239896dc63a6eaeba863f0e7ce" kindref="member">attr_type::formation</ref>&gt;().stance<sp/>!=<sp/><ref refid="da/d23/namespaceopenage_1a54fa9238a7f977d8d12d4b8422f3c6eda8cb06461d4398cb0457b5f4cf50c06fc" kindref="member">attack_stance::do_nothing</ref>)<sp/>{</highlight></codeline>
<codeline lineno="472"><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>restart<sp/>search<sp/>from<sp/>new<sp/>tile<sp/>when<sp/>moved</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>terrain<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;get_terrain();</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>current_tile<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw.to_tile3().to_tile();</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(current_tile<sp/>==<sp/>this-&gt;<ref refid="da/dd8/classopenage_1_1_idle_action_1a0bffa20bbade5d23ee9769bab68e0487" kindref="member">search</ref>-&gt;start_tile()))<sp/>{</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="da/dd8/classopenage_1_1_idle_action_1a0bffa20bbade5d23ee9769bab68e0487" kindref="member">search</ref><sp/>=<sp/>std::make_shared&lt;TerrainSearch&gt;(terrain,<sp/>current_tile,<sp/>5.0f);</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>search<sp/>one<sp/>tile<sp/>per<sp/>update</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>next<sp/>tile<sp/>will<sp/>always<sp/>be<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d10/structopenage_1_1coord_1_1tile" kindref="compound">coord::tile</ref><sp/>tile<sp/>=<sp/>this-&gt;<ref refid="da/dd8/classopenage_1_1_idle_action_1a0bffa20bbade5d23ee9769bab68e0487" kindref="member">search</ref>-&gt;next_tile();</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="db/dde/structopenage_1_1tile__data" kindref="compound">tile_data</ref><sp/>=<sp/>terrain-&gt;get_data(tile);</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;player<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>and<sp/>actions<sp/>which<sp/>can<sp/>be<sp/>invoked</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>object_location<sp/>:<sp/><ref refid="db/dde/structopenage_1_1tile__data" kindref="compound">tile_data</ref>-&gt;obj)<sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/dda/classopenage_1_1_command" kindref="compound">Command</ref><sp/><ref refid="d3/df4/namespaceopenage_1_1path_1a047e97b9a81a866f064ad6d6f8dddfd6" kindref="member">to_object</ref>(player,<sp/>&amp;object_location-&gt;unit);</highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>only<sp/>allow<sp/>abilities<sp/>in<sp/>the<sp/>set<sp/>of<sp/>auto<sp/>ability<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>to_object.<ref refid="d8/dda/classopenage_1_1_command_1a2590ec72e751bbc9d901d30b86a9be04" kindref="member">set_ability_set</ref>(<ref refid="da/dd8/classopenage_1_1_idle_action_1ac20b323a66cb5a327a56bee631acb49d" kindref="member">auto_abilities</ref>);</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1ac5dcdf3180dcd4bdce67b765d8ef2134" kindref="member">queue_cmd</ref>(to_object))<sp/>{</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>generate<sp/>resources</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>move<sp/>elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a07c8a39fbe04116af6aa6e9dfc13f488" kindref="member">attr_type::resource_generator</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>))<sp/>{</highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;player<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a07c8a39fbe04116af6aa6e9dfc13f488" kindref="member">resource_generator</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a07c8a39fbe04116af6aa6e9dfc13f488" kindref="member">attr_type::resource_generator</ref>&gt;();</highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/de9/classopenage_1_1_resource_bundle" kindref="compound">ResourceBundle</ref><sp/>resources<sp/>=<sp/>resource_generator.resources.<ref refid="d2/de9/classopenage_1_1_resource_bundle_1aec4c3c3cae1b78ff42a0bc533929e51c" kindref="member">clone</ref>();</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(resource_generator.rate<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resources<sp/>*=<sp/>time;</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>add<sp/>in<sp/>intervals<sp/>and<sp/>not<sp/>continuously</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resources<sp/>*=<sp/>time<sp/>*<sp/>resource_generator.rate;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.receive(resources);</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="516"><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>unit<sp/>carrying<sp/>resources<sp/>take<sp/>the<sp/>carrying<sp/>sprite<sp/>when<sp/>idle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we&apos;re<sp/>not<sp/>updating<sp/>frames<sp/>because<sp/>the<sp/>carrying<sp/>sprite<sp/>is<sp/>walking</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">attr_type::worker</ref>))<sp/>{</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;worker_resource<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(worker_resource.amount<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref><sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baa771e1fd1a582e9cf05f5213586f1965" kindref="member">graphic_type::carrying</ref>;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref><sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>/<sp/>20.0f;</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>/<sp/>20.0f;</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="532"><highlight class="normal">}</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534" refid="da/dd8/classopenage_1_1_idle_action_1a63b599599c1e5b1e0249b4ce11722dbc" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="da/dd8/classopenage_1_1_idle_action_1a63b599599c1e5b1e0249b4ce11722dbc" kindref="member">IdleAction::on_completion</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="535"><highlight class="normal"></highlight></codeline>
<codeline lineno="536" refid="da/dd8/classopenage_1_1_idle_action_1af276ff712d523244b3094e091ba576e5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="da/dd8/classopenage_1_1_idle_action_1af276ff712d523244b3094e091ba576e5" kindref="member">IdleAction::completed</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>))<sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dm<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>&gt;();</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>dm.hp<sp/>==<sp/>0;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>))<sp/>{</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;res_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>res_attr.amount<sp/>&lt;=<sp/>0.0;</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="546"><highlight class="normal">}</highlight></codeline>
<codeline lineno="547"><highlight class="normal"></highlight></codeline>
<codeline lineno="548" refid="d2/d4e/classopenage_1_1_move_action_1a8ebbeeb2d2ebf769a9ee6a55020062c5" refkind="member"><highlight class="normal"><ref refid="d2/d4e/classopenage_1_1_move_action_1a8ebbeeb2d2ebf769a9ee6a55020062c5" kindref="member">MoveAction::MoveAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>tar,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>repath)</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba099410f601830a2873dd98ea0acf711d" kindref="member">graphic_type::walking</ref>},</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>{},</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref>(tar),</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a1a236e7248c0cf631c4d00ed2697343e" kindref="member">radius</ref>{<ref refid="d3/df4/namespaceopenage_1_1path_1a7e49ca629b6fed008584d7752dc98e9a" kindref="member">path::path_grid_size</ref>},</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1afe6716ce02ded6ac4d8fd9c2648afe3e" kindref="member">allow_repath</ref>{repath},</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a9dae43f975b7c1f0ef8f077cd61df906" kindref="member">end_action</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a1b34ceffe821a5ef2afd3c3fc08ae3d1" kindref="member">initialise</ref>();</highlight></codeline>
<codeline lineno="557"><highlight class="normal">}</highlight></codeline>
<codeline lineno="558"><highlight class="normal"></highlight></codeline>
<codeline lineno="559" refid="d2/d4e/classopenage_1_1_move_action_1aad35a8de5076e73f74447f31760ee200" refkind="member"><highlight class="normal"><ref refid="d2/d4e/classopenage_1_1_move_action_1a8ebbeeb2d2ebf769a9ee6a55020062c5" kindref="member">MoveAction::MoveAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>tar,<sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>within_range)</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>{e,<sp/>graphic_type::walking},</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>{tar},</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref>(tar.get()-&gt;location-&gt;pos.draw),</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a1a236e7248c0cf631c4d00ed2697343e" kindref="member">radius</ref>{within_range},</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1afe6716ce02ded6ac4d8fd9c2648afe3e" kindref="member">allow_repath</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a9dae43f975b7c1f0ef8f077cd61df906" kindref="member">end_action</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a1b34ceffe821a5ef2afd3c3fc08ae3d1" kindref="member">initialise</ref>();</highlight></codeline>
<codeline lineno="568"><highlight class="normal">}</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight></codeline>
<codeline lineno="570" refid="d2/d4e/classopenage_1_1_move_action_1a1b34ceffe821a5ef2afd3c3fc08ae3d1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a1b34ceffe821a5ef2afd3c3fc08ae3d1" kindref="member">MoveAction::initialise</ref>()<sp/>{</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>switch<sp/>workers<sp/>to<sp/>the<sp/>carrying<sp/>graphic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">attr_type::worker</ref>))<sp/>{</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;worker_resource<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(worker_resource.amount<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref><sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baa771e1fd1a582e9cf05f5213586f1965" kindref="member">graphic_type::carrying</ref>;</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="578"><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>initial<sp/>distance</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a87eb54704dff471c3401ec7c7a88b044" kindref="member">set_distance</ref>();</highlight></codeline>
<codeline lineno="581"><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>an<sp/>initial<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a4e56fc82672dfaf3c62f846afbd6df69" kindref="member">set_path</ref>();</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a0bbcb9637ce725b95cbe818204921e4f" kindref="member">debug_draw_action</ref><sp/>=<sp/>[&amp;](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d6/d40/classopenage_1_1_engine" kindref="compound">Engine</ref><sp/>&amp;<ref refid="d3/d8f/namespaceopenage_1_1gui_1af04609e6ca54bc68fde786f6bb33f14e" kindref="member">engine</ref>)<sp/>{</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref>.<ref refid="d0/d8e/classopenage_1_1path_1_1_path_1a995f13d74a8c7d36a8d63b2deed6eb56" kindref="member">draw_path</ref>(<ref refid="d3/d8f/namespaceopenage_1_1gui_1af04609e6ca54bc68fde786f6bb33f14e" kindref="member">engine</ref>.coord);</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="587"><highlight class="normal">}</highlight></codeline>
<codeline lineno="588"><highlight class="normal"></highlight></codeline>
<codeline lineno="589" refid="d2/d4e/classopenage_1_1_move_action_1a0a433c045ad20453ac960cb558abf211" refkind="member"><highlight class="normal"><ref refid="d2/d4e/classopenage_1_1_move_action_1a0a433c045ad20453ac960cb558abf211" kindref="member">MoveAction::~MoveAction</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight></codeline>
<codeline lineno="591" refid="d2/d4e/classopenage_1_1_move_action_1afa4e4983c00b0207af76c7b717e81a05" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1afa4e4983c00b0207af76c7b717e81a05" kindref="member">MoveAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>a<sp/>unit<sp/>is<sp/>targeted,<sp/>which<sp/>may<sp/>move</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;target_object<sp/>=<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>()-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>;</highlight></codeline>
<codeline lineno="595"><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>for<sp/>garrisoning<sp/>objects</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!target_object)<sp/>{</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a9dae43f975b7c1f0ef8f077cd61df906" kindref="member">end_action</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;target_pos<sp/>=<sp/>target_object-&gt;pos.draw;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;unit_pos<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>repath<sp/>if<sp/>target<sp/>changes<sp/>tiles<sp/>by<sp/>a<sp/>threshold</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>repathing<sp/>is<sp/>more<sp/>frequent<sp/>when<sp/>the<sp/>unit<sp/>is</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>close<sp/>to<sp/>its<sp/>target</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>tdx<sp/>=<sp/>target_pos.ne<sp/>-<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref>.ne;</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>tdy<sp/>=<sp/>target_pos.se<sp/>-<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref>.se;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>udx<sp/>=<sp/>unit_pos.ne<sp/>-<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref>.ne;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>udy<sp/>=<sp/>unit_pos.se<sp/>-<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref>.se;</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref>.<ref refid="d0/d8e/classopenage_1_1path_1_1_path_1a6f052fbfe0743c8204c2f37842176976" kindref="member">waypoints</ref>.empty()<sp/>||<sp/><ref refid="d8/dcc/namespacestd_1a8058d6b15a78f7a977945ee4d62de903" kindref="member">std::hypot</ref>(tdx,<sp/>tdy)<sp/>&gt;<sp/><ref refid="d8/dcc/namespacestd_1a8058d6b15a78f7a977945ee4d62de903" kindref="member">std::hypot</ref>(udx,<sp/>udy))<sp/>{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref><sp/>=<sp/>target_pos;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a4e56fc82672dfaf3c62f846afbd6df69" kindref="member">set_path</ref>();</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="616"><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>path<sp/>not<sp/>found</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref>.<ref refid="d0/d8e/classopenage_1_1path_1_1_path_1a6f052fbfe0743c8204c2f37842176976" kindref="member">waypoints</ref>.empty())<sp/>{</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1afe6716ce02ded6ac4d8fd9c2648afe3e" kindref="member">allow_repath</ref>)<sp/>{</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Path<sp/>not<sp/>found<sp/>--<sp/>drop<sp/>action&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a9dae43f975b7c1f0ef8f077cd61df906" kindref="member">end_action</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>distance<sp/>to<sp/>move<sp/>in<sp/>this<sp/>update</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;sp_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ace4ef3ec98443ed10da505114b58f153" kindref="member">attr_type::speed</ref>&gt;();</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>distance_to_move<sp/>=<sp/>sp_attr.unit_speed.to_double()<sp/>*<sp/>time;</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>current<sp/>position<sp/>and<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>new_position<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;d_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36aef72c37be9d1b9e6e5bbd6ef09448abe" kindref="member">attr_type::direction</ref>&gt;();</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d4/d49/structopenage_1_1coord_1_1phys3__delta" kindref="compound">coord::phys3_delta</ref><sp/>new_direction<sp/>=<sp/>d_attr.unit_dir;</highlight></codeline>
<codeline lineno="634"><highlight class="normal"></highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(distance_to_move<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref>.<ref refid="d0/d8e/classopenage_1_1path_1_1_path_1a6f052fbfe0743c8204c2f37842176976" kindref="member">waypoints</ref>.empty())<sp/>{</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>a<sp/>point<sp/>to<sp/>move<sp/>directly<sp/>towards</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>waypoint<sp/>=<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a038b06738db0c91b3f39144206ca3518" kindref="member">next_waypoint</ref>();</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d4/d49/structopenage_1_1coord_1_1phys3__delta" kindref="compound">coord::phys3_delta</ref><sp/>move_dir<sp/>=<sp/>waypoint<sp/>-<sp/>new_position;</highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>normalise<sp/>dir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>distance_to_waypoint<sp/>=<sp/><ref refid="d8/dcc/namespacestd_1a8058d6b15a78f7a977945ee4d62de903" kindref="member">std::hypot</ref>(move_dir.ne,<sp/>move_dir.se);</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(distance_to_waypoint<sp/>&lt;=<sp/>distance_to_move)<sp/>{</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>distance_to_move<sp/>-=<sp/>distance_to_waypoint;</highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>change<sp/>entity<sp/>position<sp/>and<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_position<sp/>=<sp/>waypoint;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_direction<sp/>=<sp/>move_dir;</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>the<sp/>waypoint</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref>.<ref refid="d0/d8e/classopenage_1_1path_1_1_path_1a6f052fbfe0743c8204c2f37842176976" kindref="member">waypoints</ref>.pop_back();</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>change<sp/>entity<sp/>position<sp/>and<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_position<sp/>+=<sp/>move_dir<sp/>*<sp/>(distance_to_move<sp/>/<sp/>distance_to_waypoint);</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_direction<sp/>=<sp/>move_dir;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="664"><highlight class="normal"></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>move<sp/>collisions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>move_completed<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;move(new_position);</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(move_completed)<sp/>{</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>d_attr.unit_dir<sp/>=<sp/>new_direction;</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a87eb54704dff471c3401ec7c7a88b044" kindref="member">set_distance</ref>();</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>cases<sp/>for<sp/>modifying<sp/>path<sp/>when<sp/>blocked</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1afe6716ce02ded6ac4d8fd9c2648afe3e" kindref="member">allow_repath</ref>)<sp/>{</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Path<sp/>blocked<sp/>--<sp/>finding<sp/>new<sp/>path&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a4e56fc82672dfaf3c62f846afbd6df69" kindref="member">set_path</ref>();</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Path<sp/>blocked<sp/>--<sp/>drop<sp/>action&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a9dae43f975b7c1f0ef8f077cd61df906" kindref="member">end_action</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="682"><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>/<sp/>5.0f;</highlight></codeline>
<codeline lineno="685"><highlight class="normal">}</highlight></codeline>
<codeline lineno="686"><highlight class="normal"></highlight></codeline>
<codeline lineno="687" refid="d2/d4e/classopenage_1_1_move_action_1a851c5515feefb331343c7a26b657863f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a851c5515feefb331343c7a26b657863f" kindref="member">MoveAction::on_completion</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="688"><highlight class="normal"></highlight></codeline>
<codeline lineno="689" refid="d2/d4e/classopenage_1_1_move_action_1acaa3211217665c07e59aa7b994e57b6f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1acaa3211217665c07e59aa7b994e57b6f" kindref="member">MoveAction::completed</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>no<sp/>more<sp/>waypoints<sp/>to<sp/>a<sp/>static<sp/>location</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a9dae43f975b7c1f0ef8f077cd61df906" kindref="member">end_action</ref><sp/>||</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(!this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>()<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref>.<ref refid="d0/d8e/classopenage_1_1path_1_1_path_1a6f052fbfe0743c8204c2f37842176976" kindref="member">waypoints</ref>.empty()))<sp/>{</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//close<sp/>enough<sp/>to<sp/>end<sp/>action</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;distance_to_target<sp/>&lt;<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a1a236e7248c0cf631c4d00ed2697343e" kindref="member">radius</ref>)<sp/>{</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="703"><highlight class="normal">}</highlight></codeline>
<codeline lineno="704"><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"></highlight></codeline>
<codeline lineno="706" refid="d2/d4e/classopenage_1_1_move_action_1a038b06738db0c91b3f39144206ca3518" refkind="member"><highlight class="normal"><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a038b06738db0c91b3f39144206ca3518" kindref="member">MoveAction::next_waypoint</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref>.<ref refid="d0/d8e/classopenage_1_1path_1_1_path_1a6f052fbfe0743c8204c2f37842176976" kindref="member">waypoints</ref>.size()<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref>.<ref refid="d0/d8e/classopenage_1_1path_1_1_path_1a6f052fbfe0743c8204c2f37842176976" kindref="member">waypoints</ref>.back().position;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/><ref refid="d0/df4/classopenage_1_1error_1_1_error" kindref="compound">Error</ref>{<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1ab6b4b10be67af93ab6c4d5a36139736e" kindref="member">err</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;No<sp/>next<sp/>waypoint<sp/>available!&quot;</highlight><highlight class="normal">};</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="712"><highlight class="normal">}</highlight></codeline>
<codeline lineno="713"><highlight class="normal"></highlight></codeline>
<codeline lineno="714"><highlight class="normal"></highlight></codeline>
<codeline lineno="715" refid="d2/d4e/classopenage_1_1_move_action_1a4e56fc82672dfaf3c62f846afbd6df69" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a4e56fc82672dfaf3c62f846afbd6df69" kindref="member">MoveAction::set_path</ref>()<sp/>{</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref><sp/>=<sp/><ref refid="d3/df4/namespaceopenage_1_1path_1a047e97b9a81a866f064ad6d6f8dddfd6" kindref="member">path::to_object</ref>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get(),<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>()-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get(),<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a1a236e7248c0cf631c4d00ed2697343e" kindref="member">radius</ref>);</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>start<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>end<sp/>=<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref>;</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a0b53b70c09f569929f40a4b870e4e42d" kindref="member">path</ref><sp/>=<sp/><ref refid="d3/df4/namespaceopenage_1_1path_1a4699fb2dbfd8178b2234b9fbb935179f" kindref="member">path::to_point</ref>(start,<sp/>end,<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;passable);</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="724"><highlight class="normal">}</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726" refid="d2/d4e/classopenage_1_1_move_action_1a87eb54704dff471c3401ec7c7a88b044" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d2/d4e/classopenage_1_1_move_action_1a87eb54704dff471c3401ec7c7a88b044" kindref="member">MoveAction::set_distance</ref>()<sp/>{</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>())<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;target_object<sp/>=<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1aabb973a7a6b6a983d101569c7020c038" kindref="member">unit_target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>()-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>;</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;unit_pos<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a853f2f3e8d88dc7afa63847fd35dbb26" kindref="member">distance_to_target</ref><sp/>=<sp/>target_object-&gt;from_edge(unit_pos);</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d4/d49/structopenage_1_1coord_1_1phys3__delta" kindref="compound">coord::phys3_delta</ref><sp/>move_dir<sp/>=<sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1ac5ccdee0d4b64c28e7c5c051d8d6623c" kindref="member">target</ref><sp/>-<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d4e/classopenage_1_1_move_action_1a853f2f3e8d88dc7afa63847fd35dbb26" kindref="member">distance_to_target</ref><sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal"><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref></highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<ref refid="d8/dcc/namespacestd_1a8058d6b15a78f7a977945ee4d62de903" kindref="member">std::hypot</ref>(move_dir.ne,<sp/>move_dir.se));</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="736"><highlight class="normal">}</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738" refid="d3/d9d/classopenage_1_1_garrison_action_1a0210a9a485b09145bef39e16743bd2a7" refkind="member"><highlight class="normal"><ref refid="d3/d9d/classopenage_1_1_garrison_action_1a0210a9a485b09145bef39e16743bd2a7" kindref="member">GarrisonAction::GarrisonAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/><ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828ab0da275520918e23dd615e2a747528f1" kindref="member">build</ref>)</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action" kindref="compound">TargetAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>,<sp/>build},</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d3/d9d/classopenage_1_1_garrison_action_1aac61b2c342409c44fcb0eb771f1e28e5" kindref="member">complete</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="742"><highlight class="normal">}</highlight></codeline>
<codeline lineno="743"><highlight class="normal"></highlight></codeline>
<codeline lineno="744" refid="d3/d9d/classopenage_1_1_garrison_action_1ae38a294e107776e93a2a4198fed82b9e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d3/d9d/classopenage_1_1_garrison_action_1ae38a294e107776e93a2a4198fed82b9e" kindref="member">GarrisonAction::update_in_range</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">,<sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*target_unit)<sp/>{</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;garrison_attr<sp/>=<sp/>target_unit-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a2dc979d8571788e647e49a10223acae8" kindref="member">attr_type::garrison</ref>&gt;();</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/>garrison_attr.content.push_back(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1adfea298b04684ab09dd8f499dabb8715" kindref="member">get_ref</ref>());</highlight></codeline>
<codeline lineno="747"><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>)<sp/>{</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;remove();</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref><sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d3/d9d/classopenage_1_1_garrison_action_1aac61b2c342409c44fcb0eb771f1e28e5" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="753"><highlight class="normal">}</highlight></codeline>
<codeline lineno="754"><highlight class="normal"></highlight></codeline>
<codeline lineno="755" refid="d6/d81/classopenage_1_1_ungarrison_action_1afd5ed756e4b94d3236add19f68b8450c" refkind="member"><highlight class="normal"><ref refid="d6/d81/classopenage_1_1_ungarrison_action_1afd5ed756e4b94d3236add19f68b8450c" kindref="member">UngarrisonAction::UngarrisonAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;pos)</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3baeeeaea9366c4a3ee8ae10bffc661799e" kindref="member">graphic_type::standing</ref>},</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/d81/classopenage_1_1_ungarrison_action_1affa0497035b0a721f2d7c77dc74fb44c" kindref="member">position</ref>(pos),</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/d81/classopenage_1_1_ungarrison_action_1a454259736b6fd1e6f628bf9763818d12" kindref="member">complete</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="760"><highlight class="normal">}</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762" refid="d6/d81/classopenage_1_1_ungarrison_action_1a92822c1f0fef3ad3e20e310f8fdf011d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/d81/classopenage_1_1_ungarrison_action_1a92822c1f0fef3ad3e20e310f8fdf011d" kindref="member">UngarrisonAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;garrison_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a2dc979d8571788e647e49a10223acae8" kindref="member">attr_type::garrison</ref>&gt;();</highlight></codeline>
<codeline lineno="764"><highlight class="normal"></highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>try<sp/>unload<sp/>all<sp/>objects<sp/>currently<sp/>garrisoned</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>position_it<sp/>=<sp/>std::remove_if(</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::begin(garrison_attr.content),</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::end(garrison_attr.content),</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](<ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>&amp;u)<sp/>{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(u.is_valid())<sp/>{</highlight></codeline>
<codeline lineno="771"><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ptr<sp/>to<sp/>unit<sp/>being<sp/>ungarrisoned</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Unit<sp/>*unit_ptr<sp/>=<sp/>u.get();</highlight></codeline>
<codeline lineno="774"><highlight class="normal"></highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>it<sp/>was<sp/>placed<sp/>outside</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(unit_ptr-&gt;unit_type-&gt;place_beside(unit_ptr,<sp/>this-&gt;entity-&gt;location.get()))<sp/>{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"></highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>task<sp/>unit<sp/>to<sp/>move<sp/>to<sp/>position</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>auto<sp/>&amp;player<sp/>=<sp/>this-&gt;entity-&gt;get_attribute&lt;attr_type::owner&gt;().player;</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Command<sp/>cmd(player,<sp/>this-&gt;position);</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.set_ability(ability_type::move);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unit_ptr-&gt;queue_cmd(cmd);</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>true;</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="788"><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>elements<sp/>which<sp/>were<sp/>ungarrisoned</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/>garrison_attr.content.erase(position_it,<sp/>std::end(garrison_attr.content));</highlight></codeline>
<codeline lineno="791"><highlight class="normal"></highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>completed<sp/>when<sp/>no<sp/>units<sp/>are<sp/>remaining</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/d81/classopenage_1_1_ungarrison_action_1a454259736b6fd1e6f628bf9763818d12" kindref="member">complete</ref><sp/>=<sp/>garrison_attr.content.empty();</highlight></codeline>
<codeline lineno="794"><highlight class="normal">}</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796" refid="d6/d81/classopenage_1_1_ungarrison_action_1ab244eeb4e00c61a4d2b38b0d96c16eec" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/d81/classopenage_1_1_ungarrison_action_1ab244eeb4e00c61a4d2b38b0d96c16eec" kindref="member">UngarrisonAction::on_completion</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="797"><highlight class="normal"></highlight></codeline>
<codeline lineno="798" refid="d5/d62/classopenage_1_1_train_action_1aa6b0b97e999a6bc8cc3b33e6d0977269" refkind="member"><highlight class="normal"><ref refid="d5/d62/classopenage_1_1_train_action_1aa6b0b97e999a6bc8cc3b33e6d0977269" kindref="member">TrainAction::TrainAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="dd/d39/classopenage_1_1_unit_type" kindref="compound">UnitType</ref><sp/>*pp)</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>{e,<sp/>graphic_type::standing},</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d62/classopenage_1_1_train_action_1a3f2ad239810cb687c095f7b6d908fb07" kindref="member">trained</ref>{pp},</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d62/classopenage_1_1_train_action_1a57c08458a9b804eb4bddb0bc81b61685" kindref="member">timer</ref>{10000,<sp/>1},<sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>get<sp/>the<sp/>training<sp/>time<sp/>from<sp/>unit<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d62/classopenage_1_1_train_action_1a133adc6578fddc6904537d5fd3ad90de" kindref="member">started</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d62/classopenage_1_1_train_action_1a15eff0545f33d9494fbfde9bd56d5969" kindref="member">complete</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>deduct<sp/>resources</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="806"><highlight class="normal">}</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight></codeline>
<codeline lineno="808" refid="d5/d62/classopenage_1_1_train_action_1af5515a9c445b00f4dd69348e7177c94c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d5/d62/classopenage_1_1_train_action_1af5515a9c445b00f4dd69348e7177c94c" kindref="member">TrainAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="809"><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a133adc6578fddc6904537d5fd3ad90de" kindref="member">started</ref>)<sp/>{</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>there<sp/>is<sp/>enough<sp/>population<sp/>capacity</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a3f2ad239810cb687c095f7b6d908fb07" kindref="member">trained</ref>-&gt;<ref refid="dd/d39/classopenage_1_1_unit_type_1a4603ca3746b1c118bd2c082f5e8ba3b1" kindref="member">default_attributes</ref>.<ref refid="de/d8a/classopenage_1_1_attributes_1aee38f453ac85b68821958ad74cdd8df5" kindref="member">has</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a248081ecb337c85ec8e4330e6099625a" kindref="member">attr_type::population</ref>))<sp/>{</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a133adc6578fddc6904537d5fd3ad90de" kindref="member">started</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;player<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;population_demand<sp/>=<sp/>this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a3f2ad239810cb687c095f7b6d908fb07" kindref="member">trained</ref>-&gt;<ref refid="dd/d39/classopenage_1_1_unit_type_1a4603ca3746b1c118bd2c082f5e8ba3b1" kindref="member">default_attributes</ref>.<ref refid="de/d8a/classopenage_1_1_attributes_1a08f927be3be6911e7cf77604f9ead10f" kindref="member">get</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a248081ecb337c85ec8e4330e6099625a" kindref="member">attr_type::population</ref>&gt;().demand;</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>can_start<sp/>=<sp/>population_demand<sp/>==<sp/>0<sp/>||<sp/>population_demand<sp/>&lt;=<sp/>player.population.get_space();</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>trigger<sp/>not<sp/>enough<sp/>population<sp/>capacity<sp/>message</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a133adc6578fddc6904537d5fd3ad90de" kindref="member">started</ref><sp/>=<sp/>can_start;</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="823"><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a133adc6578fddc6904537d5fd3ad90de" kindref="member">started</ref>)<sp/>{</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>place<sp/>unit<sp/>when<sp/>ready</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a57c08458a9b804eb4bddb0bc81b61685" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1a8604ecb1237e6f9be407fe6f9e63c6d6" kindref="member">finished</ref>()<sp/>||<sp/>this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a57c08458a9b804eb4bddb0bc81b61685" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1acb51f379d7d73ad7fff1197f9fa2335b" kindref="member">update</ref>(time))<sp/>{</highlight></codeline>
<codeline lineno="827"><highlight class="normal"></highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>using<sp/>the<sp/>producer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/d82/classopenage_1_1_unit_container" kindref="compound">UnitContainer</ref><sp/>*<ref refid="d5/d9d/namespaceopenage_1_1curve_1_1tests_1afc4e799a037edab37e1e35a74da593b7" kindref="member">container</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a2e9937d84fe91d95cbe273f6fe986068" kindref="member">get_container</ref>();</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;player<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>uref<sp/>=<sp/>container-&gt;<ref refid="d2/d82/classopenage_1_1_unit_container_1a39947500d16e9d67eb72458f3df7c796" kindref="member">new_unit</ref>(*this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a3f2ad239810cb687c095f7b6d908fb07" kindref="member">trained</ref>,<sp/>player,<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get());</highlight></codeline>
<codeline lineno="832"><highlight class="normal"></highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>unit<sp/>got<sp/>placed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>try<sp/>again<sp/>next<sp/>update<sp/>if<sp/>cannot<sp/>place</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(uref.is_valid())<sp/>{</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>))<sp/>{</highlight></codeline>
<codeline lineno="837"><highlight class="normal"></highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>use<sp/>a<sp/>move<sp/>command<sp/>to<sp/>the<sp/>gather<sp/>point</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;build_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>&gt;();</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/dda/classopenage_1_1_command" kindref="compound">Command</ref><sp/>cmd(player,<sp/>build_attr.gather_point);</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.set_ability(<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a3734a903022249b3010be1897042568e" kindref="member">ability_type::move</ref>);</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uref.get()-&gt;queue_cmd(cmd);</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a15eff0545f33d9494fbfde9bd56d5969" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="848"><highlight class="normal">}</highlight></codeline>
<codeline lineno="849"><highlight class="normal"></highlight></codeline>
<codeline lineno="850" refid="d5/d62/classopenage_1_1_train_action_1a24d94fb71fcb5e580f2f9d22c986ad9d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d5/d62/classopenage_1_1_train_action_1a24d94fb71fcb5e580f2f9d22c986ad9d" kindref="member">TrainAction::on_completion</ref>()<sp/>{</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="d5/d62/classopenage_1_1_train_action_1a15eff0545f33d9494fbfde9bd56d5969" kindref="member">complete</ref>)<sp/>{</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>give<sp/>back<sp/>the<sp/>resources</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="854"><highlight class="normal">}</highlight></codeline>
<codeline lineno="855"><highlight class="normal"></highlight></codeline>
<codeline lineno="856" refid="d2/d44/classopenage_1_1_research_action_1ab1fcf31636db5ed69464a6046ce9adab" refkind="member"><highlight class="normal"><ref refid="d2/d44/classopenage_1_1_research_action_1ab1fcf31636db5ed69464a6046ce9adab" kindref="member">ResearchAction::ResearchAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="db/d44/classopenage_1_1_research" kindref="compound">Research</ref><sp/>*<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828a7412df2b1db8cd2a5d4aafdb6c2090d3" kindref="member">research</ref>)</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>{e,<sp/>graphic_type::standing},</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d44/classopenage_1_1_research_action_1a8ac60371849828add40d9eacded328d4" kindref="member">research</ref>{<ref refid="d2/d44/classopenage_1_1_research_action_1a8ac60371849828add40d9eacded328d4" kindref="member">research</ref>},</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d44/classopenage_1_1_research_action_1ae0c785057daa83bb27ac725271511976" kindref="member">timer</ref>{<ref refid="d2/d44/classopenage_1_1_research_action_1a8ac60371849828add40d9eacded328d4" kindref="member">research</ref>-&gt;<ref refid="db/d44/classopenage_1_1_research_1a8421d74f06cac747352a260624ac3721" kindref="member">type</ref>-&gt;<ref refid="d2/d89/classopenage_1_1_research_type_1a4a3186a0805b6d799dfc6abac2c9a404" kindref="member">get_research_time</ref>(),<sp/>1},</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d44/classopenage_1_1_research_action_1ac6a2f4242714cbdae38c1701d520b92c" kindref="member">complete</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d44/classopenage_1_1_research_action_1a8ac60371849828add40d9eacded328d4" kindref="member">research</ref>-&gt;<ref refid="db/d44/classopenage_1_1_research_1aae7972075b9f90f16c0bad595f03f0b2" kindref="member">started</ref>();</highlight></codeline>
<codeline lineno="863"><highlight class="normal">}</highlight></codeline>
<codeline lineno="864"><highlight class="normal"></highlight></codeline>
<codeline lineno="865" refid="d2/d44/classopenage_1_1_research_action_1a79f88ea810c2112e5f79a4749c3ef872" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d2/d44/classopenage_1_1_research_action_1a79f88ea810c2112e5f79a4749c3ef872" kindref="member">ResearchAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d2/d44/classopenage_1_1_research_action_1ae0c785057daa83bb27ac725271511976" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1acb51f379d7d73ad7fff1197f9fa2335b" kindref="member">update</ref>(time))<sp/>{</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d44/classopenage_1_1_research_action_1ac6a2f4242714cbdae38c1701d520b92c" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d44/classopenage_1_1_research_action_1a8ac60371849828add40d9eacded328d4" kindref="member">research</ref>-&gt;<ref refid="db/d44/classopenage_1_1_research_1a51f059ce7313e37d3848481309b1dbd4" kindref="member">apply</ref>();</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d44/classopenage_1_1_research_action_1a8ac60371849828add40d9eacded328d4" kindref="member">research</ref>-&gt;<ref refid="db/d44/classopenage_1_1_research_1a856a40cfbef178effe2753a2348280d9" kindref="member">completed</ref>();</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="871"><highlight class="normal">}</highlight></codeline>
<codeline lineno="872"><highlight class="normal"></highlight></codeline>
<codeline lineno="873" refid="d2/d44/classopenage_1_1_research_action_1a41118eb111143113dfb9cbcb1c0fbb30" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d2/d44/classopenage_1_1_research_action_1a41118eb111143113dfb9cbcb1c0fbb30" kindref="member">ResearchAction::on_completion</ref>()<sp/>{</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="d2/d44/classopenage_1_1_research_action_1ac6a2f4242714cbdae38c1701d520b92c" kindref="member">complete</ref>)<sp/>{</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d2/d44/classopenage_1_1_research_action_1a8ac60371849828add40d9eacded328d4" kindref="member">research</ref>-&gt;<ref refid="db/d44/classopenage_1_1_research_1a9027c73c78b0334b11e48a9fd3ffafd2" kindref="member">stopped</ref>();</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="877"><highlight class="normal">}</highlight></codeline>
<codeline lineno="878"><highlight class="normal"></highlight></codeline>
<codeline lineno="879" refid="d6/dc0/classopenage_1_1_build_action_1a94d2b8805ee102382f745bbfce309a49" refkind="member"><highlight class="normal"><ref refid="d6/dc0/classopenage_1_1_build_action_1a94d2b8805ee102382f745bbfce309a49" kindref="member">BuildAction::BuildAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>foundation)</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action" kindref="compound">TargetAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba67e92c8765a9bc7fb2d335c459de9eb5" kindref="member">graphic_type::work</ref>,<sp/>foundation},</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/dc0/classopenage_1_1_build_action_1a396b9ae691f5ce81973678fd9a623142" kindref="member">complete</ref>{.0f},</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/dc0/classopenage_1_1_build_action_1a9014ebc7f4485673380dd82ca206d099" kindref="member">build_rate</ref>{.0001f}<sp/>{</highlight></codeline>
<codeline lineno="884"><highlight class="normal"></highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>the<sp/>units<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a360fa717125a1d694d8218ce0af98a51" kindref="member">attr_type::multitype</ref>))<sp/>{</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a360fa717125a1d694d8218ce0af98a51" kindref="member">attr_type::multitype</ref>&gt;().switchType(gamedata::unit_classes::BUILDING,<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>);</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="889"><highlight class="normal">}</highlight></codeline>
<codeline lineno="890"><highlight class="normal"></highlight></codeline>
<codeline lineno="891" refid="d6/dc0/classopenage_1_1_build_action_1a808f1932658b9bbdb98849c406e1d426" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/dc0/classopenage_1_1_build_action_1a808f1932658b9bbdb98849c406e1d426" kindref="member">BuildAction::update_in_range</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time,<sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*target_unit)<sp/>{</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target_unit-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>))<sp/>{</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;build<sp/>=<sp/>target_unit-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>&gt;();</highlight></codeline>
<codeline lineno="894"><highlight class="normal"></highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>upgrade<sp/>floating<sp/>outlines</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>target_location<sp/>=<sp/>target_unit-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get();</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target_location-&gt;is_floating())<sp/>{</highlight></codeline>
<codeline lineno="898"><highlight class="normal"></highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>try<sp/>to<sp/>place<sp/>the<sp/>object</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target_location-&gt;place(<ref refid="da/d23/namespaceopenage_1a1df3032ec46d1407f95723ad6fc5465ea6ebb25b39f65cab5efa469977b9479e2" kindref="member">object_state::placed</ref>))<sp/>{</highlight></codeline>
<codeline lineno="901"><highlight class="normal"></highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>modify<sp/>ground<sp/>terrain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(build.foundation_terrain<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target_location-&gt;set_ground(build.foundation_terrain,<sp/>0);</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="908"><highlight class="normal"></highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>failed<sp/>to<sp/>start<sp/>construction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/dc0/classopenage_1_1_build_action_1a396b9ae691f5ce81973678fd9a623142" kindref="member">complete</ref><sp/>=<sp/>1.0f;</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="914"><highlight class="normal"></highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>increment<sp/>building<sp/>completion</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>build.completed<sp/>+=<sp/><ref refid="d6/dc0/classopenage_1_1_build_action_1a9014ebc7f4485673380dd82ca206d099" kindref="member">build_rate</ref><sp/>*<sp/>time;</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/dc0/classopenage_1_1_build_action_1a396b9ae691f5ce81973678fd9a623142" kindref="member">complete</ref><sp/>=<sp/>build.completed;</highlight></codeline>
<codeline lineno="918"><highlight class="normal"></highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d6/dc0/classopenage_1_1_build_action_1a396b9ae691f5ce81973678fd9a623142" kindref="member">complete</ref><sp/>&gt;=<sp/>1.0f)<sp/>{</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/dc0/classopenage_1_1_build_action_1a396b9ae691f5ce81973678fd9a623142" kindref="member">complete</ref><sp/>=<sp/>build.completed<sp/>=<sp/>1.0f;</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target_location-&gt;place(build.completion_state);</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/dc0/classopenage_1_1_build_action_1a396b9ae691f5ce81973678fd9a623142" kindref="member">complete</ref><sp/>=<sp/>1.0f;</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="927"><highlight class="normal"></highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>/<sp/>2.5f;</highlight></codeline>
<codeline lineno="930"><highlight class="normal">}</highlight></codeline>
<codeline lineno="931"><highlight class="normal"></highlight></codeline>
<codeline lineno="932" refid="d6/dc0/classopenage_1_1_build_action_1a9f64ee829cfb671065dcfc7c876c346e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d6/dc0/classopenage_1_1_build_action_1a9f64ee829cfb671065dcfc7c876c346e" kindref="member">BuildAction::on_completion</ref>()<sp/>{</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a234df6738799d71928d3fc3acc8d39ab" kindref="member">get_target</ref>().is_valid()<sp/>&amp;&amp;<sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a234df6738799d71928d3fc3acc8d39ab" kindref="member">get_target</ref>().</highlight><highlight class="keyword">get</highlight><highlight class="normal">()-&gt;get_attribute&lt;attr_type::building&gt;().<ref refid="d6/ddd/classopenage_1_1_target_action_1acd97248a087415b6d08fa3e97e90397d" kindref="member">completed</ref><sp/>&lt;<sp/>1.0f)<sp/>{</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>BuildAction<sp/>was<sp/>just<sp/>aborted<sp/>and<sp/>we<sp/>shouldn&apos;t<sp/>look<sp/>for<sp/>new<sp/>buildings</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Done<sp/>building,<sp/>searching<sp/>for<sp/>new<sp/>building&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>valid<sp/>=<sp/>[</highlight><highlight class="keyword">this</highlight><highlight class="normal">](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="db/db3/classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>&amp;obj)<sp/>{</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player.owns(obj.unit)<sp/>||</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!obj.unit.has_attribute(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>)<sp/>||</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj.unit.get_attribute&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>&gt;().<ref refid="d6/ddd/classopenage_1_1_target_action_1acd97248a087415b6d08fa3e97e90397d" kindref="member">completed</ref><sp/>&gt;=<sp/>1.0f)<sp/>{</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Found<sp/>unit<sp/>&quot;</highlight><highlight class="normal"><sp/>&lt;&lt;<sp/>obj.unit.logsource_name());</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="947"><highlight class="normal"></highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db/db3/classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*new_target<sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a8d7d58d26d71e7447de628441782a751" kindref="member">find_in_radius</ref>(*this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>,<sp/>valid,<sp/><ref refid="d6/dc0/classopenage_1_1_build_action_1a795b516ceb44431b9881870c844f799f" kindref="member">BuildAction::search_tile_distance</ref>);</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(new_target<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Found<sp/>new<sp/>building,<sp/>queueing<sp/>command&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/dda/classopenage_1_1_command" kindref="compound">Command</ref><sp/>cmd(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player,<sp/>&amp;new_target-&gt;<ref refid="db/db3/classopenage_1_1_terrain_object_1a0ced8b7c83c658eb9c3545d2c5fd92f7" kindref="member">unit</ref>);</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1ac5dcdf3180dcd4bdce67b765d8ef2134" kindref="member">queue_cmd</ref>(cmd);</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;Didn&apos;t<sp/>find<sp/>new<sp/>building&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="956"><highlight class="normal">}</highlight></codeline>
<codeline lineno="957"><highlight class="normal"></highlight></codeline>
<codeline lineno="958" refid="db/da0/classopenage_1_1_repair_action_1a30a410ac792adbc34048d4af46a770e2" refkind="member"><highlight class="normal"><ref refid="db/da0/classopenage_1_1_repair_action_1a30a410ac792adbc34048d4af46a770e2" kindref="member">RepairAction::RepairAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>tar)</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action" kindref="compound">TargetAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba67e92c8765a9bc7fb2d335c459de9eb5" kindref="member">graphic_type::work</ref>,<sp/>tar},</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db/da0/classopenage_1_1_repair_action_1affb4ff5e2d11b3b16b0b0d4e2ff80594" kindref="member">timer</ref>{80},</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db/da0/classopenage_1_1_repair_action_1a5e0bbef0ed7d5f9ebf03e33e1575c78c" kindref="member">complete</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="963"><highlight class="normal"></highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tar.is_valid())<sp/>{</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>target<sp/>no<sp/>longer<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db/da0/classopenage_1_1_repair_action_1a5e0bbef0ed7d5f9ebf03e33e1575c78c" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="969"><highlight class="normal"></highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref><sp/>=<sp/>tar.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>();</highlight></codeline>
<codeline lineno="971"><highlight class="normal"></highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!target-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>))<sp/>{</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1affb4ff5e2d11b3b16b0b0d4e2ff80594" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1abaf69917928c58c16504879c285ee792" kindref="member">set_interval</ref>(this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1affb4ff5e2d11b3b16b0b0d4e2ff80594" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1a3b8556bdc5e8f4c6e00a1d614f6b949b" kindref="member">get_interval</ref>()<sp/>*<sp/>4);</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="975"><highlight class="normal"></highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>cost<sp/>formula:<sp/>0.5<sp/>*<sp/>(target<sp/>cost)<sp/>/<sp/>(target<sp/>max<sp/>hp)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;hp<sp/>=<sp/>target-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ad5f6f6624aebf09a1c60464a76a96df1" kindref="member">attr_type::hitpoints</ref>&gt;();</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;();</highlight></codeline>
<codeline lineno="979"><highlight class="normal"></highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>target<sp/>unit&apos;s<sp/>cost</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1a73b5f8fc4369c53b5230b67a62586114" kindref="member">cost</ref><sp/>+=<sp/>target-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a2d7da7c7ccd95557e10d54a58a033187" kindref="member">unit_type</ref>-&gt;<ref refid="dd/d39/classopenage_1_1_unit_type_1a19960affc865b0f5d5c9aab5524831ee" kindref="member">cost</ref>.<ref refid="d8/d5b/classopenage_1_1_resource_cost_1a916923be9959f675aadb992258068e32" kindref="member">get</ref>(owner.player);</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;cost<sp/>*=<sp/>0.5<sp/>/<sp/>hp.hp;</highlight></codeline>
<codeline lineno="983"><highlight class="normal"></highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!owner.player.deduct(this-&gt;cost))<sp/>{</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>no<sp/>resources<sp/>to<sp/>start</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1a5e0bbef0ed7d5f9ebf03e33e1575c78c" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="989"><highlight class="normal">}</highlight></codeline>
<codeline lineno="990"><highlight class="normal"></highlight></codeline>
<codeline lineno="991" refid="db/da0/classopenage_1_1_repair_action_1ae093970227ea03a75f1ee278770640f0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="db/da0/classopenage_1_1_repair_action_1ae093970227ea03a75f1ee278770640f0" kindref="member">RepairAction::update_in_range</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time,<sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*target_unit)<sp/>{</highlight></codeline>
<codeline lineno="992"><highlight class="normal"></highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;hp<sp/>=<sp/>target_unit-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ad5f6f6624aebf09a1c60464a76a96df1" kindref="member">attr_type::hitpoints</ref>&gt;();</highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dm<sp/>=<sp/>target_unit-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>&gt;();</highlight></codeline>
<codeline lineno="995"><highlight class="normal"></highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dm.hp<sp/>&gt;=<sp/>hp.hp)<sp/>{</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>repaired<sp/>by<sp/>something<sp/>else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1a5e0bbef0ed7d5f9ebf03e33e1575c78c" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1affb4ff5e2d11b3b16b0b0d4e2ff80594" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1acb51f379d7d73ad7fff1197f9fa2335b" kindref="member">update</ref>(time))<sp/>{</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dm.hp<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"></highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dm.hp<sp/>&gt;=<sp/>hp.hp)<sp/>{</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1a5e0bbef0ed7d5f9ebf03e33e1575c78c" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"></highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1a5e0bbef0ed7d5f9ebf03e33e1575c78c" kindref="member">complete</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;();</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">owner</ref>.player.deduct(this-&gt;cost))<sp/>{</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>no<sp/>resources<sp/>to<sp/>continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/da0/classopenage_1_1_repair_action_1a5e0bbef0ed7d5f9ebf03e33e1575c78c" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>/<sp/>2.5f;</highlight></codeline>
<codeline lineno="1018"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"></highlight></codeline>
<codeline lineno="1020" refid="db/d43/classopenage_1_1_gather_action_1ae433349aed9b3228f3b5030c270d23f2" refkind="member"><highlight class="normal"><ref refid="db/d43/classopenage_1_1_gather_action_1ae433349aed9b3228f3b5030c270d23f2" kindref="member">GatherAction::GatherAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>tar)</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action" kindref="compound">TargetAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba67e92c8765a9bc7fb2d335c459de9eb5" kindref="member">graphic_type::work</ref>,<sp/>tar},</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db/d43/classopenage_1_1_gather_action_1ac68160161d98b20ed137df83c1be2763" kindref="member">complete</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db/d43/classopenage_1_1_gather_action_1a84f2390c263f5263442d816ffc1f7325" kindref="member">target_resource</ref>{</highlight><highlight class="keyword">true</highlight><highlight class="normal">},</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db/d43/classopenage_1_1_gather_action_1adf5b4ae906a77b4afc1338a6dcc6cbe2" kindref="member">target</ref>{tar}<sp/>{</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"></highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*<ref refid="db/d43/classopenage_1_1_gather_action_1adf5b4ae906a77b4afc1338a6dcc6cbe2" kindref="member">target</ref><sp/>=<sp/>this-&gt;target.get();</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1a61ec0ea56e1fe10f0afb685ce8e5135e" kindref="member">resource_class</ref><sp/>=<sp/>target-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a2d7da7c7ccd95557e10d54a58a033187" kindref="member">unit_type</ref>-&gt;<ref refid="dd/d39/classopenage_1_1_unit_type_1a8f429cad1b7e5c9daedf836bdc8cd1a7" kindref="member">unit_class</ref>;</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"></highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>handle<sp/>unit<sp/>type<sp/>changes<sp/>based<sp/>on<sp/>resource<sp/>class</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a360fa717125a1d694d8218ce0af98a51" kindref="member">attr_type::multitype</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a360fa717125a1d694d8218ce0af98a51" kindref="member">attr_type::multitype</ref>&gt;().switchType(this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1a61ec0ea56e1fe10f0afb685ce8e5135e" kindref="member">resource_class</ref>,<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>);</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>type<sp/>of<sp/>gatherer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;worker_resource<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;resource_attr<sp/>=<sp/>target-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(worker_resource.resource_type<sp/>!=<sp/>resource_attr.resource_type)<sp/>{</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_resource.amount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_resource.resource_type<sp/>=<sp/>resource_attr.resource_type;</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>std::invalid_argument(</highlight><highlight class="stringliteral">&quot;Unit<sp/>reference<sp/>has<sp/>no<sp/>resource<sp/>attribute&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1046"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"></highlight></codeline>
<codeline lineno="1048" refid="db/d43/classopenage_1_1_gather_action_1ace33d947d69c60190f8259bebc8ca52b" refkind="member"><highlight class="normal"><ref refid="db/d43/classopenage_1_1_gather_action_1ace33d947d69c60190f8259bebc8ca52b" kindref="member">GatherAction::~GatherAction</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"></highlight></codeline>
<codeline lineno="1050" refid="db/d43/classopenage_1_1_gather_action_1ae49e08d7e107415297f6c58320570858" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="db/d43/classopenage_1_1_gather_action_1ae49e08d7e107415297f6c58320570858" kindref="member">GatherAction::update_in_range</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time,<sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*targeted_resource)<sp/>{</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">worker</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">attr_type::worker</ref>&gt;();</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;worker_resource<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1a84f2390c263f5263442d816ffc1f7325" kindref="member">target_resource</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"></highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>targets<sp/>attributes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!targeted_resource-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="db/d43/classopenage_1_1_gather_action_1ac68160161d98b20ed137df83c1be2763" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"></highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>attack<sp/>objects<sp/>which<sp/>have<sp/>hitpoints<sp/>(trees,<sp/>hunt,<sp/>sheep)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>targeted_resource-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;pl<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;();</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dm<sp/>=<sp/>targeted_resource-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>&gt;();</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"></highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>only<sp/>attack<sp/>if<sp/>hitpoints<sp/>remain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dm.hp<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/dda/classopenage_1_1_command" kindref="compound">Command</ref><sp/>cmd(pl.player,<sp/>targeted_resource);</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.<ref refid="d8/dda/classopenage_1_1_command_1a5783c26abcea9f286be58aa29de1e548" kindref="member">set_ability</ref>(<ref refid="da/d23/namespaceopenage_1a7278b1c0b8d94d06da155b0b693b2828afc7e987f23de5bd6562b7c0063cad659" kindref="member">ability_type::attack</ref>);</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd.<ref refid="d8/dda/classopenage_1_1_command_1a689de4092f9ae801d7f987dda153f0d8" kindref="member">add_flag</ref>(<ref refid="da/d23/namespaceopenage_1a355391982e6c1257c3fc4de3b6402b3aa2a71c2ff2e6e5f1d2d3342d476a6d4dc" kindref="member">command_flag::attack_res</ref>);</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1ac5dcdf3180dcd4bdce67b765d8ef2134" kindref="member">queue_cmd</ref>(cmd);</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"></highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>need<sp/>to<sp/>return<sp/>to<sp/>dropsite</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(worker_resource.amount<sp/>&gt;<sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">worker</ref>.capacity)<sp/>{</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"></highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>move<sp/>to<sp/>dropsite<sp/>location</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1a84f2390c263f5263442d816ffc1f7325" kindref="member">target_resource</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a48de4ef9580b1202464808af55b78fae" kindref="member">set_target</ref>(this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1a578fcecec436b05efb5059bbb35837fe" kindref="member">nearest_dropsite</ref>(worker_resource.resource_type));</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"></highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;resource_attr<sp/>=<sp/>targeted_resource-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;();</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(resource_attr.amount<sp/>&lt;=<sp/>0.0)<sp/>{</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"></highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>when<sp/>the<sp/>resource<sp/>runs<sp/>out</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(worker_resource.amount<sp/>&gt;<sp/>0.0)<sp/>{</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1a84f2390c263f5263442d816ffc1f7325" kindref="member">target_resource</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a48de4ef9580b1202464808af55b78fae" kindref="member">set_target</ref>(this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1a578fcecec436b05efb5059bbb35837fe" kindref="member">nearest_dropsite</ref>(worker_resource.resource_type));</highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1ac68160161d98b20ed137df83c1be2763" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"></highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>transfer<sp/>using<sp/>gather<sp/>rate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>amount<sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">worker</ref>.gather_rate[worker_resource.resource_type]</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>resource_attr.gather_rate<sp/>*<sp/>time;</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_resource.amount<sp/>+=<sp/>amount;</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resource_attr.amount<sp/>-=<sp/>amount;</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"></highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>dropsite<sp/>has<sp/>been<sp/>reached</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>value<sp/>to<sp/>player<sp/>stockpile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;player<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.receive(worker_resource.resource_type,<sp/>worker_resource.amount);</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>worker_resource.amount<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"></highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>resource<sp/>still<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1adf5b4ae906a77b4afc1338a6dcc6cbe2" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a55afff48cc1901715f3c29383969d2ac" kindref="member">is_valid</ref>()<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1adf5b4ae906a77b4afc1338a6dcc6cbe2" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>()-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>&gt;().amount<sp/>&gt;<sp/>0.0)<sp/>{</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"></highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>to<sp/>resource<sp/>collection</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1a84f2390c263f5263442d816ffc1f7325" kindref="member">target_resource</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d6/ddd/classopenage_1_1_target_action_1a48de4ef9580b1202464808af55b78fae" kindref="member">set_target</ref>(this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1adf5b4ae906a77b4afc1338a6dcc6cbe2" kindref="member">target</ref>);</highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"></highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>resource<sp/>depleted</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1ac68160161d98b20ed137df83c1be2763" kindref="member">complete</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"></highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref><sp/>/<sp/>3.0f;</highlight></codeline>
<codeline lineno="1133"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"></highlight></codeline>
<codeline lineno="1135" refid="db/d43/classopenage_1_1_gather_action_1ab76d756df9989badfa91e272f85dee9c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="db/d43/classopenage_1_1_gather_action_1ab76d756df9989badfa91e272f85dee9c" kindref="member">GatherAction::on_completion_in_range</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>target_type)<sp/>{</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"></highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>a<sp/>different<sp/>target<sp/>with<sp/>same<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="db/db3/classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>*new_target<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/>new_target<sp/>=<sp/><ref refid="da/d23/namespaceopenage_1abf30260a65f6b06163a5dad881836523" kindref="member">find_near</ref>(*this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>,</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[target_type](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="db/db3/classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>&amp;obj)<sp/>{</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>obj.unit.unit_type-&gt;id()<sp/>==<sp/>target_type<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!obj.unit.has_attribute(attr_type::worker)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj.unit.has_attribute(attr_type::resource)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj.unit.get_attribute&lt;attr_type::resource&gt;().amount<sp/>&gt;<sp/>0.0;</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"></highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(new_target)<sp/>{</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;auto<sp/>retasking&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;pl_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;();</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/dda/classopenage_1_1_command" kindref="compound">Command</ref><sp/>cmd(pl_attr.player,<sp/>&amp;new_target-&gt;<ref refid="db/db3/classopenage_1_1_terrain_object_1a0ced8b7c83c658eb9c3545d2c5fd92f7" kindref="member">unit</ref>);</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1ac5dcdf3180dcd4bdce67b765d8ef2134" kindref="member">queue_cmd</ref>(cmd);</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1153"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"></highlight></codeline>
<codeline lineno="1155" refid="db/d43/classopenage_1_1_gather_action_1a578fcecec436b05efb5059bbb35837fe" refkind="member"><highlight class="normal"><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/><ref refid="db/d43/classopenage_1_1_gather_action_1a578fcecec436b05efb5059bbb35837fe" kindref="member">GatherAction::nearest_dropsite</ref>(<ref refid="da/d23/namespaceopenage_1ac7b51147f1e8648805708ec7c3fd328d" kindref="member">game_resource</ref><sp/>res_type)<sp/>{</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"></highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>nearest<sp/>dropsite<sp/>from<sp/>the<sp/>targeted<sp/>resource</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>ds<sp/>=<sp/><ref refid="da/d23/namespaceopenage_1abf30260a65f6b06163a5dad881836523" kindref="member">find_near</ref>(*this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1adf5b4ae906a77b4afc1338a6dcc6cbe2" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>()-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>,</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[=](</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="db/db3/classopenage_1_1_terrain_object" kindref="compound">TerrainObject</ref><sp/>&amp;obj)<sp/>{</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"></highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>obj.unit.has_attribute(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>)<sp/>or<sp/>&amp;obj.unit<sp/>==<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref><sp/>or<sp/>&amp;obj.unit<sp/>==<sp/>this-&gt;<ref refid="db/d43/classopenage_1_1_gather_action_1adf5b4ae906a77b4afc1338a6dcc6cbe2" kindref="member">target</ref>.<ref refid="d3/d37/classopenage_1_1_unit_reference_1a6303ff3facc18acf10aa335ee9d318d8" kindref="member">get</ref>())<sp/>{</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"></highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>obj.unit.get_attribute&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a1b20e9021b3a16b059287caddc7862f6" kindref="member">attr_type::building</ref>&gt;().<ref refid="d6/ddd/classopenage_1_1_target_action_1acd97248a087415b6d08fa3e97e90397d" kindref="member">completed</ref><sp/>&gt;=<sp/>1.0f<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj.unit.has_attribute(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj.unit.get_attribute&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player.owns(*this-&gt;entity)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj.unit.has_attribute(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a82ac54bc705e60f101a783334be1e7e1" kindref="member">attr_type::dropsite</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj.unit.get_attribute&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a82ac54bc705e60f101a783334be1e7e1" kindref="member">attr_type::dropsite</ref>&gt;().accepting_resource(res_type);</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"></highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ds)<sp/>{</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ds-&gt;<ref refid="db/db3/classopenage_1_1_terrain_object_1a0ced8b7c83c658eb9c3545d2c5fd92f7" kindref="member">unit</ref>.<ref refid="df/dea/classopenage_1_1_unit_1adfea298b04684ab09dd8f499dabb8715" kindref="member">get_ref</ref>();</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;no<sp/>dropsite<sp/>found&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref>();</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1179"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"></highlight></codeline>
<codeline lineno="1181" refid="d7/d12/classopenage_1_1_attack_action_1ab41b0edfc4a7e4927144b9caa87d7f46" refkind="member"><highlight class="normal"><ref refid="d7/d12/classopenage_1_1_attack_action_1ab41b0edfc4a7e4927144b9caa87d7f46" kindref="member">AttackAction::AttackAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>tar)</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action" kindref="compound">TargetAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bafc7e987f23de5bd6562b7c0063cad659" kindref="member">graphic_type::attack</ref>,<sp/>tar,<sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a6e508baa62ec19cd81bea7fce1721e17" kindref="member">get_attack_range</ref>(e)},</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d7/d12/classopenage_1_1_attack_action_1a4500f6947a8a421e29f9619e2505eb70" kindref="member">timer</ref>{500}<sp/>{<sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>get<sp/>fire<sp/>rate<sp/>from<sp/>unit<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1185"><highlight class="normal"></highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>attacking<sp/>a<sp/>non<sp/>resource<sp/>unit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">attr_type::worker</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(!tar.get()-&gt;has_attribute(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a96ab4e163f4ee03aaa4d1051aa51d204" kindref="member">attr_type::resource</ref>)<sp/>||<sp/>tar.get()-&gt;has_attribute(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ab61822e8357dcaff77eaaccf348d9134" kindref="member">attr_type::worker</ref>)))<sp/>{</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>switch<sp/>to<sp/>default<sp/>villager<sp/>graphics</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a360fa717125a1d694d8218ce0af98a51" kindref="member">attr_type::multitype</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a360fa717125a1d694d8218ce0af98a51" kindref="member">attr_type::multitype</ref>&gt;().switchType(gamedata::unit_classes::CIVILIAN,<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>);</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"></highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>rivit<sp/>logic,<sp/>a<sp/>start<sp/>inside<sp/>the<sp/>animation<sp/>should<sp/>be<sp/>provided</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d7/d12/classopenage_1_1_attack_action_1a4500f6947a8a421e29f9619e2505eb70" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1a0b8e2a356a40d6fcb2f3b2e0410a675b" kindref="member">skip_to_trigger</ref>();</highlight></codeline>
<codeline lineno="1197"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"></highlight></codeline>
<codeline lineno="1199" refid="d7/d12/classopenage_1_1_attack_action_1a11cb056ff1d7718169da37de5eafec16" refkind="member"><highlight class="normal"><ref refid="d7/d12/classopenage_1_1_attack_action_1a11cb056ff1d7718169da37de5eafec16" kindref="member">AttackAction::~AttackAction</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"></highlight></codeline>
<codeline lineno="1201" refid="d7/d12/classopenage_1_1_attack_action_1af3e4ae03273bd3d6ea4b5a196ce6351c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d7/d12/classopenage_1_1_attack_action_1af3e4ae03273bd3d6ea4b5a196ce6351c" kindref="member">AttackAction::update_in_range</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time,<sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*target_ptr)<sp/>{</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d7/d12/classopenage_1_1_attack_action_1a4500f6947a8a421e29f9619e2505eb70" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1acb51f379d7d73ad7fff1197f9fa2335b" kindref="member">update</ref>(time))<sp/>{</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d7/d12/classopenage_1_1_attack_action_1ae6ce05cd88d0f3000950c6d39421c24c" kindref="member">attack</ref>(*target_ptr);</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"></highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a6cd7405af72dd0cf3994cee74608cf8b" kindref="member">current_graphics</ref>().at(<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref>)-&gt;frame_count<sp/>*<sp/>1.0f<sp/>/<sp/>this-&gt;<ref refid="d7/d12/classopenage_1_1_attack_action_1a4500f6947a8a421e29f9619e2505eb70" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1a3b8556bdc5e8f4c6e00a1d614f6b949b" kindref="member">get_interval</ref>();</highlight></codeline>
<codeline lineno="1208"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"></highlight></codeline>
<codeline lineno="1210" refid="d7/d12/classopenage_1_1_attack_action_1a9a21f5da5f56d1c157b0a1806a8e49e3" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d7/d12/classopenage_1_1_attack_action_1a9a21f5da5f56d1c157b0a1806a8e49e3" kindref="member">AttackAction::completed_in_range</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*target_ptr)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dm<sp/>=<sp/>target_ptr-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>&gt;();</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>dm.hp<sp/>&lt;<sp/>1;<sp/></highlight><highlight class="comment">//<sp/>is<sp/>unit<sp/>still<sp/>alive?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1213"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"></highlight></codeline>
<codeline lineno="1215" refid="d7/d12/classopenage_1_1_attack_action_1ae6ce05cd88d0f3000950c6d39421c24c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d7/d12/classopenage_1_1_attack_action_1ae6ce05cd88d0f3000950c6d39421c24c" kindref="member">AttackAction::attack</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>&amp;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="d7/d12/classopenage_1_1_attack_action_1ae6ce05cd88d0f3000950c6d39421c24c" kindref="member">attack</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36afc7e987f23de5bd6562b7c0063cad659" kindref="member">attr_type::attack</ref>&gt;();</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d7/d12/classopenage_1_1_attack_action_1ae6ce05cd88d0f3000950c6d39421c24c" kindref="member">attack</ref>.ptype)<sp/>{</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"></highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>projectile<sp/>to<sp/>the<sp/>game</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d7/d12/classopenage_1_1_attack_action_1a1a76ce122961d9e09c526b8d0f2f513f" kindref="member">fire_projectile</ref>(<ref refid="d7/d12/classopenage_1_1_attack_action_1ae6ce05cd88d0f3000950c6d39421c24c" kindref="member">attack</ref>,<sp/>target.<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw);</highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a7beffb7ad454cf467d7a6b843df939c7" kindref="member">damage_unit</ref>(target);</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1225"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"></highlight></codeline>
<codeline lineno="1227" refid="d7/d12/classopenage_1_1_attack_action_1a1a76ce122961d9e09c526b8d0f2f513f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d7/d12/classopenage_1_1_attack_action_1a1a76ce122961d9e09c526b8d0f2f513f" kindref="member">AttackAction::fire_projectile</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="de/dd0/classopenage_1_1_attribute_3_01attr__type_1_1attack_01_4" kindref="compound">Attribute&lt;attr_type::attack&gt;</ref><sp/>&amp;att,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>&amp;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"></highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>container<sp/>terrain<sp/>and<sp/>initial<sp/>position</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/d82/classopenage_1_1_unit_container" kindref="compound">UnitContainer</ref><sp/>*<ref refid="d5/d9d/namespaceopenage_1_1curve_1_1tests_1afc4e799a037edab37e1e35a74da593b7" kindref="member">container</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a2e9937d84fe91d95cbe273f6fe986068" kindref="member">get_container</ref>();</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>current_pos<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/><sp/><sp/>current_pos.up<sp/>=<sp/>att.<ref refid="de/dd0/classopenage_1_1_attribute_3_01attr__type_1_1attack_01_4_1aed199958f9d00408dada7bec38a19529" kindref="member">init_height</ref>;</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"></highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>using<sp/>the<sp/>producer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;player<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a72122ce96bfec66e2396d2e25225d70a" kindref="member">attr_type::owner</ref>&gt;().player;</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>projectile_ref<sp/>=<sp/>container-&gt;<ref refid="d2/d82/classopenage_1_1_unit_container_1a39947500d16e9d67eb72458f3df7c796" kindref="member">new_unit</ref>(*att.<ref refid="de/dd0/classopenage_1_1_attribute_3_01attr__type_1_1attack_01_4_1a49adea4cd2747cba4c32138bab6e7f11" kindref="member">ptype</ref>,<sp/>player,<sp/>current_pos);</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"></highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>send<sp/>towards<sp/>target<sp/>using<sp/>a<sp/>projectile<sp/>ability<sp/>(creates<sp/>projectile<sp/>motion<sp/>action)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(projectile_ref.is_valid())<sp/>{</highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">projectile</ref><sp/>=<sp/>projectile_ref.get();</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;projectile_attr<sp/>=<sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">projectile</ref>-&gt;get_attribute&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">attr_type::projectile</ref>&gt;();</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>projectile_attr.launcher<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1adfea298b04684ab09dd8f499dabb8715" kindref="member">get_ref</ref>();</highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>projectile_attr.launched<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">projectile</ref>-&gt;push_action(std::make_unique&lt;ProjectileAction&gt;(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">projectile</ref>,<sp/>target),<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="de/de3/classopenage_1_1log_1_1_log_source_1a5640099e20af4cd368c767dbcef3a1df" kindref="member">log</ref>(<ref refid="d2/d0d/message_8h_1a8adfad4f54eb306fbb8aaa1b159608a5" kindref="member">MSG</ref>(<ref refid="dd/d1a/namespaceopenage_1_1log_1a5cb08687f485da2549d7eebef26368a6" kindref="member">dbg</ref>)<sp/>&lt;&lt;<sp/></highlight><highlight class="stringliteral">&quot;projectile<sp/>launch<sp/>failed&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1249"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"></highlight></codeline>
<codeline lineno="1251"><highlight class="normal"></highlight></codeline>
<codeline lineno="1252" refid="d9/deb/classopenage_1_1_heal_action_1ae6c7160317b9b913429a0afd51a368c2" refkind="member"><highlight class="normal"><ref refid="d9/deb/classopenage_1_1_heal_action_1ae6c7160317b9b913429a0afd51a368c2" kindref="member">HealAction::HealAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>tar)</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action" kindref="compound">TargetAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3ba214d940b5313897d9e25b3a2b3533770" kindref="member">graphic_type::heal</ref>,<sp/>tar,<sp/><ref refid="dc/d74/classopenage_1_1_unit_action_1a6e508baa62ec19cd81bea7fce1721e17" kindref="member">get_attack_range</ref>(e)},</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/deb/classopenage_1_1_heal_action_1a0558daf5bc38357d4011208c711ab330" kindref="member">timer</ref>{this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a214d940b5313897d9e25b3a2b3533770" kindref="member">attr_type::heal</ref>&gt;().rate}<sp/>{</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"></highlight></codeline>
<codeline lineno="1257"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1258"><highlight class="normal"></highlight></codeline>
<codeline lineno="1259" refid="d9/deb/classopenage_1_1_heal_action_1af776da48432f5c7b1c53c9808a1075d7" refkind="member"><highlight class="normal"><ref refid="d9/deb/classopenage_1_1_heal_action_1af776da48432f5c7b1c53c9808a1075d7" kindref="member">HealAction::~HealAction</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="1260"><highlight class="normal"></highlight></codeline>
<codeline lineno="1261" refid="d9/deb/classopenage_1_1_heal_action_1a95b9324fe05d86e7528f3a5334b6fc7c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d9/deb/classopenage_1_1_heal_action_1a95b9324fe05d86e7528f3a5334b6fc7c" kindref="member">HealAction::update_in_range</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time,<sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*target_ptr)<sp/>{</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="d9/deb/classopenage_1_1_heal_action_1a0558daf5bc38357d4011208c711ab330" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1acb51f379d7d73ad7fff1197f9fa2335b" kindref="member">update</ref>(time))<sp/>{</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d9/deb/classopenage_1_1_heal_action_1abae1711c61d9c124d6ab2d1acdc4efeb" kindref="member">heal</ref>(*target_ptr);</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"></highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a6cd7405af72dd0cf3994cee74608cf8b" kindref="member">current_graphics</ref>().at(<ref refid="dc/d74/classopenage_1_1_unit_action_1afe08a940aa0b7040c3a59d816de00fed" kindref="member">graphic</ref>)-&gt;frame_count<sp/>*<sp/>1.0f<sp/>/<sp/>this-&gt;<ref refid="d9/deb/classopenage_1_1_heal_action_1a0558daf5bc38357d4011208c711ab330" kindref="member">timer</ref>.<ref refid="de/d24/classopenage_1_1_interval_timer_1a3b8556bdc5e8f4c6e00a1d614f6b949b" kindref="member">get_interval</ref>();</highlight></codeline>
<codeline lineno="1268"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"></highlight></codeline>
<codeline lineno="1270" refid="d9/deb/classopenage_1_1_heal_action_1ad6d47ca5bb338861aa787901f64aafe2" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d9/deb/classopenage_1_1_heal_action_1ad6d47ca5bb338861aa787901f64aafe2" kindref="member">HealAction::completed_in_range</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*target_ptr)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;hp<sp/>=<sp/>target_ptr-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ad5f6f6624aebf09a1c60464a76a96df1" kindref="member">attr_type::hitpoints</ref>&gt;();</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dm<sp/>=<sp/>target_ptr-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>&gt;();</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>dm.hp<sp/>&gt;=<sp/>hp.hp;<sp/></highlight><highlight class="comment">//<sp/>is<sp/>unit<sp/>at<sp/>full<sp/>hitpoints?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1274"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"></highlight></codeline>
<codeline lineno="1276" refid="d9/deb/classopenage_1_1_heal_action_1abae1711c61d9c124d6ab2d1acdc4efeb" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d9/deb/classopenage_1_1_heal_action_1abae1711c61d9c124d6ab2d1acdc4efeb" kindref="member">HealAction::heal</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>&amp;<ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;<ref refid="d9/deb/classopenage_1_1_heal_action_1abae1711c61d9c124d6ab2d1acdc4efeb" kindref="member">heal</ref><sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a214d940b5313897d9e25b3a2b3533770" kindref="member">attr_type::heal</ref>&gt;();</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"></highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>move<sp/>to<sp/>separate<sp/>function<sp/>heal_unit<sp/>(like<sp/>damage_unit)?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>heal<sp/>object</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target.<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ad5f6f6624aebf09a1c60464a76a96df1" kindref="member">attr_type::hitpoints</ref>)<sp/>&amp;&amp;<sp/>target.<ref refid="df/dea/classopenage_1_1_unit_1a6c56a8b7e9856a8e0535cacbe831bae7" kindref="member">has_attribute</ref>(<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;hp<sp/>=<sp/>target.<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ad5f6f6624aebf09a1c60464a76a96df1" kindref="member">attr_type::hitpoints</ref>&gt;();</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;dm<sp/>=<sp/>target.<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36a46cc0df55d22d6eb6c37cabbc09f5193" kindref="member">attr_type::damaged</ref>&gt;();</highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((dm.hp<sp/>+<sp/><ref refid="d9/deb/classopenage_1_1_heal_action_1abae1711c61d9c124d6ab2d1acdc4efeb" kindref="member">heal</ref>.life)<sp/>&lt;<sp/>hp.hp)<sp/>{</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dm.hp<sp/>+=<sp/><ref refid="d9/deb/classopenage_1_1_heal_action_1abae1711c61d9c124d6ab2d1acdc4efeb" kindref="member">heal</ref>.life;</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dm.hp<sp/>=<sp/>hp.hp;</highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1291"><highlight class="normal"></highlight></codeline>
<codeline lineno="1292"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"></highlight></codeline>
<codeline lineno="1294"><highlight class="normal"></highlight></codeline>
<codeline lineno="1295" refid="d9/d5d/classopenage_1_1_convert_action_1a6921e6559ca42040ec060a895869fa30" refkind="member"><highlight class="normal"><ref refid="d9/d5d/classopenage_1_1_convert_action_1a6921e6559ca42040ec060a895869fa30" kindref="member">ConvertAction::ConvertAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d3/d37/classopenage_1_1_unit_reference" kindref="compound">UnitReference</ref><sp/>tar)</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="1297"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddd/classopenage_1_1_target_action" kindref="compound">TargetAction</ref>{e,<sp/><ref refid="da/d23/namespaceopenage_1a5e6378e44a27518a589cc11f2ee36a3bafc7e987f23de5bd6562b7c0063cad659" kindref="member">graphic_type::attack</ref>,<sp/>tar},</highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/d5d/classopenage_1_1_convert_action_1a358c2f0f7b823acf73cf2ddc5271efd4" kindref="member">complete</ref>{.0f}<sp/>{</highlight></codeline>
<codeline lineno="1299"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1300"><highlight class="normal"></highlight></codeline>
<codeline lineno="1301" refid="d9/d5d/classopenage_1_1_convert_action_1a55db575cd964d3900afde6969e93dcfe" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d9/d5d/classopenage_1_1_convert_action_1a55db575cd964d3900afde6969e93dcfe" kindref="member">ConvertAction::update_in_range</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">,<sp/><ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*)<sp/>{}</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"></highlight></codeline>
<codeline lineno="1303" refid="d5/d14/classopenage_1_1_projectile_action_1ad5f60eb378fa84cbccd6fa61f221c7e5" refkind="member"><highlight class="normal"><ref refid="d5/d14/classopenage_1_1_projectile_action_1ad5f60eb378fa84cbccd6fa61f221c7e5" kindref="member">ProjectileAction::ProjectileAction</ref>(<ref refid="df/dea/classopenage_1_1_unit" kindref="compound">Unit</ref><sp/>*e,<sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/><ref refid="d6/ddd/classopenage_1_1_target_action_1af0c0298b57d0752f89b4e732f7446f78" kindref="member">target</ref>)</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"><sp/><sp/><sp/><sp/>:</highlight></codeline>
<codeline lineno="1305"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d74/classopenage_1_1_unit_action" kindref="compound">UnitAction</ref>{e,<sp/>graphic_type::standing},</highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d14/classopenage_1_1_projectile_action_1a6343bf60c356f44ff0a403a715f44d96" kindref="member">has_hit</ref>{</highlight><highlight class="keyword">false</highlight><highlight class="normal">}<sp/>{</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"></highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>speed<sp/>to<sp/>move</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;sp_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36ace4ef3ec98443ed10da505114b58f153" kindref="member">attr_type::speed</ref>&gt;();</highlight></codeline>
<codeline lineno="1310"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>projectile_speed<sp/>=<sp/>sp_attr.unit_speed.to_double();</highlight></codeline>
<codeline lineno="1311"><highlight class="normal"></highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>arc<sp/>of<sp/>projectile</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;pr_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36abdb3aea80363d8d4bded1ce9f3cdadf2" kindref="member">attr_type::projectile</ref>&gt;();</highlight></codeline>
<codeline lineno="1314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>projectile_arc<sp/>=<sp/>pr_attr.projectile_arc;</highlight></codeline>
<codeline lineno="1315"><highlight class="normal"></highlight></codeline>
<codeline lineno="1316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>distance<sp/>and<sp/>time<sp/>to<sp/>target</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1317"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d4/d49/structopenage_1_1coord_1_1phys3__delta" kindref="compound">coord::phys3_delta</ref><sp/>d<sp/>=<sp/>target<sp/>-<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw;</highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>distance_to_target<sp/>=<sp/>d.<ref refid="d4/d49/structopenage_1_1coord_1_1phys3__delta_1af63b7f5b841ffab9004b2ffd3550ab9e" kindref="member">length</ref>();</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>flight_time<sp/>=<sp/>distance_to_target<sp/>/<sp/>projectile_speed;</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"></highlight></codeline>
<codeline lineno="1321"><highlight class="normal"></highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(projectile_arc<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>negative<sp/>values<sp/>probably<sp/>indicate<sp/>something</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>projectile_arc<sp/>+=<sp/>0.2;</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1326"><highlight class="normal"></highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>figure<sp/>gravity<sp/>from<sp/>arc<sp/>parameter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>projectile<sp/>arc<sp/>is<sp/>the<sp/>ratio<sp/>between<sp/>horizontal<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>vertical<sp/>components<sp/>of<sp/>the<sp/>initial<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="d5/d14/classopenage_1_1_projectile_action_1ab5952a52fdb1e1a13a098f301e0d2552" kindref="member">grav</ref><sp/>=<sp/>0.01f<sp/>*<sp/>(exp(pow(projectile_arc,<sp/>0.5f))<sp/>-<sp/>1)<sp/>*<sp/>projectile_speed;</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"></highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inital<sp/>launch<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;d_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36aef72c37be9d1b9e6e5bbd6ef09448abe" kindref="member">attr_type::direction</ref>&gt;();</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/>d_attr.unit_dir<sp/>=<sp/>d<sp/>*<sp/>(projectile_speed<sp/>/<sp/>distance_to_target);</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"></highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>account<sp/>for<sp/>initial<sp/>height</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d65/classopenage_1_1util_1_1_fixed_point" kindref="compound">coord::phys_t</ref><sp/>initial_height<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw.up;</highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/><sp/><sp/>d_attr.unit_dir.up<sp/>=<sp/><ref refid="d1/d93/namespaceopenage_1_1coord_1a257112db0574d981f4bd017656c687fe" kindref="member">coord::phys_t</ref>((<ref refid="d5/d14/classopenage_1_1_projectile_action_1ab5952a52fdb1e1a13a098f301e0d2552" kindref="member">grav</ref><sp/>*<sp/>flight_time)<sp/>/<sp/>2)<sp/>-<sp/>(initial_height<sp/>*<sp/>(1<sp/>/<sp/>flight_time));</highlight></codeline>
<codeline lineno="1339"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1340"><highlight class="normal"></highlight></codeline>
<codeline lineno="1341" refid="d5/d14/classopenage_1_1_projectile_action_1a380aed43496bd5c4b7b041a6705dcba5" refkind="member"><highlight class="normal"><ref refid="d5/d14/classopenage_1_1_projectile_action_1a380aed43496bd5c4b7b041a6705dcba5" kindref="member">ProjectileAction::~ProjectileAction</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="1342"><highlight class="normal"></highlight></codeline>
<codeline lineno="1343" refid="d5/d14/classopenage_1_1_projectile_action_1a5be4d6d237bbb52a036d368af97956b6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d5/d14/classopenage_1_1_projectile_action_1a5be4d6d237bbb52a036d368af97956b6" kindref="member">ProjectileAction::update</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>time)<sp/>{</highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>&amp;d_attr<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a3e12324401051119f44e212dae1a87ce" kindref="member">get_attribute</ref>&lt;<ref refid="da/d23/namespaceopenage_1a38adadf644885a7fe121be11ffeb8c36aef72c37be9d1b9e6e5bbd6ef09448abe" kindref="member">attr_type::direction</ref>&gt;();</highlight></codeline>
<codeline lineno="1345"><highlight class="normal"></highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>apply<sp/>gravity</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/>d_attr.unit_dir.up<sp/>-=<sp/>this-&gt;<ref refid="d5/d14/classopenage_1_1_projectile_action_1ab5952a52fdb1e1a13a098f301e0d2552" kindref="member">grav</ref><sp/>*<sp/>time;</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"></highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/da4/structopenage_1_1coord_1_1phys3" kindref="compound">coord::phys3</ref><sp/>new_position<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw<sp/>+<sp/>d_attr.unit_dir<sp/>*<sp/>time;</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;move(new_position))<sp/>{</highlight></codeline>
<codeline lineno="1351"><highlight class="normal"></highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>implement<sp/>friendly_fire<sp/>(now<sp/>friendly_fire<sp/>is<sp/>always<sp/>on),<sp/>attack_attribute.friendly_fire</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1353"><highlight class="normal"></highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>object<sp/>which<sp/>was<sp/>hit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>terrain<sp/>=<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;get_terrain();</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d3/dd0/classopenage_1_1_tile_content" kindref="compound">TileContent</ref><sp/>*tc<sp/>=<sp/>terrain-&gt;get_data(new_position.<ref refid="d2/da4/structopenage_1_1coord_1_1phys3_1a8ed61fb85a083922af8fbbabd087ae31" kindref="member">to_tile3</ref>().<ref refid="db/dd1/structopenage_1_1coord_1_1tile3_1af828e2ee284deb35ce13d30b57b14ad0" kindref="member">to_tile</ref>());</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tc<sp/>&amp;&amp;<sp/>!tc-&gt;<ref refid="d3/dd0/classopenage_1_1_tile_content_1aaeff054a61d61cc0c65cfefcc78de233" kindref="member">obj</ref>.empty())<sp/>{</highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>obj_location<sp/>:<sp/>tc-&gt;<ref refid="d3/dd0/classopenage_1_1_tile_content_1aaeff054a61d61cc0c65cfefcc78de233" kindref="member">obj</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>.get()<sp/>!=<sp/>obj_location<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obj_location-&gt;check_collisions())<sp/>{</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a7beffb7ad454cf467d7a6b843df939c7" kindref="member">damage_unit</ref>(obj_location-&gt;unit);</highlight></codeline>
<codeline lineno="1362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"></highlight></codeline>
<codeline lineno="1367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO<sp/>implement<sp/>area<sp/>of<sp/>effect,<sp/>attack_attribute.area_of_effect</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1368"><highlight class="normal"></highlight></codeline>
<codeline lineno="1369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d14/classopenage_1_1_projectile_action_1a6343bf60c356f44ff0a403a715f44d96" kindref="member">has_hit</ref><sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1370"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1371"><highlight class="normal"></highlight></codeline>
<codeline lineno="1372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>inc<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1373"><highlight class="normal"><sp/><sp/><sp/><sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a8f995b745da73c4e95ec83d8b14c38c6" kindref="member">frame</ref><sp/>+=<sp/>time<sp/>*<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d0154b413ca914966b9796bc37193b8" kindref="member">frame_rate</ref>;</highlight></codeline>
<codeline lineno="1374"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1375"><highlight class="normal"></highlight></codeline>
<codeline lineno="1376" refid="d5/d14/classopenage_1_1_projectile_action_1aa44816da8dbffef6ea1c3b0832e1a804" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="d5/d14/classopenage_1_1_projectile_action_1aa44816da8dbffef6ea1c3b0832e1a804" kindref="member">ProjectileAction::on_completion</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="1377"><highlight class="normal"></highlight></codeline>
<codeline lineno="1378" refid="d5/d14/classopenage_1_1_projectile_action_1a588ecb867716c22ac7a571274733ad7a" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="d5/d14/classopenage_1_1_projectile_action_1a588ecb867716c22ac7a571274733ad7a" kindref="member">ProjectileAction::completed</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="1379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="d5/d14/classopenage_1_1_projectile_action_1a6343bf60c356f44ff0a403a715f44d96" kindref="member">has_hit</ref><sp/>||<sp/>this-&gt;<ref refid="dc/d74/classopenage_1_1_unit_action_1a5d47af0412db504ab95c58b12418d55c" kindref="member">entity</ref>-&gt;<ref refid="df/dea/classopenage_1_1_unit_1a12811894b98383b4c3cfe6769bc3ff80" kindref="member">location</ref>-&gt;pos.draw.up<sp/>&lt;=<sp/>0);</highlight></codeline>
<codeline lineno="1380"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1381"><highlight class="normal"></highlight></codeline>
<codeline lineno="1382"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace<sp/>openage</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/mnt/c/Users/Jameson/Desktop/git/openage-new-doc-system/libopenage/unit/action.cpp"/>
  </compounddef>
</doxygen>
